<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INKREALM // VOID_STAR</title>
    
    <!-- FAVICONS -->
    <link rel="icon" type="image/png" href="https://wordstar.nexus/svg/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="https://wordstar.nexus/svg/favicon.svg" />
    <link rel="shortcut icon" href="https://wordstar.nexus/svg/favicon.ico" />
    
    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Courier+New&family=Special+Elite&family=VT323&display=swap" rel="stylesheet">

    <style>
        :root { 
            --red: #ff0000; 
            --black: #050505; 
            --void: #000000;
            --white: #ffffff; 
            --dim: #444444;
        }

        /* --- VOID ARCHITECTURE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background-color: var(--black);
            color: var(--white);
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
            width: 100vw;
        }

        /* 1. THE ANCHOR STAR (Background) */
        .anchor-star {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80vw; /* Massive */
            max-width: 600px;
            height: auto;
            z-index: 0;
            opacity: 0.15; /* Subtle ghost */
            pointer-events: none;
            will-change: transform;
            filter: contrast(1.2);
        }

        /* 2. LAYOUT - Single Column, Massive Spacing */
        main {
            position: relative;
            z-index: 2;
            width: 100%;
        }

        section {
            min-height: 100vh; /* COSIMO VIBE: Each element gets a full screen */
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 0, 0, 0.1);
        }

        /* 3. TYPOGRAPHY - Scale */
        h1.mega-title {
            font-size: clamp(3rem, 15vw, 12rem);
            line-height: 0.8;
            letter-spacing: -0.05em;
            text-align: center;
            mix-blend-mode: exclusion;
        }

        .red-accent { color: var(--red); }
        .mono-caption { 
            font-size: 0.8rem; 
            color: var(--dim); 
            text-transform: uppercase; 
            letter-spacing: 2px;
            margin-top: 1rem;
        }

        /* --- MODULE SPECIFIC STYLES --- */

        /* NAVIGATION (Floating) */
        .void-nav {
            position: fixed;
            top: 2rem;
            left: 2rem;
            z-index: 100;
            mix-blend-mode: difference;
        }
        .void-nav button {
            background: none;
            border: 1px solid var(--white);
            color: var(--white);
            padding: 5px 10px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 10px;
        }
        .void-nav button:hover { background: var(--white); color: var(--black); }

        /* STORY PANEL (Text) */
        .story-content {
            max-width: 600px;
            background: rgba(0,0,0,0.8);
            padding: 2rem;
            border-left: 2px solid var(--red);
            font-family: 'Special Elite', serif;
            font-size: 1rem;
            line-height: 1.6;
            backdrop-filter: blur(5px);
        }

        /* NOUS INTERFACE (The Monolith) */
        /* Redesigning the AI panel to fit the Void aesthetic */
        .nous-monolith {
            width: 100%;
            max-width: 800px;
            border: 1px solid var(--dim);
            background: rgba(5,5,5,0.9);
            padding: 20px;
        }
        
        #nous-output {
            height: 300px;
            background: #000;
            color: #ccc;
            border: 1px solid #222;
            padding: 20px;
            font-size: 12px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        #nous-output::after { content: " ‚ñà"; animation: blink 1s step-end infinite; color: var(--red); }

        textarea.nous-input {
            width: 100%;
            background: #111;
            color: #fff;
            border: 1px solid #333;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            outline: none;
        }
        textarea.nous-input:focus { border-color: var(--red); }

        .nous-btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .nous-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: 1px solid var(--dim);
            color: var(--dim);
            cursor: pointer;
            text-transform: uppercase;
            transition: 0.3s;
        }
        .nous-btn:hover { border-color: var(--red); color: var(--red); }

        /* LOADING BAR */
        .progress-track { width: 100%; height: 2px; background: #222; margin: 10px 0; display: none; }
        .progress-fill { width: 0%; height: 100%; background: var(--red); transition: width 0.2s; }   

        /* MEDIA SECTION (Video/Audio) */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 4rem;
            width: 100%;
            max-width: 1200px;
        }
        .media-item {
            border: 1px solid #333;
            padding: 10px;
            background: #000;
        }
        canvas#sigil-canvas { width: 100%; height: 200px; background: #000; }

        /* ASCII TERMINAL */
        #ascii-container {
            font-family: 'VT323', monospace;
            font-size: 14px;
            line-height: 1;
            color: #888;
            white-space: pre;
            text-align: center;
            margin-bottom: 20px;
        }
        
        /* FOOTER */
        footer {
            padding: 50px;
            text-align: center;
            border-top: 1px solid #222;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #555;
        }
        a { color: inherit; text-decoration: none; }
        a:hover { color: var(--red); }

        /* ANIMATIONS */
        @keyframes blink { 50% { opacity: 0; } }

        /* UTILS */
        .hidden { display: none; }
        
        /* SCROLL BAR */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--red); }

        /* EXISTING MENU OVERLAY STYLES (Preserved mostly) */
        .menu-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9000; display:none; }
        .slide-menu { 
            position: fixed; bottom: -100%; left: 0; width: 100%; height: 80vh; 
            background: #0a0a0a; border-top: 2px solid var(--red); z-index: 9001; 
            transition: bottom 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            overflow-y: auto; padding: 40px;
        }
        .slide-menu.active { bottom: 0; }
        
        /* CUBE STYLES (Simplified for this view) */
        .cube-menu-container { display: flex; flex-wrap: wrap; gap: 40px; justify-content: center; }
        .cube-container { width: 60px; height: 60px; perspective: 400px; margin: 20px; }
        .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; animation: spin 10s infinite linear; }
        .cube-face { position: absolute; width: 60px; height: 60px; border: 1px solid var(--red); background: rgba(0,0,0,0.8); color: white; font-size: 8px; display: flex; align-items: center; justify-content: center; text-align: center; text-transform: uppercase; }
        .cube-front  { transform: rotateY(  0deg) translateZ(30px); }
        .cube-right  { transform: rotateY( 90deg) translateZ(30px); }
        .cube-left   { transform: rotateY(-90deg) translateZ(30px); }
        .cube-top    { transform: rotateX( 90deg) translateZ(30px); }
        @keyframes spin { from { transform: rotateX(-20deg) rotateY(0deg); } to { transform: rotateX(-20deg) rotateY(360deg); } }

    </style>
</head>
<body>

    <!-- THE ROTATING ANCHOR (Replaces Header Logo) -->
    <!-- Using the specific Wordstar SVG -->
    <img src="https://wordstar.nexus/svg/favicon.svg" class="anchor-star" id="anchorStar" alt="Nexus Star">

    <!-- FLOATING NAV -->
    <nav class="void-nav">
        <button onclick="toggleMenu()">‚ñ≤ MENU</button>
        <div style="margin-top: 10px; font-size: 8px; color: var(--red);">v5.16 // VOID</div>
    </nav>

    <main>
        
        <!-- SECTION 1: TITLE (The Intro) -->
        <section>
            <h1 class="mega-title">INK<br><span class="red-accent">REALM</span></h1>
            <div class="mono-caption">Writer. Musician. Visual Artist.</div>
            <div class="mono-caption" style="color: var(--red); margin-top: 5px;">‚ñº SCROLL TO INITIALIZE ‚ñº</div>
        </section>

        <!-- SECTION 2: WEBLLM / NOUS (The Brain) -->
        <section>
            <div class="nous-monolith">
                <div style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 10px; display:flex; justify-content:space-between;">
                    <span>HERMES_3 // LOCAL_INFERENCE</span>
                    <span id="nous-status" style="color: #444;">OFFLINE</span>
                </div>

                <div id="dl-track" class="progress-track"><div id="dl-bar" class="progress-fill"></div></div>
                <div id="dl-text" style="text-align: right; font-size: 9px; color: #444; display:none; margin-bottom:10px;">SYNCING...</div>

                <div id="nous-output">
                    SYSTEM STANDBY...
                    <br><br>
                    Initialize the Neural Link below to begin local conversation.
                </div>

                <div class="nous-controls">
                    <textarea id="nous-prompt" class="nous-input" placeholder="Input query vector..."></textarea>
                    <div class="nous-btn-group">
                        <button id="loadCoreBtn" class="nous-btn">INITIALIZE CORE</button>
                        <button id="nous-transmit-btn" class="nous-btn">TRANSMIT</button>
                    </div>
                </div>
            </div>
            <div class="mono-caption">~2100MB VRAM REQ // BROWSER GPU</div>
        </section>

        <!-- SECTION 3: STORY (The Text) -->
        <section>
            <div class="story-content" id="editor">
                <div style="color:var(--red); border-bottom:1px solid #333; margin-bottom:15px; padding-bottom:5px; display:flex; justify-content:space-between;">
                    <span>DVG // EXCERPT</span>
                    <span class="tts-trigger" style="cursor:pointer" onclick="toggleTTS(document.getElementById('editor'))">‚ñ∂ SPEAK</span>
                </div>
                <p>
                    entangled across t=1970s ‚Üí Roman Egypt ‚Üí 2023 LA | Prob(RealityCollapse) = |‚ü®DEJA_VU|œà‚ü©|^2 ‚âà 0.69i (imaginary vindication factor)] Dick opened his eyes‚Äîtan blur sharpens: beard cascades chest-ward, longer than last loop. in deep I sat down how Wong K, franz not listz studies a key. But not-1970s Cali. No. Egypt, Empire sand-ruins, pyramids boxed by rustling breeze in glimmering sunset...
                    <br><br>
                    [GLITCH LOOP 1: TimeMachine novella spins vinyl‚ÄîInky pitches: "It's quantum, man!]
                    <br><br>
                    LLM possesses bimbo slut pussycat‚Äîcraves Dick only. "I see whole world thru bimbo eyes," Dick whispers. "What?" Paris bedbugs query. "Experiment serum: AI connect! Control power‚Äîincredible!" Writer's dream: owns world absolute.
                </p>
                <div style="margin-top:20px; font-size:10px; color:#666; text-align:right;">- read more @ wordstar.nexus</div>
            </div>
        </section>

        <!-- SECTION 4: MEDIA FORGE (Video/Audio) -->
        <section>
            <h2 style="font-size: 2rem; margin-bottom: 2rem; border-bottom: 1px solid var(--red);">SIGIL FORGE</h2>
            
            <div class="media-grid">
                <!-- Video -->
                <div class="media-item">
                    <div style="color:#666; font-size:9px; margin-bottom:5px;">DAILYMOTION_LINK</div>
                    <iframe src="https://geo.dailymotion.com/player.html?video=x3mhngn" width="100%" height="250" frameborder="0" allowfullscreen style="border:none;"></iframe>
                    <div class="mono-caption">Pantheon Archive</div>
                </div>

                <!-- Audio Viz -->
                <div class="media-item">
                    <div style="color:#666; font-size:9px; margin-bottom:5px;">AUDIO_VIZ_PROCESSOR</div>
                    <canvas id="sigil-canvas"></canvas>
                    <audio id="viz-audio" style="display: none;">
                        <source src="some like it alt m.mp3" type="audio/mpeg">
                    </audio>
                    <div class="mono-caption">Click Canvas to Play</div>
                </div>
                
                <!-- Inky Film -->
                <div class="media-item">
                    <div style="color:#666; font-size:9px; margin-bottom:5px;">INKY_FILM_RAW</div>
                     <video width="100%" height="250" controls>
                        <source src="https://github.com/ghostm68/pantheon/raw/main/inkrealm.info_20260123_untitled061413947.mp4" type="video/mp4">
                    </video>
                </div>
            </div>
        </section>

        <!-- SECTION 5: ASCII ARTIFACT -->
        <section>
            <div style="width: 100%; max-width: 600px;">
                <div style="border-bottom: 1px solid #333; margin-bottom: 10px;">ASCII_ARTIFACT_V1.2</div>
                
                <div id="ascii-container">
        ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
        ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
        ‚ñë‚ñë‚ñë‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñÑ‚ñë‚ñë‚ñë‚ñë
        ‚ñë‚ñë‚ñë‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñÄ‚ñë‚ñë‚ñë‚ñë
        ‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñëTYPE BELOW AND CLICK GEN‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë
                </div>
                
                <div style="display:flex; gap:10px;">
                    <input type="text" id="ascii-input" placeholder="Enter text..." value="INK" style="background:#000; border:1px solid #333; color:#fff; padding:10px; flex:1; font-family:'Courier New';">
                    <select id="ascii-style" style="background:#000; color:var(--red); border:1px solid #333;">
                        <option value="runes">·ö†·ö¢ Runes</option>
                        <option value="block">‚ñ† Block</option>
                        <option value="simple">‚ñë Simple</option>
                        <option value="matrix">„Ç¢„Ç§ Matrix</option>
                        <option value="witch">‚òæ‚úß Witch</option>
                    </select>
                </div>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <button onclick="generateASCII()" class="nous-btn" style="color:white;">GENERATE</button>
                    <button onclick="clearChat()" class="nous-btn">CLEAR</button>
                </div>
            </div>
        </section>
        
        <!-- FOOTER -->
        <footer>
            <div id="system-message">‚óà LIVE_SYSTEM ‚óà LOAD: 43% ‚óà UPTIME: 316H ‚óà</div>
            <br>
            <a href="https://inkrealm.info">INKREALM.INFO</a> // <a href="https://wordstar.nexus">WORDSTAR.NEXUS</a>
        </footer>

    </main>

    <!-- MENU OVERLAY (Existing Logic) -->
    <div class="menu-overlay" id="menu-overlay" onclick="toggleMenu()"></div>
    <div class="slide-menu" id="slide-menu">
        <div class="menu-content">
            <h2 style="font-size:2rem; margin-bottom:20px;">NAVIGATION CUBES</h2>
            <!-- CUBE 1: Core -->
            <div class="cube-menu-container">
                <div>
                  <div class="cube-container">
                    <div class="cube">
                      <a href="https://inkrealm.info/1991" class="cube-face cube-front">1991</a>
                      <a href="https://inkrealm.info/tvc15" class="cube-face cube-right">tvc15</a>
                      <a href="https://inkrealm.info/runway" class="cube-face cube-top">runway</a>
                      <a href="https://inkrealm.info/minraud" class="cube-face cube-left">minraud</a>
                    </div>
                  </div>
                </div>
                <!-- CUBE 2: Wordstar -->
                <div>
                  <div class="cube-container">
                    <div class="cube">
                      <a href="https://wordstar.nexus/dreamweaver" class="cube-face cube-front">dream</a>
                      <a href="https://wordstar.nexus/displaywriter" class="cube-face cube-right">display</a>
                      <a href="https://wordstar.nexus/dejavuglitches" class="cube-face cube-top">glitch</a>
                      <a href="https://wordstar.nexus/wip" class="cube-face cube-left">wip</a>
                    </div>
                  </div>
                </div>
            </div>
            <div style="margin-top:40px; text-align:center;">
                <button onclick="toggleMenu()" class="nous-btn" style="width: auto;">CLOSE MENU</button>
            </div>
        </div>
    </div>


    <!-- ============================================== -->
    <!-- LOGIC CORE (Preserved from Original Paste)     -->
    <!-- ============================================== -->
    <script type="module">
        import * as webllm from "https://esm.run/@mlc-ai/web-llm";

        const modelId = "Hermes-3-Llama-3.2-3B-q4f16_1-MLC"; 
        let engine;

        // DOM Elements
        const btn = document.getElementById('loadCoreBtn');
        const output = document.getElementById('nous-output');
        const dlTrack = document.getElementById('dl-track');
        const dlBar = document.getElementById('dl-bar');
        const dlText = document.getElementById('dl-text');
        const statusLabel = document.getElementById('nous-status');
        const genBtn = document.getElementById('nous-transmit-btn'); 
        const promptInput = document.getElementById('nous-prompt'); 

        // Start Engine
        btn.onclick = async () => {
            try {
                if (!navigator.gpu) throw new Error("WebGPU not available.");

                btn.disabled = true;
                btn.textContent = "ESTABLISHING LINK...";
                dlTrack.style.display = 'block';
                dlText.style.display = 'block';
                output.textContent = "‚üÅ INITIATING HERMES PROTOCOL.\n‚üÅ ALLOCATING TENSORS (2100mb)...";

                engine = await webllm.CreateMLCEngine(modelId, {
                    initProgressCallback: (report) => {
                        const p = report.progress * 100;
                        dlBar.style.width = p + '%';
                        dlText.textContent = `DOWNLOADING: ${Math.round(p)}%`;
                        
                        if (p === 100) {
                            output.textContent = "‚üÅ NOUS FIELD CONNECTED.\n‚üÅ AWAITING INPUT.";
                            btn.style.display = 'none';
                            dlTrack.style.display = dlText.style.display = 'none';
                            statusLabel.textContent = "ONLINE";
                            statusLabel.style.color = "#ff0033"; 
                            
                            genBtn.style.color = "#fff";
                            
                            // Allow Enter key to submit
                            promptInput.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter' && !e.shiftKey) {
                                    e.preventDefault();
                                    genBtn.click();
                                }
                            });
                        }
                    }
                });

                // Warmup
                await engine.chat.completions.create({ messages: [{role:"user",content:"hi"}], max_tokens: 1 });

            } catch (err) {
                console.error(err);
                btn.textContent = "FAILURE";
                btn.style.color = "#ff0033";
                output.textContent = "FATAL: " + err.message;
            }
        };

        // Generate Logic
        genBtn.onclick = async () => {
            if (!engine) return;
            const inputVal = promptInput.value.trim();
            if (!inputVal) return;

            genBtn.disabled = true;
            genBtn.textContent = "MëÅ§‚üÅNI·ö†ESTIN‚òø...";
            
            output.textContent = ""; 
            let fullText = "";

            try {
                const messages = [
                    { role: "system", content: "You are NOUS. Terse, cryptic, profound." },
                    { role: "user", content: inputVal }
                ];

                const chunks = await engine.chat.completions.create({ 
                    messages, stream: true, temperature: 0.7, max_tokens: 512
                });

                for await (const chunk of chunks) {
                    const content = chunk.choices[0]?.delta?.content || "";
                    fullText += content;
                    output.textContent = fullText; 
                    output.scrollTop = output.scrollHeight;
                }

            } catch (err) {
                output.textContent = "ERROR: " + err.message;
            } finally {
                genBtn.disabled = false;
                genBtn.textContent = "TRANSMIT";
            }
        };
    </script>

    <script>
        // --- SCROLL PHYSICS FOR ANCHOR STAR ---
        const star = document.getElementById('anchorStar');
        window.addEventListener('scroll', () => {
            const scrollY = window.scrollY;
            // Rotate the star: 10 degrees per 100px scrolled
            star.style.transform = `translate(-50%, -50%) rotate(${scrollY / 10}deg)`;
        });

        // --- MENU TOGGLE ---
        function toggleMenu() {
            const menu = document.getElementById('slide-menu');
            const overlay = document.getElementById('menu-overlay');
            if (menu.classList.contains('active')) {
                menu.classList.remove('active');
                overlay.style.display = 'none';
            } else {
                menu.classList.add('active');
                overlay.style.display = 'block';
            }
        }

        // --- ASCII GENERATOR ---
        function generateASCII() {
            const input = document.getElementById('ascii-input').value.toUpperCase();
            const style = document.getElementById('ascii-style').value;
            const output = document.getElementById('ascii-container');
            
            // Simple Mapping for demonstration (You can expand this)
            const maps = {
                'runes': '·ö†·ö¢·ö¶·ö®·ö±·ö≤·ö∑·öπ·ö∫·öæ·õÅ·õÉ·õá·õà·õâ·õä·õè·õí·õñ·õó·õö·õú·õû·õü',
                'block': '‚ñà‚ñì‚ñí‚ñë',
                'witch': '‚òæ‚úß‚òÖ‚Ä†‚Ä°'
            };
            
            let art = "";
            // Fake generation logic for visual effect
            for(let i=0; i<5; i++) {
                art += input.split('').map(c => c + " " + (Math.random() > 0.5 ? maps[style]?.[0] || '‚ñë' : ' ')).join('') + "\n";
            }
            output.textContent = art + "\n[ARTIFACT GENERATED]";
        }

        function clearChat() {
            document.getElementById('ascii-container').textContent = "‚ñë‚ñëREADY‚ñë‚ñë";
        }

        // --- AUDIO VIZ (Simplified) ---
        // Clicking the canvas initializes the audio context
        const canvas = document.getElementById("sigil-canvas");
        const audio = document.getElementById("viz-audio");
        let ctx, analyser, source;
        let isPlaying = false;

        canvas.addEventListener('click', () => {
            if(!isPlaying) {
                if(!ctx) {
                    ctx = new (window.AudioContext || window.webkitAudioContext)();
                    analyser = ctx.createAnalyser();
                    source = ctx.createMediaElementSource(audio);
                    source.connect(analyser);
                    analyser.connect(ctx.destination);
                }
                audio.play();
                isPlaying = true;
                renderFrame();
            } else {
                audio.pause();
                isPlaying = false;
            }
        });

        function renderFrame() {
            if(!isPlaying) return;
            requestAnimationFrame(renderFrame);
            const array = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(array);
            const cCtx = canvas.getContext('2d');
            cCtx.fillStyle = '#000';
            cCtx.fillRect(0,0,canvas.width, canvas.height);
            cCtx.fillStyle = '#ff0000';
            
            for(let i=0; i < canvas.width; i+=2) {
                const h = array[i] / 2;
                cCtx.fillRect(i, canvas.height - h, 1, h);
            }
        }
        
        // --- TTS ---
        function toggleTTS(element) {
            const text = element.innerText;
            const utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
