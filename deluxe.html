<!DOCTYPE html><html><head>
  <title>Prelude Craft </title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;700&amp;display=swap" rel="stylesheet">
<style>
  body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    font-family: 'Work Sans', sans-serif;
    background-color: #1a1a1a;
    color: #ffffff;
  }
  #graph-container {
    width: 100vw;
    height: 100vh;
  }
  .node {
    cursor: pointer;
  }
  .node circle {
    stroke: #fff;
    stroke-width: 1.5px;
  }
  .node text {
    font-size: 12px;
    fill: #ffffff;
  }
  .link {
    fill: none;
    stroke: #666;
    stroke-width: 1.5px;
  }
  #mixing-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }
  #mixing-circle {
    width: 200px;
    height: 200px;
    background-color: rgba(255, 255, 255, 0.2);
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.1);
    }
    100% {
      transform: scale(1);
    }
  }
  #mixing-text {
    font-size: 24px;
    font-weight: bold;
    text-align: center;
  }
  #elements-bar {
    position: fixed;
    top: 20px;
    left: 20px;
    background-color: rgba(26, 26, 26, 0.5);
    padding: 10px;
    border-radius: 5px;
    z-index: 100;
  }
  #elements-list {
    position: fixed;
    top: 100px;
    left: 20px;
    width: 200px;
    height: calc(100vh - 120px);
    overflow-y: auto;
    background-color: rgba(26, 26, 26, 0.5);
    padding: 10px;
    border-radius: 5px;
    z-index: 100;
  }
  .element-item {
    margin-bottom: 5px;
    cursor: pointer;
    padding: 5px;
    border-radius: 3px;
    transition: background-color 0.3s;
  }
  .element-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
  #custom-element-creator {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 200px;
    background-color: rgba(26, 26, 26, 0.5);
    padding: 10px;
    border-radius: 5px;
    z-index: 100;
  }
  #custom-element-creator input, #custom-element-creator button {
    width: 100%;
    margin-bottom: 10px;
  }
  #toggle-creator {
    position: fixed;
    bottom: 20px;
    left: 20px;
    z-index: 101;
    border: none;
    border-radius: 50%;
    cursor: pointer;
  }
  #clear-button {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    font-size: 24px;
    background-color: rgba(26, 26, 26, 0.5);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    z-index: 100;
  }
  #search-container {
    margin-bottom: 10px;
  }
  #search-box {
    position: relative;
    width: 100%;
  }
  #search-input {
    width: calc(100% - 30px);
    padding: 5px 25px 5px 5px;
    border: 1px solid #ccc;
    border-radius: 3px;
    font-size: 14px;
  }
  #search-icon {
    position: absolute;
    right: 5px;
    top: 50%;
    transform: translateY(-50%);
    width: 20px;
    height: 20px;
    fill: #888;
  }
  #discovery-animation {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.8);
    color: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    display: none;
    z-index: 1001;
    animation: fadeInOut 3s ease-in-out;
  }
  @keyframes fadeInOut {
    0%, 100% { opacity: 0; }
    20%, 80% { opacity: 1; }
  }
  #discovery-text {
    font-size: 24px;
    margin-bottom: 10px;
  }
  #discovered-element {
    font-size: 36px;
    font-weight: bold;
  }
  #instructions-menu {
    position: fixed;
    top: 20px;
    right: 70px;
    z-index: 1000;
  }
  #toggle-instructions {
    width: 40px;
    height: 40px;
    font-size: 24px;
    background-color: rgba(26, 26, 26, 0.5);
    color: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
  }
  #instructions-content {
    position: absolute;
    top: 50px;
    right: 0;
    width: 300px;
    background-color: rgba(26, 26, 26, 0.9);
    padding: 20px;
    border-radius: 5px;
    display: none;
    color: white;
    font-size: 14px;
  }
  #instructions-content h2 {
    font-size: 18px;
    margin-bottom: 10px;
  }
  #instructions-content ol {
    padding-left: 20px;
  }
  #instructions-content li {
    margin-bottom: 5px;
  }
</style>
</head>
<body>
<div id="graph-container">
  <div id="instructions-menu">
    <button id="toggle-instructions">?</button>
    <div id="instructions-content">
      <h2>How to...</h2>
      <ol>
        <li>Start with the four basic elements: Wprd, Sentence, Paragraph, and Chapter.</li>
        <li>Click on two elements to combine them and create a new element.</li>
        <li>Discover new elements by combining existing ones in different ways.</li>
        <li>Use the search bar to find specific elements quickly.</li>
        <li>Create custom elements using the "+" button at the bottom left.</li>
        <li>Clear your progress and start over with the trash can button.</li>
      </ol>
      <p>Have fun exploring and creating new elements!</p>
    </div>
  </div>
</div>
<div id="elements-bar">
  <div id="search-container">
    <div id="search-box">
      <input type="text" id="search-input" placeholder="Search elements...">
      <svg id="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
      </svg>
    </div>
  </div>
</div>
<div id="elements-list"></div>
<button id="toggle-creator">+</button>
<div id="custom-element-creator" style="display: none;">
  <input type="text" id="custom-element-name" placeholder="Enter element name">
  <button id="create-custom-element">Create Element</button>
</div>
<button id="clear-button" style="position: fixed; bottom: 20px; right: 20px; width: 40px; height: 40px; font-size: 24px; background-color: rgba(26, 26, 26, 0.5); color: white; border: none; border-radius: 50%; cursor: pointer; z-index: 100;">üóëÔ∏è</button>
<div id="mixing-overlay">
  <div id="mixing-circle">
    <div id="mixing-text">Magic...</div>
  </div>
</div>
<div id="discovery-animation">
  <div id="discovery-text">decoded:</div>
  <div id="discovered-element"></div>
</div>

<script>
const width = window.innerWidth;
const height = window.innerHeight;
const baseElements = ["Word", "Sentence", "Paragraph", "Chapter"];
let nodes = [];
let links = [];
let selectedNodes = [];

const svg = d3.select("#graph-container")
  .append("svg")
  .attr("width", width)
  .attr("height", height);

const simulation = d3.forceSimulation()
  .force("link", d3.forceLink().id(d => d.id).distance(100))
  .force("charge", d3.forceManyBody().strength(-300))
  .force("center", d3.forceCenter(width / 2, height / 2));

let link = svg.append("g")
  .attr("class", "links")
  .selectAll("line");

let node = svg.append("g")
  .attr("class", "nodes")
  .selectAll("g");

function updateGraph() {
  link = link.data(links, d => `${d.source.id}-${d.target.id}`);
  link.exit().remove();
  link = link.enter().append("line")
    .attr("class", "link")
    .merge(link);

  node = node.data(nodes, d => d.id);
  node.exit().remove();
  const nodeEnter = node.enter().append("g")
    .attr("class", "node")
    .call(d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended));

  nodeEnter.append("circle")
    .attr("r", 10)
    .attr("fill", d => getColor(d.id));

  nodeEnter.append("text")
    .attr("dy", "0.35em")
    .attr("x", 12)
    .text(d => d.id);

  node = nodeEnter.merge(node);

  simulation.nodes(nodes);
  simulation.force("link").links(links);
  simulation.alpha(1).restart();
}

function getColor(elementName) {
  const colors = {
    "Word": "#3498db",
    "Sentence": "#e74c3c",
    "Paragraph": "#2ecc71",
    "Chapter": "#ecf0f1"
  };
  return colors[elementName] || "#f39c12";
}

function dragstarted(event, d) {
  if (!event.active) simulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(event, d) {
  d.fx = event.x;
  d.fy = event.y;
}

function dragended(event, d) {
  if (!event.active) simulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

function ticked() {
  link
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);

  node
    .attr("transform", d => `translate(${d.x},${d.y})`);
}

simulation.on("tick", ticked);

function addElement(elementName) {
  if (!nodes.some(n => n.id === elementName)) {
    nodes.push({ id: elementName });
    updateElementsList();
    updateGraph();
  }
}

function updateElementsList() {
  const elementsList = d3.select("#elements-list");
  elementsList.selectAll("*").remove();
  
  nodes.forEach(node => {
    elementsList.append("div")
      .attr("class", "element-item")
      .text(node.id)
      .on("click", () => selectElement(node.id));
  });
}

function selectElement(elementName) {
  if (selectedNodes.length < 2) {
    selectedNodes.push(elementName);
    if (selectedNodes.length === 2) {
      mixElements(selectedNodes[0], selectedNodes[1]);
    }
  }
}

function mixElements(element1, element2) {
  showMixingAnimation();
  
  setTimeout(() => {
    fetch(`https://api.datamuse.com/words?sp=t??k=${encodeURIComponent(element1)}&element2=${encodeURIComponent(element2)}`, {
      method: 'GET',
      headers: {
        'Accept': 'application/json'
      }
    })
    .then(response => response.json())
    .then(data => {
      hideMixingAnimation();
      if (data.result) {
        const newElement = data.result;
        addElement(newElement);
        links.push({ source: element1, target: newElement });
        links.push({ source: element2, target: newElement });
        updateGraph();
        showDiscoveryAnimation(newElement);
      }
      selectedNodes = [];
    })
    .catch(error => {
      console.error('Error:', error);
      hideMixingAnimation();
      selectedNodes = [];
    });
  }, 1000);
}

function showMixingAnimation() {
  document.getElementById("mixing-overlay").style.display = "flex";
}

function hideMixingAnimation() {
  document.getElementById("mixing-overlay").style.display = "none";
}

function showDiscoveryAnimation(element) {
  const discoveryAnimation = document.getElementById("discovery-animation");
  const discoveredElement = document.getElementById("discovered-element");
  
  discoveredElement.textContent = element;
  discoveryAnimation.style.display = "block";
  
  setTimeout(() => {
    discoveryAnimation.style.display = "none";
  }, 3000);
}

baseElements.forEach(addElement);

const toggleCreator = document.getElementById("toggle-creator");
const customElementCreator = document.getElementById("custom-element-creator");
const customElementName = document.getElementById("custom-element-name");
const createCustomElement = document.getElementById("create-custom-element");

toggleCreator.addEventListener("click", () => {
  customElementCreator.style.display = customElementCreator.style.display === "none" ? "block" : "none";
});

createCustomElement.addEventListener("click", () => {
  const elementName = customElementName.value.trim();
  if (elementName) {
    addElement(elementName);
    customElementName.value = "";
  }
});

const clearButton = document.getElementById("clear-button");
clearButton.addEventListener("click", () => {
  nodes = baseElements.map(element => ({ id: element }));
  links = [];
  selectedNodes = [];
  updateElementsList();
  updateGraph();
});

const searchInput = document.getElementById("search-input");
searchInput.addEventListener("input", () => {
  const searchTerm = searchInput.value.toLowerCase();
  const elementItems = document.querySelectorAll(".element-item");
  
  elementItems.forEach(item => {
    const elementName = item.textContent.toLowerCase();
    if (elementName.includes(searchTerm)) {
      item.style.display = "block";
    } else {
      item.style.display = "none";
    }
  });
});

// Add instructions menu functionality
const toggleInstructions = document.getElementById("toggle-instructions");
const instructionsContent = document.getElementById("instructions-content");

toggleInstructions.addEventListener("click", () => {
  instructionsContent.style.display = instructionsContent.style.display === "none" ? "block" : "none";
});

updateElementsList();
updateGraph();
</script>
</body></html>
</html>
<br>
<br>

<html><head><title>LITERARY NOTE CRAFT </title>
<script src="https://d3js.org/d3.v7.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;700&amp;display=swap" rel="stylesheet">
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #1a1a1a;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
    user-select: none;
  }
  #graph-container {
    width: 100vw;
    height: 100vh;
    background-color: #1a1a1a;
  }
  .node circle {
    fill: transparent;
    stroke-width: 3px;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .node:hover circle {
    transform: scale(1.2);
  }
  .node text {
    font-size: 12px;
    text-anchor: middle;
    dominant-baseline: middle;
    pointer-events: none;
    text-transform: uppercase;
  }
  .link {
    stroke: #999;
    stroke-opacity: 0.6;
    stroke-dasharray: 5, 5;
  }
  .particle {
    fill: #2a2a2a;
    opacity: 0.7;
  }
  @keyframes glow {
    0% {
      filter: drop-shadow(0 0 2px currentColor) drop-shadow(0 0 4px currentColor);
    }
    50% {
      filter: drop-shadow(0 0 3px currentColor) drop-shadow(0 0 6px currentColor) drop-shadow(0 0 9px currentColor);
    }
    100% {
      filter: drop-shadow(0 0 2px currentColor) drop-shadow(0 0 4px currentColor);
    }
  }
  .element-glow {
    animation: glow 2s ease-in-out infinite;
  }
  @keyframes dissipate {
    0% {
      filter: drop-shadow(0 0 3px currentColor) drop-shadow(0 0 6px currentColor) drop-shadow(0 0 9px currentColor);
    }
    100% {
      filter: none;
    }
  }
  .dissipate-glow {
    animation: dissipate 0.5s ease-out forwards;
  }
  #mixing-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }
  #mixing-circle {
    width: 200px;
    height: 200px;
    background-color: #1a1a1a;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    transform: scale(0);
    transition: transform 0.3s ease;
  }
  #mixing-text {
    color: white;
    font-size: 18px;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
  }
  #elements-bar {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgba(26, 26, 26, 0.8);
    backdrop-filter: blur(10px);
    color: white;
    padding: 10px 20px;
    border-top-left-radius: 10px;
    border-top-right-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 14px;
    letter-spacing: 1px;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
  }
  #elements-bar:hover {
    background-color: rgba(40, 40, 40, 0.8);
  }
  #elements-list {
    position: fixed;
    top: 0;
    right: -300px;
    width: 300px;
    height: 100%;
    background-color: rgba(26, 26, 26, 0.9);
    backdrop-filter: blur(10px);
    color: white;
    overflow-y: auto;
    transition: right 0.3s ease;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
  }
  .element-item {
    padding: 15px;
    font-size: 14px;
    letter-spacing: 0.5px;
    transition: background-color 0.2s ease;
    font-weight: bold;
  }
  .element-item:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }
  #search-container {
    padding: 15px;
    position: sticky;
    top: 0;
    background-color: rgba(26, 26, 26, 0.9);
    z-index: 1;
  }
  #search-box {
    display: flex;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    padding: 5px 10px;
  }
  #search-input {
    flex-grow: 1;
    background: none;
    border: none;
    color: #ccc;
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    font-size: 14px;
    padding: 5px;
  }
  #search-input::placeholder {
    color: #888;
  }
  #search-input:focus {
    outline: none;
  }
  #search-icon {
    width: 20px;
    height: 20px;
    fill: #888;
  }
  #custom-element-creator {
    position: fixed;
    top: 0;
    left: -300px;
    width: 250px;
    height: 100%;
    background-color: rgba(26, 26, 26, 0.8);
    backdrop-filter: blur(10px);
    color: white;
    padding: 20px;
    transition: left 0.3s ease;
    box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
  }
  #custom-element-creator h3 {
    margin: 0 0 20px 0;
    color: #fff;
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    font-size: 18px;
    text-transform: uppercase;
  }
  #custom-element-creator input[type="text"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border: none;
    border-radius: 5px;
    background-color: rgba(255, 255, 255, 0.1);
    color: #fff;
    font-family: 'Work Sans', sans-serif;
    font-weight: 400;
    box-sizing: border-box;
  }
  #custom-element-creator input[type="color"] {
    width: 100%;
    height: 40px;
    border: none;
    border-radius: 5px;
    background-color: rgba(255, 255, 255, 0.1);
    margin-bottom: 15px;
    cursor: pointer;
  }
  #custom-element-creator button {
    width: 100%;
    padding: 10px;
    border: none;
    border-radius: 5px;
    background-color: #4CAF50;
    color: #fff;
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
  }
  #toggle-creator {
    position: fixed;
    top: 20px;
    left: 20px;
    background-color: rgba(26, 26, 26, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-size: 20px;
    cursor: pointer;
    z-index: 1001;
    transition: transform 0.3s ease;
  }
  #toggle-creator:hover {
    transform: scale(1.1);
  }
  #clear-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    font-size: 36px;
    background: none;
    border: none;
    cursor: pointer;
    transition: transform 0.3s ease;
  }
  #clear-button:hover {
    transform: scale(1.2);
  }
  @keyframes breathe {
    0% {
      transform: translateX(-50%) scale(1);
    }
    50% {
      transform: translateX(-50%) scale(1.05);
    }
    100% {
      transform: translateX(-50%) scale(1);
    }
  }
  #elements-bar {
    animation: breathe 4s ease-in-out infinite;
  }
  
  /* New styles for the discovery animation */
  #discovery-animation {
    position: fixed;
    top: -100px;
    right: 20px;
    background-color: rgba(26, 26, 26, 0.9);
    color: white;
    padding: 20px;
    border-radius: 10px;
    font-family: 'Work Sans', sans-serif;
    font-weight: 700;
    font-size: 18px;
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    z-index: 2000;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
  
  #discovery-animation.show {
    top: 20px;
    opacity: 1;
  }
  
  #discovery-text {
    margin: 0;
  }
  
  #discovered-element {
    color: #4CAF50;
    font-size: 24px;
    margin-top: 10px;
    display: block;
  }
  
  /* New styles for audio controls */
  #audio-controls {
    position: fixed;
    bottom: 20px;
    right: 80px;
    display: flex;
    align-items: center;
    background-color: rgba(26, 26, 26, 0.8);
    padding: 10px;
    border-radius: 20px;
    z-index: 1002;
  }
  
  #volume-slider {
    width: 100px;
    margin-right: 10px;
  }
  
  #mute-button {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
  }
</style>
</head>
<body>
<div id="graph-container"></div>
<div id="mixing-overlay">
  <div id="mixing-circle">
    <div id="mixing-text">ALCHEMY...</div>
  </div>
</div>
<div id="elements-bar" style="text-align: center; font-family: 'Montserrat', sans-serif; text-transform: uppercase;">
<span id="elements-count" style="font-size: 24px; font-weight: bold; font-family: 'Arial Black', Gadget, sans-serif;">4</span><br>
Coined Elements
</div>
<div id="elements-list" style="border: 2px solid #444; box-shadow: 0 0 10px rgba(68, 68, 68, 0.5); font-family: 'Oswald', sans-serif; font-weight: bold; text-transform: uppercase;">
  <div id="search-container">
    <div id="search-box">
      <input type="text" id="search-input" placeholder="Search elements">
      <svg id="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
      </svg>
    </div>
  </div>
</div>
<div id="custom-element-creator" style="border: 2px solid #444; box-shadow: 0 0 10px rgba(68, 68, 68, 0.5);">
  <h3>Make Custom Element</h3>
  <input type="text" id="custom-element-name" placeholder="Element Name">
  <input type="color" id="custom-element-color" value="#ffffff">
  <button id="create-custom-element">Make</button>
</div>
<button id="toggle-creator" style="width: 30px; height: 30px; font-size: 16px; opacity: 0.7; background-color: rgba(26, 26, 26, 0.5);">‚ûï</button>
<button id="clear-button">üßπ</button>

<!-- New discovery animation element -->
<div id="discovery-animation">
  <p id="discovery-text">YOU HAVE COINED</p>
  <span id="discovered-element"></span>
</div>

<!-- New audio controls -->
<div id="audio-controls">
  <input type="range" id="volume-slider" min="0" max="100" value="20">
  <button id="mute-button">üîä</button>
</div>

<!-- Background music -->
<audio id="background-music" loop>
  <source src="https://storage.googleapis.com/udio-artifacts-c33fe3ba-3ffe-471f-92c8-5dfef90b3ea3/samples/232797d8e9c5469a9b94bd1c07299178/1/Whispers%2520of%2520Winter%2520ext%2520v1.2.1.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<!-- Selection sound effect -->
<audio id="selection-sfx">
  <source src="https://dl.sndup.net/7v8f2/dry_sfx,_pop.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
const width = window.innerWidth;
const height = window.innerHeight;

const svg = d3.select("#graph-container")
  .append("svg")
    .attr("width", width)
    .attr("height", height);

// Add particles
const particleCount = 50;
const particles = [];
for (let i = 0; i < particleCount; i++) {
  particles.push({
    x: Math.random() * width,
    y: Math.random() * height,
    radius: Math.random() * 2 + 1,
    speedX: Math.random() * 0.5 - 0.25,
    speedY: Math.random() * 0.5 - 0.25
  });
}

svg.selectAll(".particle")
  .data(particles)
  .enter()
  .append("circle")
  .attr("class", "particle")
  .attr("cx", d => d.x)
  .attr("cy", d => d.y)
  .attr("r", d => d.radius);

function moveParticles() {
  svg.selectAll(".particle")
    .each(function(d) {
      d.x += d.speedX;
      d.y += d.speedY;
      
      if (d.x < 0 || d.x > width) d.speedX *= -1;
      if (d.y < 0 || d.y > height) d.speedY *= -1;
      
      d3.select(this)
        .attr("cx", d.x)
        .attr("cy", d.y);
    });
  
  requestAnimationFrame(moveParticles);
}

moveParticles();

const g = svg.append("g");

let zoomLevel = 1;
const zoom = d3.zoom()
  .scaleExtent([0.1, 4])
  .on("zoom", (event) => {
    const newZoomLevel = event.transform.k;
    const zoomFactor = newZoomLevel / zoomLevel;
    zoomLevel = newZoomLevel;

    g.transition()
      .duration(50)
      .ease(d3.easeQuadOut)
      .attr("transform", event.transform);
  });

svg.call(zoom);

const simulation = d3.forceSimulation()
  .force("link", d3.forceLink().id(d => d.id).distance(100))
  .force("charge", d3.forceManyBody().strength(-300))
  .force("center", d3.forceCenter(width / 2, height / 2))
  .force("collision", d3.forceCollide().radius(50));

let nodes = [
  {id: "Poetry", color: "#8B4513"},
  {id: "Novel", color: "#87CEEB"},
  {id: "Story", color: "#FF4500"},
  {id: "Notes", color: "#1E90FF"}
];

let links = [];
let selectedElements = [];

function updateGraph() {
  const link = g.selectAll(".link")
    .data(links)
    .join("line")
      .attr("class", "link");

  const node = g.selectAll(".node")
    .data(nodes)
    .join("g")
      .attr("class", "node")
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

  node.selectAll("circle")
    .data(d => [d])
    .join("circle")
      .attr("r", 40)
      .attr("stroke", d => d.color)
      .attr("fill", "transparent")
      .on("click", handleNodeClick)
      .on("dblclick", handleNodeDoubleClick);

  node.selectAll("text")
    .data(d => [d])
    .join("text")
      .text(d => d.id.toUpperCase())
      .attr("fill", d => d.color);

  simulation.nodes(nodes);
  simulation.force("link").links(links);
  simulation.alpha(1).restart();
  
  updateElementsCount();
  renderElementsList();
}

function dragstarted(event) {
  if (!event.active) simulation.alphaTarget(0.3).restart();
  event.subject.fx = event.subject.x;
  event.subject.fy = event.subject.y;
}

function dragged(event) {
  event.subject.fx = event.x;
  event.subject.fy = event.y;
}

function dragended(event) {
  if (!event.active) simulation.alphaTarget(0);
  event.subject.fx = null;
  event.subject.fy = null;
}

function handleNodeClick(event, d) {
  const index = selectedElements.findIndex(el => el.id === d.id);
  if (index > -1) {
    // Deselect
    selectedElements.splice(index, 1);
    d3.select(this)
      .classed("element-glow", false)
      .classed("dissipate-glow", true)
      .style("color", d.color)
      .on("animationend", function() {
        d3.select(this).classed("dissipate-glow", false).style("color", null);
      });
  } else {
    // Select
    if (selectedElements.length < 2) {
      selectedElements.push(d);
      d3.select(this)
        .classed("dissipate-glow", false)
        .classed("element-glow", true)
        .style("color", d.color);
      playSelectionSFX();
    }
  }

  if (selectedElements.length === 2) {
    craftElements();
  }
}

function handleNodeDoubleClick(event, d) {
  event.preventDefault();
  event.stopPropagation();
  craftElements([d, d]);
}

function showMixingAnimation() {
  const overlay = document.getElementById('mixing-overlay');
  const circle = document.getElementById('mixing-circle');
  overlay.style.opacity = '1';
  circle.style.transform = 'scale(1)';
}

function hideMixingAnimation() {
  const overlay = document.getElementById('mixing-overlay');
  const circle = document.getElementById('mixing-circle');
  overlay.style.opacity = '0';
  circle.style.transform = 'scale(0)';
}

async function craftElements(elements = selectedElements) {
  const [elem1, elem2] = elements;
  
  showMixingAnimation();
  
  try {
    const result = await createNewElement(elem1.id, elem2.id);
    if (!nodes.some(n => n.id === result)) {
      nodes.push({id: result, color: getRandomColor()});
      links.push({source: elem1.id, target: result});
      if (elem1 !== elem2) {
        links.push({source: elem2.id, target: result});
      }
      updateGraph();
      showDiscoveryAnimation(result);
    }
  } catch (error) {
    console.error('Error crafting element:', error);
  } finally {
    hideMixingAnimation();
  }

  // Reset selection and stop glow animation
  g.selectAll("circle")
    .classed("element-glow", false)
    .classed("dissipate-glow", false)
    .style("color", null);
  
  selectedElements = [];
}

async function createNewElement(elem1, elem2) {
  const response = await fetch('https://api.datamuse.com/words?sp=t??k', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ element1: elem1, element2: elem2, temperature: 0.4 }),
  });

  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }

  const data = await response.json();
  return data.result;
}

function getRandomColor() {
  const hue = Math.floor(Math.random() * 360);
  const saturation = 70 + Math.random() * 30; // 70-100%
  const lightness = 40 + Math.random() * 20;  // 40-60%
  return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
}

simulation.on("tick", () => {
  g.selectAll(".link")
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);

  g.selectAll(".node")
    .attr("transform", d => `translate(${d.x},${d.y})`);
});

// Ensure nodes are drawn on top of links
g.append("g").attr("class", "links");
g.append("g").attr("class", "nodes");

function updateElementsCount() {
  document.getElementById('elements-count').textContent = nodes.length;
}

function toggleElementsList() {
  const elementsList = document.getElementById('elements-list');
  if (elementsList.style.right === '0px') {
    elementsList.style.right = '-300px';
  } else {
    elementsList.style.right = '0px';
    renderElementsList();
  }
}

function renderElementsList() {
  const elementsList = document.getElementById('elements-list');
  const searchContainer = document.getElementById('search-container');
  elementsList.innerHTML = '';
  elementsList.appendChild(searchContainer);
  
  nodes.sort((a, b) => a.id.localeCompare(b.id)).forEach(node => {
    const element = document.createElement('div');
    element.className = 'element-item';
    element.textContent = node.id;
    element.style.color = node.color;
    element.addEventListener('click', () => focusOnElement(node));
    elementsList.appendChild(element);
  });
}

function focusOnElement(node) {
  const transform = d3.zoomIdentity
    .translate(width / 2, height / 2)
    .scale(1.5)
    .translate(-node.x, -node.y);

  svg.transition()
    .duration(750)
    .call(zoom.transform, transform);
}

document.getElementById('elements-bar').addEventListener('click', toggleElementsList);

document.getElementById('search-input').addEventListener('input', function(e) {
  const searchTerm = e.target.value.toLowerCase();
  const elements = document.querySelectorAll('.element-item');
  
  elements.forEach(element => {
    const elementName = element.textContent.toLowerCase();
    if (elementName.includes(searchTerm)) {
      element.style.display = 'block';
    } else {
      element.style.display = 'none';
    }
  });
});

// Custom Element Creator
const customElementCreator = document.getElementById('custom-element-creator');
const createCustomElementBtn = document.getElementById('create-custom-element');
const toggleCreatorBtn = document.getElementById('toggle-creator');

toggleCreatorBtn.addEventListener('click', () => {
  if (customElementCreator.style.left === '0px') {
    customElementCreator.style.left = '-300px';
    toggleCreatorBtn.textContent = '‚ûï';
  } else {
    customElementCreator.style.left = '0px';
    toggleCreatorBtn.textContent = '‚úñ';
  }
});

createCustomElementBtn.addEventListener('click', () => {
  const elementName = document.getElementById('custom-element-name').value.trim();
  const elementColor = document.getElementById('custom-element-color').value;

  if (elementName) {
    if (!nodes.some(n => n.id === elementName)) {
      nodes.push({id: elementName, color: elementColor});
      updateGraph();
      document.getElementById('custom-element-name').value = '';
      showDiscoveryAnimation(elementName);
    } else {
      alert('An element with this name already exists!');
    }
  } else {
    alert('Please enter an element name!');
  }
});

// Clear button functionality
document.getElementById('clear-button').addEventListener('click', () => {
  nodes = [];
  links = [];
  updateGraph();
});

function showDiscoveryAnimation(elementName) {
  const discoveryAnimation = document.getElementById('discovery-animation');
  const discoveredElement = document.getElementById('discovered-element');
  
  discoveredElement.textContent = elementName.toUpperCase();
  discoveryAnimation.classList.add('show');
  
  setTimeout(() => {
    discoveryAnimation.classList.remove('show');
  }, 3000);
}

// Background music functionality
const backgroundMusic = document.getElementById('background-music');
const volumeSlider = document.getElementById('volume-slider');
const muteButton = document.getElementById('mute-button');

backgroundMusic.volume = 0.2; // Set initial volume to 20%

volumeSlider.addEventListener('input', (e) => {
  const volume = e.target.value / 100;
  backgroundMusic.volume = volume;
  updateMuteButtonIcon();
});

muteButton.addEventListener('click', () => {
  backgroundMusic.muted = !backgroundMusic.muted;
  updateMuteButtonIcon();
});

function updateMuteButtonIcon() {
  if (backgroundMusic.muted || backgroundMusic.volume === 0) {
    muteButton.textContent = 'üîá';
  } else {
    muteButton.textContent = 'üîä';
  }
}

// Start playing the background music
backgroundMusic.play();

// Selection sound effect functionality
const selectionSFX = document.getElementById('selection-sfx');
selectionSFX.volume = 0.1; // Set initial volume to 10%

function playSelectionSFX() {
  selectionSFX.currentTime = 0; // Reset the audio to the beginning
  selectionSFX.play();
}

updateGraph();
</script>
</body></html
