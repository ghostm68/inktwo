<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>INK REALM DELUXE | Word Processor with AI</title>

<!-- ICONS & FAVICON -->
<link rel="apple-touch-icon" type="image/png" href="https://github.com/ghostm68/pantheon/raw/main/inkrealm.info.2025.png" />
<link rel="shortcut icon" href="./Images/favicon.ico" />

<!-- SCRIPTS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<!-- TRANSFORMERS.JS FOR LOCAL SD -->
<script type="module">
    import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';
    
    // Allow local models and disable cache limits for large models
    env.allowLocalModels = true;
    env.useBrowserCache = true;
    
    // Make pipeline available globally for the main script
    window.transformersPipeline = pipeline;
    window.transformersEnv = env;
</script>
<!-- STANDARD FONTS (Google/Adobe/Icons) -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DejaVu+Sans:wght@400;700&family=DejaVu+Serif:wght@400;700&family=DejaVu+Sans+Mono&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Shadows+Into+Light&display=swap" rel="stylesheet">
<link href="//fonts.cdnfonts.com/css/hardcore-pen" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@league-of-moveable-type/junction@1.0.0/junction.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@league-of-moveable-type/league-gothic@1.0.0/league-gothic.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@league-of-moveable-type/chunk@1.0.0/chunk.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/velvetyne/Millimetre@master/webfonts/Millimetre.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/velvetyne/Steps-Mono@master/webfonts/StepsMono.css" rel="stylesheet">
<link href="https://fonts.cdnfonts.com/css/adobe-text-pro" rel="stylesheet">
<link href="https://fonts.cdnfonts.com/css/adobe-garamond-pro-2" rel="stylesheet">
<!-- THE WEIRD PACK (Experimental, OCR, Glitch) -->
<link href="https://fonts.googleapis.com/css2?family=OCR+A+Extended&family=Syne+Mono&family=Major+Mono+Display&family=Six+Caps&family=Silkscreen&family=DotGothic16&family=Zen+Dots&family=Wallpoet&family=Audiowide&family=Megrim&family=UnifrakturMaguntia&family=Bungee+Outline&display=swap" rel="stylesheet">
<!-- VELVETYNE (Experimental Open Source) -->
<link href="https://cdn.jsdelivr.net/gh/velvetyne/Terminal-Grotesque@master/webfonts/terminal-grotesque.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/gh/velvetyne/Trickster@master/webfonts/trickster.css" rel="stylesheet">	

<style>
/* --- 1. SOVIET PROGRAM FONTS (Corrected Filenames) --- */
@font-face { font-family: 'Ac437 Mindset-2y'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_Mindset-2y.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 EuroPC CGA-2y'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_EuroPC_CGA-2y.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 EuroPC CGA'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_EuroPC_CGA.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 EuroPC Mono'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_EuroPC_Mono.ttf') format('truetype'); }

/* FIXED EVEREX (Matches your repo: Ac437_EverexME_5x8.ttf) */
@font-face { font-family: 'Ac437 EverexME 5x8'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_EverexME_5x8.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 EverexME 7x8'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_EverexME_7x8.ttf') format('truetype'); }

/* FIXED HP 150 (Matches your repo: Ac437_HP_150_re.ttf) */
@font-face { font-family: 'Ac437 HP 150'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_HP_150_re.ttf') format('truetype'); }

@font-face { font-family: 'Ac437 IBM BIOS'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_BIOS.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM CGA-2y'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_CGA-2y.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM CGA'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_CGA.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM CGAthin-2y'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_CGAthin-2y.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM CGAthin'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_CGAthin.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM DOS ISO9-2x'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_DOS_ISO9-2x.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM DOS ISO9'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_DOS_ISO9.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM EGA 8x14-2x'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_EGA_8x14-2x.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM EGA 8x14'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_EGA_8x14.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM EGA 8x8-2x'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_EGA_8x8-2x.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM EGA 8x8'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_EGA_8x8.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 IBM MDA'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_IBM_MDA.ttf') format('truetype'); }
@font-face { font-family: 'Ac437 Mindset-2x'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/Ac437_Mindset-2x.ttf') format('truetype'); }
@font-face { font-family: 'SovietProgram'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/SovietProgram.ttf') format('truetype'); font-weight: normal; font-style: normal; }
@font-face { font-family: 'SovietProgram'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/SovietProgram-Bold.ttf') format('truetype'); font-weight: bold; font-style: normal; }
@font-face { font-family: 'SovietProgram'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/soviet-program/SovietProgram-Italic.ttf') format('truetype'); font-weight: normal; font-style: italic; }

/* --- 2. ADDITIONAL FONTS (Standardized) --- */
@font-face { font-family: 'Perfect DOS VGA 437'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/Perfect%20DOS%20VGA%20437.ttf') format('truetype'); }
@font-face { font-family: 'VT323'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/VT323-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Glass TTY VT220'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/glass-tty-vt220.ttf') format('truetype'); }
@font-face { font-family: 'IBM 3270'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/3270-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Courier Prime'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/CourierPrime-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Inconsolata'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/Inconsolata-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Roboto Mono'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/RobotoMono-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Source Code Pro'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/SourceCodePro-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Fixedsys Excelsior'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/FSEX300.ttf') format('truetype'); }
@font-face { font-family: 'Terminal'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/TerminusTTF-4.49.3.ttf') format('truetype'); }
@font-face { font-family: 'Berkeley Mono'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/BerkeleyMono-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Monocraft'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/Monocraft.ttf') format('truetype'); }
@font-face { font-family: 'IBM Plex Mono'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/IBMPlexMono-Regular.ttf') format('truetype'); }
@font-face { font-family: 'Cascadia Code'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/CascadiaCode.ttf') format('truetype'); }
@font-face { font-family: 'Olivetti'; src: url('https://cdn.jsdelivr.net/gh/ghostm68/inktwo@main/fonts/olivetti-typewriter.ttf') format('truetype'); }

/* SWITZER */
@font-face { font-family: 'Switzer'; src: url('WEB/fonts/Switzer-Regular.ttf') format('truetype'); font-weight: 400; font-style: normal; }
@font-face { font-family: 'Switzer'; src: url('WEB/fonts/Switzer-Bold.ttf') format('truetype'); font-weight: 700; font-style: normal; }
@font-face { font-family: 'Switzer'; src: url('WEB/fonts/Switzer-Italic.ttf') format('truetype'); font-weight: 400; font-style: italic; }

/* EDITOR RESET */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans', sans-serif; background-color: #1a1a1a; color: #e0e0e0; overflow: hidden; }

/* Important: Force the editor to use the selected font */
#editor * { font-family: inherit !important; }
#editor { font-family: 'SovietProgram', monospace; }
/* EDITOR RESET */
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Noto Sans', sans-serif; background-color: #1a1a1a; color: #e0e0e0; overflow: hidden; }

#editor * { font-family: inherit !important; }
#editor { font-family: 'SovietProgram', monospace; }

::-webkit-scrollbar { width: 12px; }
::-webkit-scrollbar-track { background: #2a2a2a; }
::-webkit-scrollbar-thumb { background: #666; border-radius: 6px; }

/* CRT Effect */
#crt-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; opacity: 0.15; }
.scanline { width: 100%; height: 100%; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2)); background-size: 100% 4px; animation: scanline 10s linear infinite; }
@keyframes scanline { 0% { transform: translateY(0); } 100% { transform: translateY(100%); } }

#editor-wrapper { display: flex; flex-direction: column; height: 100dvh; width: 100vw; }

/* Toolbar */
#toolbar { background-color: #2a2a2a; border-bottom: 2px solid #ff0000; padding: 12px 15px; display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
.toolbar-group { display: flex; gap: 4px; align-items: center; padding-right: 8px; border-right: 1px solid #444; }
.toolbar-group:last-child { border-right: none; }
#toolbar select, #toolbar input, #toolbar button { background-color: #333; color: #e0e0e0; border: 1px solid #555; padding: 6px 10px; border-radius: 4px; font-size: 13px; }
#toolbar button { cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
#toolbar button:hover { background-color: #444; border-color: #666; }
#toolbar button .material-symbols-outlined { font-size: 20px; }

/* Editor */
#editor-container { flex: 1; overflow: hidden; display: flex; justify-content: center; background-color: #1a1a1a; padding: 20px; }
#editor { width: 100%; max-width: 1200px; height: 100%; background-color: #222; background-image: url('https://raw.githubusercontent.com/ghostm68/pantheon/main/deluxe12.gif'); background-size: cover; background-attachment: fixed; color: #e0e0e0; border: 2px solid #ff0000; padding: 30px; font-family: 'SovietProgram', monospace; font-size: 16px; line-height: 1.6; overflow-y: auto; outline: none; box-shadow: 0 0 20px rgba(255, 0, 0, 0.3); }
#editor.full-width { max-width: 100%; }

/* Status bar */
#status-bar { background-color: #2a2a2a; border-top: 2px solid #ff0000; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; font-size: 12px; color: #888; }
#quantum-status { font-style: italic; }
#word-count { font-weight: bold; color: #ff0000; }

/* Image blocks */
.image-block { display: inline-block; max-width: 100%; margin: 10px 0; position: relative; }
.image-block img { max-width: 100%; height: auto; border: 2px solid #ff0000; box-shadow: 0 0 10px rgba(255, 0, 0, 0.3); }

/* Progress bar for generation */
.generation-progress { width: 100%; height: 4px; background: #333; margin-top: 10px; border-radius: 2px; overflow: hidden; }
.generation-progress-bar { height: 100%; background: linear-gradient(90deg, #ff0000, #ff6600); width: 0%; transition: width 0.3s; }

/* Model loading indicator */
#model-status { position: fixed; top: 60px; right: 20px; background: #2a2a2a; border: 2px solid #ff0000; padding: 15px; border-radius: 4px; z-index: 10000; display: none; max-width: 300px; }
#model-status.active { display: block; }
#model-status .progress-bar { width: 100%; height: 8px; background: #333; margin-top: 10px; border-radius: 4px; overflow: hidden; }
#model-status .progress-fill { height: 100%; background: #ff0000; width: 0%; transition: width 0.5s; }

/* Code blocks */
.code-block { background-color: #1a1a1a; border: 1px solid #ff0000; border-radius: 4px; padding: 15px; margin: 10px 0; font-family: monospace; color: #00ff00; overflow-x: auto; }

/* Orb */
.orb-container { display: inline-block; vertical-align: middle; margin-right: 15px; width: 50px; height: 50px; position: relative; }
.glitch-orb { width: 100%; height: 100%; fill: none; stroke-width: 3; }
.orb-circle { stroke: #ff0033; }
.orb-triangle { stroke: #ffffff; }
.orb-container svg { animation: slow-spin 10s linear infinite; filter: drop-shadow(0 0 5px rgba(255, 0, 51, 0.4)); }
@keyframes slow-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

#fileInput { display: none; }
</style>
</head>
<body>

<div id="crt-overlay"><div class="scanline"></div></div>

<!-- Model Loading Status -->
<div id="model-status">
    <div id="model-status-text">Initializing local AI...</div>
    <div class="progress-bar"><div class="progress-fill" id="model-progress"></div></div>
    <div id="model-status-sub" style="font-size: 11px; margin-top: 5px; color: #888;"></div>
</div>

<div id="editor-wrapper">
    <div id="toolbar">
        <div class="orb-container">
            <svg class="glitch-orb" viewBox="0 0 100 100">
                <circle class="orb-circle" cx="50" cy="50" r="45" />
                <polygon class="orb-triangle" points="50,25 78,75 22,75" />
            </svg>
        </div>
        
        <div class="toolbar-group">
        <select id="fontSelector">
        <option value="'SovietProgram', monospace">Soviet Program</option>
        <option value="'SovietProgram Thin', monospace">Soviet Program Thin</option>
        <option value="'SovietProgram Light', monospace">Soviet Program Light</option>
        <option value="'Ac437 IBM CGA', monospace">Ac437 IBM CGA</option>
        <option value="'Ac437 Mindset-2y', monospace">Ac437 Mindset-2y</option>
        <option value="'Ac437 IBM EGA 8x14', monospace">Ac437 IBM EGA 8x14</option>
        <option value="'Ac437 IBM EGA 9x14', monospace">Ac437 IBM EGA 9x14</option>
        <option value="'Ac437 IBM MDA', monospace">Ac437 IBM MDA</option>
        <option value="'Ac437 IBM BIOS', monospace">Ac437 IBM BIOS</option>
        <option value="'Ac437 IBM CGA-2y', monospace">Ac437 IBM CGA-2y</option>
        <option value="'Ac437 IBM CGAthin', monospace">Ac437 IBM CGAthin</option>
        <option value="'Ac437 EuroPC CGA', monospace">Ac437 EuroPC CGA</option>
        <option value="'Ac437 EuroPC CGA-2y', monospace">Ac437 EuroPC CGA-2y</option>
        <option value="'Ac437 EuroPC Mono', monospace">Ac437 EuroPC Mono</option>
        <!-- FIXED EVEREX -->
        <option value="'Ac437 EverexME 5x8', monospace">Ac437 EverexME 5x8</option>
        <option value="'Ac437 EverexME 7x8', monospace">Ac437 EverexME 7x8</option>
        <!-- FIXED HP -->
        <option value="'Ac437 HP 150', monospace">Ac437 HP 150</option>
        <option value="'Ac437 IBM DOS ISO9-2x', monospace">Ac437 IBM DOS ISO9-2x</option>
        <option value="'Ac437 IBM DOS ISO9', monospace">Ac437 IBM DOS ISO9</option>
        <option value="'Ac437 IBM EGA 8x14-2x', monospace">Ac437 IBM EGA 8x14-2x</option>
        <option value="'Ac437 IBM EGA 8x8-2x', monospace">Ac437 IBM EGA 8x8-2x</option>
        <option value="'Ac437 IBM EGA 8x8', monospace">Ac437 IBM EGA 8x8</option>
        <option value="'Ac437 Mindset-2x', monospace">Ac437 Mindset-2x</option>
        <option value="'Perfect DOS VGA 437', monospace">Perfect DOS VGA 437</option>
        <option value="'VT323', monospace">VT323</option>
        <option value="'Glass TTY VT220', monospace">Glass TTY VT220</option>
        <option value="'IBM 3270', monospace">IBM 3270</option>
        <option value="'Courier Prime', monospace">Courier Prime</option>
        <option value="'Inconsolata', monospace">Inconsolata</option>
        <option value="'Roboto Mono', monospace">Roboto Mono</option>
        <option value="'Source Code Pro', monospace">Source Code Pro</option>
        <option value="'Fixedsys Excelsior', monospace">Fixedsys Excelsior</option>
        <option value="'Terminal', monospace">Terminal</option>
        <option value="'Berkeley Mono', monospace">Berkeley Mono</option>
        <option value="'Monocraft', monospace">Monocraft</option>
        <option value="'IBM Plex Mono', monospace">IBM Plex Mono</option>
        <option value="'Cascadia Code', monospace">Cascadia Code</option>
        <option value="'Olivetti', monospace">Olivetti Typewriter</option>
        <option value="'Noto Sans', sans-serif">Noto Sans</option>
        <option value="'DejaVu Sans', sans-serif">DejaVu Sans</option>
        <option value="'DejaVu Serif', serif">DejaVu Serif</option>
        <option value="'DejaVu Sans Mono', monospace">DejaVu Sans Mono</option>
        <option value="'Switzer', sans-serif">Switzer</option>
        <!-- HANDWRITTEN/ARTISTIC -->
        <option value="'Permanent Marker', cursive">Permanent Marker</option>
        <option value="'Indie Flower', cursive">Indie Flower</option>
        <option value="'Shadows Into Light', cursive">Shadows Into Light</option>
        <option value="'Hardcore Pen', cursive">Hardcore Pen</option>
        <!-- MODERN CODING -->
        <option value="'Fira Code', monospace">Fira Code</option>
        <option value="'JetBrains Mono', monospace">JetBrains Mono</option>
        <option value="'Space Mono', monospace">Space Mono</option>
        <!-- TYPEWRITER -->
        <option value="'Special Elite', cursive">Special Elite</option>
        <!-- THE LEAGUE / VELVETYNE -->
        <option value="'Junction', sans-serif">Junction</option>
        <option value="'League Gothic', sans-serif">League Gothic</option>
        <option value="'Chunk', serif">Chunk</option>
        <option value="'Millimetre', sans-serif">Millimetre</option>
        <option value="'Steps Mono', monospace">Steps Mono</option>
        <!-- ADOBE SERIF -->
        <option value="'Adobe Text Pro', serif">Adobe Text Pro</option>
        <option value="'Adobe Garamond Pro', serif">Adobe Garamond Pro</option>	
		<option value="disabled" disabled>--- EXOTIC / EXPERIMENTAL ---</option>
        
        <!-- MACHINE / DATA -->
        <option value="'OCR A Extended', monospace">OCR-A (Machine Readable)</option>
        <option value="'Terminal Grotesque', monospace">Terminal Grotesque</option>
        <option value="'DotGothic16', sans-serif">DotGothic16 (ATM Interface)</option>
        
        <!-- WILD / DISPLAY -->
        <option value="'Six Caps', sans-serif">Six Caps (Brutalist Tall)</option>
        <option value="'Bungee Outline', cursive">Bungee Outline</option>
        <option value="'Wallpoet', cursive">Wallpoet (Stencil)</option>
        
        <!-- WEIRD / ART HOUSE -->
        <option value="'Syne Mono', monospace">Syne Mono</option>
        <option value="'Megrim', cursive">Megrim (Experimental)</option>
        <option value="'Major Mono Display', monospace">Major Mono Display (Glitch)</option>
        <option value="'Trickster', sans-serif">Trickster (Medieval-Cyber)</option>
        
        <!-- RETRO FUTURISM -->
        <option value="'Silkscreen', cursive">Silkscreen (Pixel)</option>
        <option value="'Zen Dots', cursive">Zen Dots</option>
        <option value="'Audiowide', cursive">Audiowide (HUD)</option>
        
        <!-- ANCIENT -->
        <option value="'UnifrakturMaguntia', cursive">Unifraktur (Dark Gothic)</option>
    </select>
            <input type="number" id="fontSize" min="8" max="48" value="16">
        </div>

        <div class="toolbar-group">
            <button id="boldButton" title="Bold"><span class="material-symbols-outlined">format_bold</span></button>
            <button id="italicButton" title="Italic"><span class="material-symbols-outlined">format_italic</span></button>
            <button id="underlineButton" title="Underline"><span class="material-symbols-outlined">format_underlined</span></button>
        </div>

        <div class="toolbar-group">
            <button id="alignLeft"><span class="material-symbols-outlined">format_align_left</span></button>
            <button id="alignCenter"><span class="material-symbols-outlined">format_align_center</span></button>
            <button id="alignRight"><span class="material-symbols-outlined">format_align_right</span></button>
        </div>

        <div class="toolbar-group">
            <button id="undoButton"><span class="material-symbols-outlined">undo</span></button>
            <button id="redoButton"><span class="material-symbols-outlined">redo</span></button>
        </div>

        <div class="toolbar-group">
            <button id="addCodeBlock"><span class="material-symbols-outlined">code</span></button>
            <button id="uploadButton"><span class="material-symbols-outlined">upload</span></button>
        </div>

        <!-- LOCAL AI IMAGE GENERATION -->
        <div class="toolbar-group">
            <select id="aiModelSelector" title="Local AI Model">
                <option value="Xenova/stable-diffusion-turbo" selected>SD Turbo (Fastest)</option>
                <option value="Xenova/stable-diffusion-v1-5">SD v1.5 (Quality)</option>
                <option value="Xenova/stable-diffusion-2-1">SD 2.1 (Balanced)</option>
                <option value="Xenova/sdxl-turbo">SDXL Turbo (High Res Fast)</option>
            </select>
            <button id="generateImage" title="Generate AI Image Locally" style="background-color: #ff0000; border-color: #ff0000;">
                <span class="material-symbols-outlined">auto_awesome</span>
            </button>
            <button id="loadModelBtn" title="Pre-load Model" style="background-color: #333;">
                <span class="material-symbols-outlined">download</span>
            </button>
        </div>

        <div class="toolbar-group">
            <button id="toggleWidth"><span class="material-symbols-outlined">open_in_full</span></button>
            <button id="copySelectedBlocks"><span class="material-symbols-outlined">content_copy</span></button>
        </div>
    </div>

    <div id="editor-container">
        <div id="editor" contenteditable="true" spellcheck="true">
            <p style="color: #888; font-style: italic;">
                Welcome to INK REALM DELUXE with Local AI<br><br>
                
                <strong>ðŸ§  LOCAL AI IMAGE GENERATION:</strong><br>
                â€¢ Select text describing the image you want<br>
                â€¢ Choose model: SD Turbo (fastest) or SDXL Turbo (higher quality)<br>
                â€¢ Click the âœ¨ button to generate - runs entirely in your browser!<br>
                â€¢ First generation downloads ~1-2GB model (cached for future use)<br>
                â€¢ No API keys, no servers, completely private<br><br>
                
                <strong>Pre-load Model:</strong> Click download button to cache model before generating<br><br>
                
                Start typing to replace this text...
            </p>
        </div>
    </div>

    <div id="status-bar">
        <div id="quantum-status">Quantum circuit: Ready</div>
        <div id="word-count">0 words</div>
        <div>
            <button id="saveButton" style="background: #555; border: none; padding: 6px 15px; border-radius: 4px; color: white; cursor: pointer; margin-right: 8px;">Save</button>
            <button id="downloadTxt" style="background: #666; border: none; padding: 6px 15px; border-radius: 4px; color: white; cursor: pointer; margin-right: 8px;">Download TXT</button>
            <button id="downloadPdf" style="background: #777; border: none; padding: 6px 15px; border-radius: 4px; color: white; cursor: pointer;">Download PDF</button>
        </div>
    </div>
</div>

<input type="file" id="fileInput" accept="image/*">

<script type="module">
import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

// Configure environment
env.allowLocalModels = true;
env.useBrowserCache = true;
env.backends.onnx.wasm.numThreads = navigator.hardwareConcurrency || 4;

// Global state
let currentGenerator = null;
let currentModel = null;
let isGenerating = false;

// DOM elements
const editor = document.getElementById('editor');
const fontSelector = document.getElementById('fontSelector');
const fontSize = document.getElementById('fontSize');
const quantumStatus = document.getElementById('quantum-status');
const wordCount = document.getElementById('word-count');
const modelStatus = document.getElementById('model-status');
const modelStatusText = document.getElementById('model-status-text');
const modelStatusSub = document.getElementById('model-status-sub');
const modelProgress = document.getElementById('model-progress');
const aiModelSelector = document.getElementById('aiModelSelector');

// Show model loading status
function showModelStatus(text, subtext = '', progress = 0) {
    modelStatus.classList.add('active');
    modelStatusText.textContent = text;
    modelStatusSub.textContent = subtext;
    modelProgress.style.width = progress + '%';
}

function hideModelStatus() {
    setTimeout(() => {
        modelStatus.classList.remove('active');
    }, 1000);
}

// Initialize or get pipeline
async function getGenerator(modelName, progressCallback = null) {
    if (currentGenerator && currentModel === modelName) {
        return currentGenerator;
    }
    
    showModelStatus('Loading AI model...', 'Downloading weights (1-2GB)...', 0);
    
    try {
        const generator = await pipeline('text-to-image', modelName, {
            dtype: 'fp16',
            device: 'webgpu',
            progress_callback: (progress) => {
                if (progressCallback) progressCallback(progress);
                const percent = Math.round(progress.progress * 100);
                showModelStatus(
                    'Loading AI model...', 
                    `Downloading: ${progress.file || 'weights'}...`, 
                    percent
                );
            }
        });
        
        currentGenerator = generator;
        currentModel = modelName;
        
        showModelStatus('Model ready!', '', 100);
        hideModelStatus();
        
        return generator;
    } catch (err) {
        showModelStatus('Failed to load model', err.message, 0);
        console.error('Model load error:', err);
        throw err;
    }
}

// Font controls
fontSelector.addEventListener('change', () => {
    editor.style.fontFamily = fontSelector.value;
    editor.focus();
});

fontSize.addEventListener('input', () => {
    editor.style.fontSize = `${fontSize.value}px`;
});

// Text formatting
document.getElementById('boldButton').addEventListener('click', () => {
    document.execCommand('bold', false, null);
    editor.focus();
});

document.getElementById('italicButton').addEventListener('click', () => {
    document.execCommand('italic', false, null);
    editor.focus();
});

document.getElementById('underlineButton').addEventListener('click', () => {
    document.execCommand('underline', false, null);
    editor.focus();
});

// Alignment
document.getElementById('alignLeft').addEventListener('click', () => {
    document.execCommand('justifyLeft', false, null);
    editor.focus();
});

document.getElementById('alignCenter').addEventListener('click', () => {
    document.execCommand('justifyCenter', false, null);
    editor.focus();
});

document.getElementById('alignRight').addEventListener('click', () => {
    document.execCommand('justifyRight', false, null);
    editor.focus();
});

// Undo/Redo
document.getElementById('undoButton').addEventListener('click', () => {
    document.execCommand('undo', false, null);
    editor.focus();
});

document.getElementById('redoButton').addEventListener('click', () => {
    document.execCommand('redo', false, null);
    editor.focus();
});

// Add code block
document.getElementById('addCodeBlock').addEventListener('click', () => {
    const codeBlock = '<div class="code-block" contenteditable="true">// Enter code here...</div><p><br></p>';
    document.execCommand('insertHTML', false, codeBlock);
    editor.focus();
});

// Image upload
document.getElementById('uploadButton').addEventListener('click', () => {
    document.getElementById('fileInput').click();
});

document.getElementById('fileInput').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = `<div class="image-block"><img src="${event.target.result}" alt="Uploaded image"></div><p><br></p>`;
            document.execCommand('insertHTML', false, img);
            editor.focus();
        };
        reader.readAsDataURL(file);
    }
});

// Toggle width
document.getElementById('toggleWidth').addEventListener('click', () => {
    editor.classList.toggle('full-width');
});

// Copy
document.getElementById('copySelectedBlocks').addEventListener('click', () => {
    document.execCommand('copy');
    quantumStatus.textContent = 'Text copied to quantum clipboard';
    setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 2000);
});

// Pre-load model button
document.getElementById('loadModelBtn').addEventListener('click', async () => {
    const model = aiModelSelector.value;
    try {
        quantumStatus.textContent = 'Pre-loading model...';
        await getGenerator(model);
        quantumStatus.textContent = 'Model cached and ready âœ“';
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 3000);
    } catch (err) {
        quantumStatus.textContent = 'Model load failed: ' + err.message;
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 5000);
    }
});

// AI Image Generation - LOCAL ONLY
document.getElementById('generateImage').addEventListener('click', async () => {
    if (isGenerating) {
        quantumStatus.textContent = 'Generation already in progress...';
        return;
    }

    const selectedText = window.getSelection().toString().trim();
    if (!selectedText) {
        quantumStatus.textContent = 'Select text to generate image from';
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 2000);
        return;
    }

    const selectedModel = aiModelSelector.value;
    isGenerating = true;
    
    try {
        quantumStatus.textContent = 'Initializing local AI...';
        
        // Get or create generator
        const generator = await getGenerator(selectedModel);
        
        quantumStatus.textContent = 'Generating image locally...';
        
        // Determine settings based on model
        const isTurbo = selectedModel.includes('turbo');
        const width = selectedModel.includes('xl') ? 1024 : 512;
        const height = selectedModel.includes('xl') ? 1024 : 512;
        const steps = isTurbo ? 1 : 25;
        
        // Generate image
        const result = await generator(selectedText, {
            width: width,
            height: height,
            num_inference_steps: steps,
            guidance_scale: isTurbo ? 0.0 : 7.5,
        });
        
        // Convert blob to data URL
        const blob = result;
        const imageUrl = URL.createObjectURL(blob);
        
        // Create image element
        const img = document.createElement('img');
        img.src = imageUrl;
        img.alt = selectedText;
        img.style.maxWidth = '100%';
        img.style.height = 'auto';
        
        // Wrap and insert
        const wrapper = document.createElement('div');
        wrapper.className = 'image-block';
        wrapper.appendChild(img);
        wrapper.innerHTML += '<p><br></p>';
        
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();
            range.insertNode(wrapper);
        } else {
            editor.appendChild(wrapper);
        }
        
        quantumStatus.textContent = 'Image materialized locally âœ¨';
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 3000);
        
    } catch (err) {
        console.error('[INK REALM] Local generation error:', err);
        
        let errorMsg = 'âš ï¸ Generation failed: ';
        if (err.message && err.message.includes('webgpu')) {
            errorMsg += 'WebGPU not available - use Chrome/Edge';
        } else if (err.message && err.message.includes('out of memory')) {
            errorMsg += 'Out of memory - try SD Turbo model';
        } else {
            errorMsg += err.message || 'Unknown error';
        }
        
        quantumStatus.textContent = errorMsg;
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 5000);
    } finally {
        isGenerating = false;
    }
});

// Word count
function updateWordCount() {
    const text = editor.innerText || editor.textContent;
    const words = text.trim().split(/\s+/).filter(w => w.length > 0);
    wordCount.textContent = `${words.length} words`;
}
editor.addEventListener('input', updateWordCount);

// Save/Load
function saveDocument() {
    localStorage.setItem('quantumDocument', editor.innerHTML);
    quantumStatus.textContent = 'Document saved to local storage';
    setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 2000);
}

document.getElementById('saveButton').addEventListener('click', saveDocument);

// Load saved
const savedDoc = localStorage.getItem('quantumDocument');
if (savedDoc) {
    editor.innerHTML = savedDoc;
    updateWordCount();
}

// Download TXT
document.getElementById('downloadTxt').addEventListener('click', () => {
    const text = editor.innerText || editor.textContent;
    if (!text.trim()) {
        quantumStatus.textContent = 'Nothing to download';
        return;
    }
    const blob = new Blob([text], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'ink-realm-document.txt';
    a.click();
    URL.revokeObjectURL(url);
    quantumStatus.textContent = 'TXT downloaded';
    setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 2000);
});

// Download PDF
document.getElementById('downloadPdf').addEventListener('click', async () => {
    quantumStatus.textContent = 'Generating PDF...';
    try {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'pt', 'a4');
        await doc.html(editor, {
            callback: function(doc) {
                doc.save('ink-realm-deluxe.pdf');
                quantumStatus.textContent = 'PDF generated';
            },
            x: 10,
            y: 10,
            width: 575,
            windowWidth: editor.scrollWidth
        });
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 2000);
    } catch (err) {
        quantumStatus.textContent = 'PDF generation failed';
        setTimeout(() => quantumStatus.textContent = 'Quantum circuit: Ready', 3000);
    }
});

// Keyboard shortcuts
editor.addEventListener('keydown', (e) => {
    if (e.ctrlKey || e.metaKey) {
        switch(e.key.toLowerCase()) {
            case 'b':
                e.preventDefault();
                document.execCommand('bold', false, null);
                break;
            case 'i':
                e.preventDefault();
                document.execCommand('italic', false, null);
                break;
            case 's':
                e.preventDefault();
                saveDocument();
                break;
        }
    }
});

updateWordCount();
</script>

</body>
</html>
