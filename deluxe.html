<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Literary Elements Graph</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
  font-family: Arial, sans-serif;
  background-color: #1a1a1a;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  overflow: hidden;
  user-select: none;
}

#graph-container {
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
}

.node circle {
  fill: transparent;
  stroke-width: 3px;
  cursor: pointer;
  transition: all 0.3s ease;
}

.node:hover circle {
  transform: scale(1.2);
}

.node text {
  font-size: 12px;
  text-anchor: middle;
  dominant-baseline: middle;
  pointer-events: none;
  text-transform: uppercase;
  fill: white; /* Added fill color for visibility */
}

.link {
  stroke: #999;
  stroke-opacity: 0.6;
  stroke-dasharray: 5, 5;
}

.particle {
  fill: #2a2a2a;
  opacity: 0.7;
}

@keyframes glow {
  0% {
    filter: drop-shadow(0 0 2px currentColor) drop-shadow(0 0 4px currentColor);
  }
  50% {
    filter: drop-shadow(0 0 3px currentColor) drop-shadow(0 0 6px currentColor) drop-shadow(0 0 9px currentColor);
  }
  100% {
    filter: drop-shadow(0 0 2px currentColor) drop-shadow(0 0 4px currentColor);
  }
}

.element-glow {
  animation: glow 2s ease-in-out infinite;
}

@keyframes dissipate {
  0% {
    filter: drop-shadow(0 0 3px currentColor) drop-shadow(0 0 6px currentColor) drop-shadow(0 0 9px currentColor);
  }
  100% {
    filter: none;
  }
}

.dissipate-glow {
  animation: dissipate 0.5s ease-out forwards;
}

#mixing-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
}

#mixing-circle {
  width: 200px;
  height: 200px;
  background-color: #1a1a1a;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  transform: scale(0);
  transition: transform 0.3s ease;
}

#mixing-text {
  color: white;
  font-size: 18px;
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: 'Work Sans', sans-serif;
  font-weight: 700;
  text-transform: uppercase;
}

#elements-bar {
  position: fixed;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(26, 26, 26, 0.8);
  backdrop-filter: blur(10px);
  color: white;
  padding: 10px 20px;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 14px;
  letter-spacing: 1px;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}

#elements-bar:hover {
  background-color: rgba(40, 40, 40, 0.8);
}

#elements-list {
  position: fixed;
  top: 0;
  right: -300px;
  width: 300px;
  height: 100%;
  background-color: rgba(26, 26, 26, 0.9);
  backdrop-filter: blur(10px);
  color: white;
  overflow-y: auto;
  transition: right 0.3s ease;
  box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
}

.element-item {
  padding: 15px;
  font-size: 14px;
  letter-spacing: 0.5px;
  transition: background-color 0.2s ease;
  font-weight: bold;
  border-bottom: 1px solid rgba(255, 255, 255, 0.2); /* Added border for better separation */
}

.element-item:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

#search-container {
  padding: 15px;
  position: sticky;
  top: 0;
  background-color: rgba(26, 26, 26, 0.9);
  z-index: 1;
}

#search-box {
  display: flex;
  align-items: center;
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 5px 10px;
}

#search-input {
  flex-grow: 1;
  background: none;
  border: none;
  color: #ccc;
  font-family: 'Work Sans', sans-serif;
  font-weight: 700;
  font-size: 14px;
  padding: 5px;
}

#search-input::placeholder {
  color: #888;
}

#search-input:focus {
  outline: none;
}

#search-icon {
  width: 20px;
  height: 20px;
  fill: #888;
}

#custom-element-creator {
  position: fixed;
  top: 0;
  left: -300px;
  width: 250px;
  height: 100%;
  background-color: rgba(26, 26, 26, 0.8);
  backdrop-filter: blur(10px);
  color: white;
  padding: 20px;
  transition: left 0.3s ease;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  z-index: 1000;
}

#custom-element-creator h3 {
  margin: 0 0 20px 0;
  color: #fff;
  font-family: 'Work Sans', sans-serif;
  font-weight: 700;
  font-size: 18px;
  text-transform: uppercase;
}

#custom-element-creator input[type="text"] {
  width: 100%;
  padding: 10px;
  margin-bottom: 15px;
  border: none;
  border-radius: 5px;
  background-color: rgba(255, 255, 255, 0.1);
  color: #fff;
  font-family: 'Work Sans', sans-serif;
  font-weight: 400;
  box-sizing: border-box;
}

#custom-element-creator input[type="color"] {
  width: 100%;
  height: 40px;
  border: none;
  border-radius: 5px;
  background-color: rgba(255, 255, 255, 0.1);
  margin-bottom: 15px;
  cursor: pointer;
}

#custom-element-creator button {
  width: 100%;
  padding: 10px;
  border: none;
  border-radius: 5px;
  background-color: #4CAF50;
  color: #fff;
  font-family: 'Work Sans', sans-serif;
  font-weight: 700;
  text-transform: uppercase;
  cursor: pointer;
}

#toggle-creator {
  position: fixed;
  top: 20px;
  left: 20px;
  background-color: rgba(26, 26, 26, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 20px;
  cursor: pointer;
  z-index: 1001;
  transition: transform 0.3s ease;
}

#toggle-creator:hover {
  transform: scale(1.1);
}

#clear-button {
  position: fixed;
  bottom: 20px;
  right: 20px;
  font-size: 36px;
  background: rgba(26, 26, 26, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  cursor: pointer;
  z-index: 1001;
}

#clear-button:hover {
  background: rgba(40, 40, 40, 0.8);
}

#discovery-animation {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 300px;
  height: 300px;
  background-color: rgba(0, 0, 0, 0.7);
  border-radius: 50%;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 1000;
}

#discovery-animation.active {
  opacity: 1;
  animation: expand 1s forwards;
}

@keyframes expand {
  0% {
    transform: scale(0);
  }
  100% {
    transform: scale(1);
  }
}

/* Container for buttons */
.button-container {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
}

/* Glowing and breathing button styles */
.glowy-button {
  background-color: #333;
  color: #fff;
  border: none;
  border-radius: 50%;
  padding: 20px;
  font-size: 24px;
  cursor: pointer;
  position: relative;
  outline: none;
  box-shadow: 0 0 10px rgba(0, 255, 0, 0.8); /* Initial glowing effect */
  transition: box-shadow 0.3s; /* Smooth transition for glow */
  animation: breathe 2s infinite; /* Breathing animation */
}

/* Breathe animation keyframes */
@keyframes breathe {
  0% {
    transform: translateX(-50%) scale(1);
  }
  50% {
    transform: translateX(-50%) scale(1.05);
  }
  100% {
    transform: translateX(-50%) scale(1);
  }
}

/* Hover effect for extra glow */
.glowy-button:hover {
  box-shadow: 0 0 20px rgba(0, 255, 0, 1); /* Enhanced glowing on hover */
}

.glowy-button:active {
  transform: scale(0.9); /* Button press effect */
}

/* Optional: Add outer glow effect */
.glowy-button::before {
  content: '';
  position: absolute;
  top: -5px;
  left: -5px;
  right: -5px;
  bottom: -5px;
  border-radius: 50%;
  border: 2px solid rgba(0, 255, 0, 0.8); /* Outer glow */
  opacity: 0.5;
  transition: opacity 0.3s;
}

.glowy-button:hover::before {
  opacity: 1; /* Outer glow intensifies on hover */
}
 </style>
</head>
<body>
  <body>
<body>
  <!-- Overlay and mixing circle -->
  <div id="mixing-overlay">
    <div id="mixing-circle">
      <div id="mixing-text">MIXING...</div>
    </div>
  </div>

  <!-- Elements Bar -->
  <div id="elements-bar" style="text-align: center; font-family: 'Montserrat', sans-serif; text-transform: uppercase;">
    <span id="elements-count" style="font-size: 24px; font-weight: bold; font-family: 'Arial Black', Gadget, sans-serif;">4</span><br>
    Discovered Elements
  </div>

  <!-- Elements List -->
  <div id="elements-list" style="border: 2px solid #444; box-shadow: 0 0 10px rgba(68, 68, 68, 0.5); font-family: 'Oswald', sans-serif; font-weight: bold; text-transform: uppercase;">
    <div id="search-container">
      <div id="search-box">
        <input type="text" id="search-input" placeholder="Search elements">
        <svg id="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: #555;">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
        </svg>
      </div>
    </div>
    <!-- Add more elements here as needed -->
  </div>

  <!-- Buttons -->
  <div id="buttons-container" style="text-align: center; margin-top: 20px;">
    <button id="plus-button" class="glow-button">+</button>
    <button id="discover-button" class="glow-button">Discover</button>
    <button id="clear-button" class="glow-button">
      <svg id="broom-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width: 24px; height: 24px; fill: #555;">
        <path d="M12 2v2h-1v2h2V4h-1zm0 4h-2v2h2V6zm-4 0H6v2h2V6zm0 4h2v2H8v-2zm-2 2H4v2h2v-2zm0 4v2h2v-2H6zm4-4v2h-2v-2h2zm-2 6h2v2h-2v-2zm-4 0h2v2H4v-2zm6-10h2V6h-2v2zm6 6h-2v2h2v-2zm0-4v2h-2v-2h2zm-2-2v2h-2v-2h2zM2 6h2V4H2v2zM4 2h2V0H4v2zm6-2v2H8V0h2zm4 6h-2v2h2V6zm-6 4h2v-2H8v2z"></path>
      </svg>
    </button>
  </div>
</body>

</body>


 <script>
   document.addEventListener('DOMContentLoaded', function() {
  // Discover button functionality
  document.getElementById('discover-button').addEventListener('click', function() {
    console.log('Discover button clicked');
    // Handle "Discover" action
    alert('Discover button clicked!');
  });

  // Plus button functionality
  document.getElementById('plus-button').addEventListener('click', function() {
    console.log('Plus button clicked');
    // Handle "+" action
    let countElement = document.getElementById('elements-count');
    let currentCount = parseInt(countElement.innerText, 10);
    countElement.innerText = currentCount + 1;
  });

  // Clear button functionality
  document.getElementById('clear-button').addEventListener('click', function() {
    console.log('Clear button clicked');
    nodes = [];
    links = [];
    updateGraph();
  });

  // Setup D3 visualization
  const width = window.innerWidth;
  const height = window.innerHeight;

  const svg = d3.select("#graph-container")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  // Add particles
  const particleCount = 50;
  const particles = [];
  for (let i = 0; i < particleCount; i++) {
    particles.push({
      x: Math.random() * width,
      y: Math.random() * height,
      radius: Math.random() * 2 + 1,
      speedX: Math.random() * 0.5 - 0.25,
      speedY: Math.random() * 0.5 - 0.25
    });
  }

  svg.selectAll(".particle")
    .data(particles)
    .enter()
    .append("circle")
    .attr("class", "particle")
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .attr("r", d => d.radius);

  function moveParticles() {
    svg.selectAll(".particle")
      .each(function(d) {
        d.x += d.speedX;
        d.y += d.speedY;

        if (d.x < 0 || d.x > width) d.speedX *= -1;
        if (d.y < 0 || d.y > height) d.speedY *= -1;

        d3.select(this)
          .attr("cx", d.x)
          .attr("cy", d.y);
      });

    requestAnimationFrame(moveParticles);
  }

  moveParticles();

  const g = svg.append("g");

  let zoomLevel = 1;
  const zoom = d3.zoom()
    .scaleExtent([0.1, 4])
    .on("zoom", (event) => {
      const newZoomLevel = event.transform.k;
      const zoomFactor = newZoomLevel / zoomLevel;
      zoomLevel = newZoomLevel;

      g.transition()
        .duration(50)
        .ease(d3.easeQuadOut)
        .attr("transform", event.transform);
    });

  svg.call(zoom);

  const simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(d => d.id).distance(100))
    .force("charge", d3.forceManyBody().strength(-300))
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("collision", d3.forceCollide().radius(50));

  let nodes = [
    {id: "Earth", color: "#8B4513"},
    {id: "Wind", color: "#87CEEB"},
    {id: "Fire", color: "#FF4500"},
    {id: "Water", color: "#1E90FF"}
  ];

  let links = [];
  let selectedElements = [];

  function updateGraph() {
    const link = g.selectAll(".link")
      .data(links)
      .join("line")
      .attr("class", "link");

    const node = g.selectAll(".node")
      .data(nodes)
      .join("g")
      .attr("class", "node")
      .call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

    node.selectAll("circle")
      .data(d => [d])
      .join("circle")
      .attr("r", 40)
      .attr("stroke", d => d.color)
      .attr("fill", "transparent")
      .on("click", handleNodeClick)
      .on("dblclick", handleNodeDoubleClick);

    node.selectAll("text")
      .data(d => [d])
      .join("text")
      .text(d => d.id.toUpperCase())
      .attr("fill", d => d.color);

    simulation.nodes(nodes);
    simulation.force("link").links(links);
    simulation.alpha(1).restart();

    updateElementsCount();
    renderElementsList();
  }

  function dragstarted(event) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    event.subject.fx = event.subject.x;
    event.subject.fy = event.subject.y;
  }

  function dragged(event) {
    event.subject.fx = event.x;
    event.subject.fy = event.y;
  }

  function dragended(event) {
    if (!event.active) simulation.alphaTarget(0);
    event.subject.fx = null;
    event.subject.fy = null;
  }

  function handleNodeClick(event, d) {
    const index = selectedElements.findIndex(el => el.id === d.id);
    if (index > -1) {
      // Deselect
      selectedElements.splice(index, 1);
      d3.select(this)
        .classed("element-glow", false)
        .classed("dissipate-glow", true)
        .style("color", d.color)
        .on("animationend", function() {
          d3.select(this).classed("dissipate-glow", false).style("color", null);
        });
    } else {
      // Select
      if (selectedElements.length < 2) {
        selectedElements.push(d);
        d3.select(this)
          .classed("dissipate-glow", false)
          .classed("element-glow", true)
          .style("color", d.color);
        playSelectionSFX();
      }
    }

    if (selectedElements.length === 2) {
      craftElements();
    }
  }

  function handleNodeDoubleClick(event, d) {
    event.preventDefault();
    event.stopPropagation();
    craftElements([d, d]);
  }

  function showMixingAnimation() {
    const overlay = document.getElementById('mixing-overlay');
    const circle = document.getElementById('mixing-circle');
    overlay.style.opacity = '1';
    circle.style.transform = 'scale(1)';
  }

  function hideMixingAnimation() {
    const overlay = document.getElementById('mixing-overlay');
    const circle = document.getElementById('mixing-circle');
    overlay.style.opacity = '0';
    circle.style.transform = 'scale(0)';
  }

  async function craftElements(elements = selectedElements) {
    const [elem1, elem2] = elements;

    showMixingAnimation();

    try {
      const result = await createNewElement(elem1.id, elem2.id);
      if (!nodes.some(n => n.id === result)) {
        nodes.push({id: result, color: getRandomColor()});
        links.push({source: elem1.id, target: result});
        if (elem1 !== elem2) {
          links.push({source: elem2.id, target: result});
        }
        updateGraph();
        showDiscoveryAnimation(result);
      }
    } catch (error) {
      console.error('Error crafting element:', error);
    } finally {
      hideMixingAnimation();
    }

    // Reset selection and stop glow animation
    g.selectAll("circle")
      .classed("element-glow", false)
      .classed("dissipate-glow", false)
      .style("color", null);

    selectedElements = [];
  }

  async function createNewElement(elem1, elem2) {
    const response = await fetch('/api/craft', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ element1: elem1, element2: elem2, temperature: 0.4 }),
    });

    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const data = await response.json();
    return data.result;
  }

  function getRandomColor() {
    const hue = Math.floor(Math.random() * 360);
    const saturation = 70 + Math.random() * 30; // 70-100%
    const lightness = 40 + Math.random() * 20;  // 40-60%
    return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
  }

  simulation.on("tick", () => {
    g.selectAll(".link")
      .attr("x1", d => d.source.x)
      .attr("y1", d => d.source.y)
      .attr("x2", d => d.target.x)
      .attr("y2", d => d.target.y);

    g.selectAll(".node")
      .attr("transform", d => `translate(${d.x},${d.y})`);
  });

  function updateElementsCount() {
    document.getElementById('elements-count').innerText = nodes.length;
  }

  function renderElementsList() {
    const listContainer = document.getElementById('elements-list');
    listContainer.innerHTML = '';
    nodes.forEach(node => {
      const listItem = document.createElement('li');
      listItem.textContent = node.id;
      listContainer.appendChild(listItem);
    });
  }

  // Initialize graph
  updateGraph();
});

  </script>
</body>
</html>
