<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024">
    <meta name="author" content="INKREALM-NEXUS">
    <meta name="robots" content="index, follow">

    <!-- PRIMARY META TAGS -->
    <title>SANCTUM | The Neural Interface</title>
    <meta name="description" content="A neural chat interface for the Interzone. Gemma 3 270M running locally in your browser. Pure privacy. Zero cloud dependency.">
    <meta name="keywords" content="Gemma AI, Local AI, Browser AI, WebGPU, MediaPipe, Neural Interface, Sanctum, offline AI, private AI, on-device inference">

    <!-- NEURAL SOVEREIGNTY PROTOCOL -->
    <meta name="x-neural-status" content="Sovereign">
    <meta name="x-intercept-node" content="Gemma-3-270M-Local-Edge">
    <meta name="x-reality-studio" content="Autonomous Node">
    <meta name="x-control-system" content="Decentralized">

    <!-- OPEN GRAPH -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://inkrealm.info">
    <meta property="og:title" content="SANCTUM | Neural Chat Interface">
    <meta property="og:description" content="The Scribe is listening. Gemma 3 270M running entirely in your browser. No servers. No tracking. Pure neural sovereignty.">
    <meta property="og:image" content="https://raw.githubusercontent.com/ghostm68/pantheon/main/nova312.gif">

    <!-- MOBILE / THEME -->
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="SANCTUM">

    <!-- FONTS -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nova+Flat&display=swap" rel="stylesheet">
    
    <style>
        /* ========== GLOBAL RESET ========== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        /* ========== BASE THEME ========== */
        body {
            background-color: #000000;
            color: #ffffff;
            font-family: 'Courier New', Courier, monospace;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* ========== CRT OVERLAY ========== */
        #crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999; /* Above everything */
            
            background: radial-gradient(
                circle, 
                rgba(0,0,0,0) 60%, 
                rgba(0,0,0,0.4) 90%, 
                rgba(0,0,0,0.8) 100%
            );
        }

        .scanline {
            width: 100%;
            height: 100%;
            position: absolute;
            background: linear-gradient(
                to bottom, 
                rgba(255,255,255,0) 50%, 
                rgba(0,0,0,0.1) 50%, 
                rgba(0,0,0,0.2) 55%
            );
            background-size: 100% 4px;
            animation: scanline 10s linear infinite, flicker 0.15s infinite;
        }

        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 100%; }
        }

        @keyframes flicker {
            0% { opacity: 0.15; }
            50% { opacity: 0.25; }
            100% { opacity: 0.15; }
        }

        /* ========== MAIN LAYOUT ========== */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            height: 100vh;
            gap: 20px;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* ========== HEADER ========== */
        header {
            grid-column: 1 / -1;
            border-bottom: 2px solid #ff0000;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #000;
            position: relative;
            z-index: 2;
        }

        h1 {
            margin: 0;
            font-size: 2.5rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: rgba(255, 0, 51, 0.1);
            background-image: url('https://github.com/ghostm68/pantheon/raw/main/inkrealmliquidhermes934.gif');
            background-size: cover;
            -webkit-background-clip: text;
            background-clip: text;
            animation: water-flow 30s linear infinite;
            text-shadow: 0 0 20px rgba(255, 0, 51, 0.8), 0 0 40px rgba(61, 2, 10, 0.5);
        }

        @keyframes water-flow {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }

        .status {
            font-size: 0.9rem;
            color: #888;
        }

        .status.ready { color: #00ff00; }
        .status.error { color: #ff0000; }

        #progress-bar {
            grid-column: 1 / -1;
            height: 2px;
            background-color: #ff0000;
            width: 0%;
            transition: width 0.3s;
        }

        /* ========== CHAT INTERFACE ========== */
        .panel {
            background: rgba(10, 10, 10, 0.9);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 2px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .panel h2 {
            color: #fff;
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            margin-bottom: 15px;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #222;
            margin-bottom: 15px;
            min-height: 300px;
        }

        .message {
            max-width: 80%;
            padding: 12px 15px;
            border-left: 3px solid #333;
            line-height: 1.5;
            font-size: 0.9rem;
        }

        .user-msg {
            align-self: flex-end;
            background-color: #111;
            border-left-color: #fff;
        }

        .ai-msg {
            align-self: flex-start;
            background-color: #000;
            border-left-color: #ff0000;
            color: #ccc;
        }

        /* ========== INPUT AREA ========== */
        .input-area {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        textarea {
            flex: 1;
            background-color: #111;
            border: 1px solid #333;
            color: #fff;
            padding: 10px;
            font-family: inherit;
            resize: none;
            outline: none;
            height: 60px;
            font-size: 0.9rem;
        }

        textarea:focus { border-color: #ff0000; }

        button {
            background-color: #ff0000;
            color: #000;
            border: none;
            padding: 0 25px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            transition: all 0.2s;
            font-family: inherit;
            font-size: 0.8rem;
        }

        button:hover { background-color: #fff; }
        button:disabled { background-color: #333; color: #555; cursor: not-allowed; }

        /* ========== NOVA EXPRESS MACHINE ========== */
        .nova-panel {
            border: 1px solid #ff0033 !important;
        }

        .nova-panel h2 {
            color: #ff0033 !important;
            border-color: #ff0033 !important;
        }

        .mixer-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin: 10px 0;
        }

        .module-btn {
            background: #111;
            border: 1px solid #333;
            color: #888;
            padding: 10px;
            cursor: pointer;
            font-family: "Nova Flat", monospace;
            text-align: left;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        .module-btn:hover {
            background: #ff0033;
            border-color: #ff0033;
            color: #000;
            box-shadow: 0 0 10px rgba(255, 0, 51, 0.4);
        }

        .express-icon {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff0033;
        }

        .module-btn:hover .express-icon {
            color: #000;
        }

        .mini-btn {
            font-size: 0.65rem;
            padding: 4px 8px;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #666;
        }

        .mini-btn:hover {
            color: #ff0033;
            border-color: #ff0033;
        }

        /* ========== ORB ========== */
        .orb-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            z-index: 100;
        }

        .glitch-orb {
            width: 100%;
            height: 100%;
            fill: none;
            stroke-width: 3;
        }

        .orb-circle { stroke: #ff0033; }
        .orb-triangle { stroke: #ffffff; }

        .orb-container svg {
            animation: slow-spin 10s linear infinite;
            filter: drop-shadow(0 0 5px rgba(255, 0, 51, 0.4));
        }

        @keyframes slow-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ========== FOOTER ========== */
        footer {
            grid-column: 1 / -1;
            padding: 20px;
            border-top: 1px solid #333;
            text-align: center;
            font-size: 0.7rem;
            color: #555;
            background: #0a0a0a;
            margin-top: 20px;
        }

        .wallet-address {
            color: #ff0033;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            letter-spacing: 1px;
            word-break: break-all;
            margin: 15px 0;
            border-top: 1px dashed #333;
            border-bottom: 1px dashed #333;
            padding: 10px 0;
            background: rgba(255, 0, 51, 0.05);
        }
    </style>
</head>
<body>
    <!-- CRT OVERLAY -->
    <div id="crt-overlay">
        <div class="scanline"></div>
    </div>

    <!-- HEADER -->
    <header>
        <h1>SANCTUM</h1>
        <div id="status" class="status">INITIALIZING NEURAL LINK...</div>
    </header>
    
    <div id="progress-bar"></div>

    <!-- MAIN CONTENT -->
    <div class="main-container">
        <!-- LEFT COLUMN: CHAT -->
        <div class="left-column">
            <div class="panel">
                <h2>NEURAL INTERFACE</h2>
                <div id="chat-container">
                    <div class="message ai-msg">
                        System Online. Gemma 3-270M is listening.<br>
                        <span style="color: #666; font-size: 0.8rem;">To avoid repetition: be specific, use constraints, and ask for structured responses.</span>
                    </div>
                </div>
                
                <div class="input-area">
                    <textarea id="user-input" placeholder="Enter command... (e.g., 'In 3 bullet points, explain quantum entanglement')" disabled></textarea>
                    <button id="send-btn" disabled>TRANSMIT</button>
                </div>
            </div>
        </div>

        <!-- RIGHT COLUMN: NOVA EXPRESS -->
        <div class="right-column">
            <div class="panel">
                <h2>NOTEPAD</h2>
                <textarea id="notepad" placeholder="Your workspace..." style="flex: 1; min-height: 150px;"></textarea>
                <div style="display: flex; gap: 10px; margin-top: 10px;">
                    <button id="exportButton" class="mini-btn">SAVE</button>
                    <button id="clearButton" class="mini-btn">CLEAR</button>
                </div>
            </div>

            <div class="panel nova-panel">
                <h2><span style="font-size:1.2rem; vertical-align:middle;">✇</span> NOVA EXPRESS CUT-UP MACHINE</h2>
                
                <div style="display: flex; gap: 5px; margin-bottom: 10px;">
                    <button id="pullFromNotepadBtn" class="mini-btn" style="flex:1;">⇩ PULL FROM NOTEPAD</button>
                    <button id="pullFromAiBtn" class="mini-btn" style="flex:1;">⇩ PULL FROM AI</button>
                </div>

                <textarea id="mixerSource" placeholder="RAW DATA BUFFER..." style="width: 100%; height: 80px; margin-bottom: 10px;"></textarea>

                <div class="mixer-controls">
                    <button class="module-btn" data-algo="scramble"><span class="express-icon">✃</span> SCISSOR</button>
                    <button class="module-btn" data-algo="fold"><span class="express-icon">≣</span> FOLD-IN</button>
                    <button class="module-btn" data-algo="chunks"><span class="express-icon">❖</span> 3RD MIND</button>
                    <button class="module-btn" data-algo="reverse"><span class="express-icon">⇄</span> REVERSE</button>
                </div>

                <label style="color:#666; font-size:0.7rem; text-transform:uppercase; display:block; margin-top: 10px;">Result Stream:</label>
                <textarea id="mixerOutput" placeholder="Waiting for input..." style="width: 100%; height: 100px;"></textarea>
                
                <button id="pushToNotepadBtn" style="width: 100%; margin-top:10px; background: #3d020a; border-color: #ff0033; color: #ff0033;">
                    ⇧ UPLOAD TO NOTEPAD
                </button>
            </div>
        </div>
    </div>

    <!-- ORB -->
    <div class="orb-container">
        <svg class="glitch-orb" viewBox="0 0 100 100">
            <circle class="orb-circle" cx="50" cy="50" r="45" />
            <polygon class="orb-triangle" points="50,25 78,75 22,75" />
        </svg>
    </div>

    <!-- FOOTER -->
    <footer>
        <p>&copy; 2026 INKREALM-NEXUS | Amazon Nova AI • 7 Source Lexicon + Live Thesaurus</p>
        
        <p class="wallet-address">
            ton @ UQAc99MvKIcewbQFmOF_RvqpkAXZno0wiz3_BMsP87pJjSnB
        </p>

        <p><a href="https://inkrealm.info" style="color: white;">BACK TO MAIN</a></p>
    </footer>

    <!-- MEDIAPIPE AI SCRIPT -->
    <script type="module">
        import { LlmInference, FilesetResolver } from 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-genai';

        const output = document.getElementById('chat-container');
        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const status = document.getElementById('status');
        const progressBar = document.getElementById('progress-bar');

        let llm = null;

        // **CONFIGURATION** - Update this URL if needed
        const modelUrl = 'https://gemma.inkrealm.info/gemma3-270m-it-q8-web.task'; 

        async function initAI() {
            try {
                status.innerText = "LOADING AI ENGINE...";
                
                const genai = await FilesetResolver.forGenAiTasks(
                    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-genai/wasm"
                );

                status.innerText = "DOWNLOADING MODEL (276MB)...";
                progressBar.style.width = "30%";

                llm = await LlmInference.createFromOptions(genai, {
                    baseOptions: { modelAssetPath: modelUrl },
                    maxTokens: 512, // Reduced to prevent repetition
                    temperature: 0.3, // Lower temperature = less random
                    topK: 20,
                    randomSeed: 42 // More deterministic
                });

                progressBar.style.width = "100%";
                setTimeout(() => { progressBar.style.width = "0%"; }, 500);
                
                status.innerText = "NEURAL LINK ESTABLISHED";
                status.classList.add('ready');
                input.disabled = false;
                sendBtn.disabled = false;
                input.focus();

            } catch (err) {
                console.error("AI Initialization Error:", err);
                status.innerText = "CONNECTION FAILED";
                status.classList.add('error');
                
                appendMessage(`ERROR: Could not load model from ${modelUrl}. Check: 
1. CORS settings on R2 bucket
2. Cloudflare Zero Trust token
3. Model file exists at URL`, 'ai-msg');
            }
        }

        async function handleChat() {
            const text = input.value.trim();
            if (!text || !llm) return;

            // Enhanced prompt to prevent repetition
            const enhancedPrompt = `${text}\n\nProvide a clear, concise response without repeating yourself. Use bullet points or numbered lists if appropriate.`;
            
            appendMessage(text, 'user-msg');
            input.value = '';
            input.disabled = true;
            sendBtn.disabled = true;

            try {
                const aiDiv = appendMessage("▌", 'ai-msg');
                
                let fullResponse = "";
                await llm.generateResponse(enhancedPrompt, (partialResult) => {
                    fullResponse += partialResult;
                    aiDiv.innerText = fullResponse;
                    output.scrollTop = output.scrollHeight;
                });
                
            } catch (err) {
                appendMessage("Error generating response: " + err.message, 'ai-msg');
            }

            input.disabled = false;
            sendBtn.disabled = false;
            input.focus();
        }

        function appendMessage(text, className) {
            const div = document.createElement('div');
            div.className = `message ${className}`;
            div.innerText = text;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
            return div;
        }

        // Event Listeners
        sendBtn.addEventListener('click', handleChat);
        input.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleChat();
            }
        });

        // Initialize
        initAI();
    </script>

    <!-- NOVA EXPRESS LOGIC -->
    <script>
        // 1. DATA FLOW
        document.getElementById('pullFromNotepadBtn').addEventListener('click', () => {
            document.getElementById('mixerSource').value = document.getElementById('notepad').value;
        });

        document.getElementById('pullFromAiBtn').addEventListener('click', () => {
            const aiMessages = document.querySelectorAll('.ai-msg');
            const lastAiMessage = aiMessages[aiMessages.length - 1];
            if (lastAiMessage) {
                document.getElementById('mixerSource').value = lastAiMessage.textContent;
            }
        });

        document.getElementById('pushToNotepadBtn').addEventListener('click', () => {
            const mix = document.getElementById('mixerOutput').value;
            if (!mix) return;
            const notepad = document.getElementById('notepad');
            notepad.value += (notepad.value ? '\n\n--- NOVA EXPRESS ---\n' : '') + mix;
        });

        // 2. ALGORITHMS
        const modules = {
            scramble: (text) => {
                const words = text.split(/\s+/);
                for (let i = words.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [words[i], words[j]] = [words[j], words[i]];
                }
                return words.join(' ');
            },

            fold: (text) => {
                const lines = text.split('\n').filter(l => l.trim() !== '');
                const half = Math.floor(lines.length / 2);
                const first = lines.slice(0, half);
                const second = lines.slice(half);
                let result = [];
                for(let i = 0; i < Math.max(first.length, second.length); i++) {
                    if(first[i]) result.push(first[i]);
                    if(second[i]) result.push(second[i]);
                }
                return result.join('\n');
            },

            chunks: (text) => {
                const words = text.split(/\s+/);
                let chunks = [];
                while(words.length > 0) {
                    let size = Math.floor(Math.random() * 4) + 1;
                    chunks.push(words.splice(0, size).join(' '));
                }
                for (let i = chunks.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [chunks[i], chunks[j]] = [chunks[j], chunks[i]];
                }
                return chunks.join(' ');
            },

            reverse: (text) => {
                return text.split(' ').reverse().join(' ');
            }
        };

        // 3. EVENT LISTENERS
        document.querySelectorAll('.module-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const algo = btn.dataset.algo;
                const source = document.getElementById('mixerSource').value;
                if (!source.trim()) return;
                document.getElementById('mixerOutput').value = modules[algo](source);
            });
        });

        // 4. NOTEPAD CONTROLS
        document.getElementById('exportButton').addEventListener('click', () => {
            const text = document.getElementById('notepad').value;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'notepad.txt';
            a.click();
            URL.revokeObjectURL(url);
        });

        document.getElementById('clearButton').addEventListener('click', () => {
            if (confirm('Clear notepad?')) {
                document.getElementById('notepad').value = '';
            }
        });

        // Console message
        console.log(
            "%c SANCTUM %c v1.0 ONLINE ", 
            "background: #ff0033; color: #000; font-weight: bold; padding: 4px;", 
            "background: #000; color: #ff0033; border: 1px solid #ff0033; padding: 3px;"
        );
        );
console.log(
    "%c'Listen to my last words any world. Listen all you boards syndicates and governments of the earth. And you powers behind what filth deals consummated in what lavatory to take what is not yours. To sell the ground from unborn feet forever...'", 
    "color: #444; font-family: monospace; font-style: italic; font-size: 10px;"
);
    </script>
</body>
</html>
