<!DOCTYPE html>
<html>
<head><base href="https://wordstar-online.com/">
    <meta charset="UTF-8">
    <meta name="keywords" content="typewriter, writing, retro, vintage, text editor, AI, generative, creative writing">
    <meta name="description" content="Experience the nostalgia of a classic typewriter with Wordstar, a web-based app that combines vintage aesthetics with modern AI-powered writing tools.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WordStar Nexus - Modern Text Editor</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #2d2d2d;
            color: #f0f0f0;
        }
        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        #toolbar {
            background-color: #1e1e1e;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        #editor {
            flex-grow: 1;
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
            background-color: #1e1e1e;
            color: #f0f0f0;
            border: none;
            resize: none;
        }
        #statusbar {
            background-color: #cc0000;
            color: white;
            padding: 5px 10px;
            font-size: 14px;
        }
        button {
            background-color: #cc0000;
            color: white;
            border: none;
            padding: 5px 10px;
            margin-right: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #990000;
        }
        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }
        .api-config {
            margin-bottom: 10px;
            padding: 10px;
            background-color: #333;
            border-radius: 5px;
            font-size: 12px;
            display: none;
        }
        .api-config input {
            width: 100%;
            padding: 3px;
            margin-top: 3px;
            background-color: #555;
            color: white;
            border: 1px solid #666;
        }
        .model-status {
            font-size: 11px;
            color: #999;
            margin-left: 5px;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="toolbar">
        <div>
            <button onclick="newDocument()">New</button>
            <button onclick="saveDocument()">Save</button>
            <button onclick="exportTxt()">Export TXT</button>
            <button onclick="exportRtf()">Export RTF</button>
            <button onclick="exportPdf()">Export PDF</button>
            <button onclick="insertPoeticParagraph()">Insert Random Poetic Paragraph</button>
            <button onclick="insertRandomScientificWord()">Random Word</button>
        </div>
        <div id="notebook" style="background-color: #cc0000; padding: 10px; border-radius: 5px; margin-left: 10px;">
            <textarea id="notebookText" rows="3" style="width: 200px; background-color: #cc0000; color: black; border: 1px solid black; padding: 5px;" placeholder="Write your note here..."></textarea>
            <div>
                <button onclick="insertNoteToEditor()" style="background-color: black; color: #cc0000; border: none; padding: 5px 10px; margin-top: 5px; cursor: pointer;">Insert Note</button>
            </div>
        </div>
    </div>
    
    <div id="editor" style="display: flex; justify-content: space-between;">
        <div id="ace-editor" style="width: 80%; height: 100%;">
            <textarea id="main-text-area" style="width: 100%; height: 100%; background-color: #1e1e1e; color: #f0f0f0; border: none; resize: none; font-family: 'Courier New', monospace; font-size: 16pt; font-weight: bold; padding: 10px;" placeholder="Start typing your document here..."></textarea>
        </div>
        
        <div style="width: 18%; display: flex; flex-direction: column;">
            <div>
                <select id="ai-model-select" style="width: 100%; padding: 5px; margin-bottom: 5px;">
                    <optgroup label="üîß Instant Local">
                        <option value="markov">Markov Chain</option>
                        <option value="wordassociation">Word Association</option>
                        <option value="randomsentence">Random Sentence</option>
                        <option value="neural-generator">Neural Generator</option>
                        <option value="template-advanced">Advanced Template</option>
                    </optgroup>
                    <optgroup label="‚òÅÔ∏è Cloud APIs">
                        <option value="groq">Groq (Free Tier)</option>
                        <option value="openrouter">OpenRouter (Free Credits)</option>
                        <option value="ollama-cloud">Ollama Cloud</option>
                        <option value="anthropic">Claude (Anthropic)</option>
                    </optgroup>
                    <optgroup label="üè† Local Desktop">
                        <option value="ollama-local">Ollama (localhost:11434)</option>
                        <option value="lmstudio">LM Studio (localhost:1234)</option>
                    </optgroup>
                </select>
                <span id="model-status" class="model-status">Ready</span>
                
                <div id="api-config" class="api-config">
                    <label>API Key:</label>
                    <input type="password" id="external-api-key" placeholder="Enter your API key">
                </div>
                
                <textarea id="ai-prompt" placeholder="Enter your prompt here" style="width: 100%; padding: 5px; margin-bottom: 5px; height: 60px;"></textarea>
                <button id="generate-btn" style="width: 100%; background-color: #cc0000; color: white; border: none; padding: 5px 10px; cursor: pointer; font-size: 12px;">Create Text</button>
            </div>
            
            <div id="dictionary-results" style="flex-grow: 1; overflow-y: auto; background-color: #2d2d2d; padding: 10px; border: 1px solid #444; font-size: 12px;">
                <div id="ai-response" style="white-space: pre-wrap; min-height: 200px; padding: 10px; background-color: #1e1e1e; border: 1px solid #555; margin-bottom: 10px;"></div>
                
                <details style="margin-top: 10px;">
                    <summary style="color: #cc0000; cursor: pointer; padding: 5px 0;">üìñ AI Models Guide</summary>
                    <div style="margin-top: 10px; font-size: 11px; line-height: 1.4;">
                        <strong>üîß INSTANT LOCAL:</strong><br>
                        Work immediately, no internet required<br><br>
                        
                        <strong>‚òÅÔ∏è CLOUD APIS:</strong><br>
                        ‚Ä¢ Groq - Ultra-fast, free tier<br>
                        ‚Ä¢ OpenRouter - Many models, free credits<br>
                        ‚Ä¢ Ollama Cloud - Managed hosting<br>
                        ‚Ä¢ Claude - High-quality reasoning<br><br>
                        
                        <strong>üè† LOCAL DESKTOP:</strong><br>
                        Requires apps running locally<br><br>
                        
                        <strong>Instructions:</strong><br>
                        1. Select a model<br>
                        2. Enter your prompt<br>
                        3. Click "Create Text"<br>
                        4. Generated text appears above
                    </div>
                </details>
            </div>
        </div>
    </div>
    
    <div id="statusbar" style="background-color: #cc0000; display: flex; justify-content: space-between; align-items: center;">
        <span id="status-text">WordStar Online - Ready</span>
        <span id="word-count" style="font-size: 12px;">Words: 0</span>
        <span style="font-size: 12px;">¬© MMXXIV www.inkrealm.info</span>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>

<script>
// Global variables
let editor = null;
let isGenerating = false;

// Markov chain data
const markovData = {
    "the": ["quick", "lazy", "beautiful", "mysterious", "ancient"],
    "quick": ["brown", "silver", "golden", "dark"],
    "brown": ["fox", "dog", "cat", "horse"],
    "fox": ["jumps", "runs", "walks", "sleeps"],
    "jumps": ["over", "across", "through"],
    "over": ["the", "a", "an"],
    "lazy": ["dog", "cat", "afternoon", "river"],
    "beautiful": ["sunset", "morning", "garden", "melody"],
    "mysterious": ["forest", "cave", "stranger", "light"],
    "ancient": ["tree", "castle", "wisdom", "book"]
};

// Word associations
const wordAssociations = {
    "write": ["pen", "paper", "story", "author", "book"],
    "story": ["tale", "narrative", "adventure", "character", "plot"],
    "adventure": ["journey", "quest", "exploration", "discovery"],
    "journey": ["travel", "path", "destination", "experience"],
    "creative": ["artistic", "imaginative", "innovative", "original"],
    "time": ["moment", "eternity", "past", "future", "present"],
    "light": ["bright", "illumination", "dawn", "star", "hope"],
    "hope": ["dream", "aspiration", "future", "possibility"],
    "dream": ["vision", "imagination", "sleep", "fantasy"],
    "nature": ["forest", "ocean", "mountain", "wildlife", "peace"]
};

// Initialize everything when page loads
function initializeApp() {
    console.log('Initializing WordStar app...');
    
    // Try to initialize Ace editor
    try {
        if (typeof ace !== 'undefined') {
            editor = ace.edit("ace-editor");
            editor.setTheme("ace/theme/monokai");
            editor.session.setMode("ace/mode/text");
            editor.session.on('change', updateWordCount);
            console.log('Ace editor initialized');
        }
    } catch (e) {
        console.error('Ace editor failed to initialize:', e);
        // Fall back to textarea
        editor = document.getElementById('main-text-area');
    }
    
    // Set up event handlers
    setupEventHandlers();
    
    // Initial word count
    updateWordCount();
    
    console.log('WordStar app initialized successfully');
}

function setupEventHandlers() {
    console.log('Setting up event handlers...');
    
    // Generate button
    const generateBtn = document.getElementById('generate-btn');
    if (generateBtn) {
        generateBtn.addEventListener('click', generateText);
        console.log('Generate button handler attached');
    }
    
    // Model selector
    const modelSelect = document.getElementById('ai-model-select');
    if (modelSelect) {
        modelSelect.addEventListener('change', onModelChange);
        console.log('Model selector handler attached');
    }
    
    // Initialize model status
    onModelChange();
}

function onModelChange() {
    const selectedModel = document.getElementById('ai-model-select').value;
    const apiConfig = document.getElementById('api-config');
    const modelStatus = document.getElementById('model-status');
    
    if (!selectedModel || !modelStatus) return;
    
    console.log('Model changed to:', selectedModel);
    
    if (['markov', 'wordassociation', 'randomsentence', 'neural-generator', 'template-advanced'].includes(selectedModel)) {
        apiConfig.style.display = 'none';
        modelStatus.textContent = 'Instant Local - Ready';
    } else if (['ollama-local', 'lmstudio'].includes(selectedModel)) {
        apiConfig.style.display = 'none';
        const port = selectedModel === 'ollama-local' ? '11434' : '1234';
        modelStatus.textContent = `Local Desktop - Port ${port}`;
    } else {
        apiConfig.style.display = 'block';
        modelStatus.textContent = 'Cloud API - Requires key';
    }
}

// Text generation functions
function generateMarkovText(seed, maxWords) {
    const words = seed.toLowerCase().split(' ');
    let result = seed;
    let currentWord = words[words.length - 1];
    
    for (let i = 0; i < maxWords && i < 30; i++) {
        const nextWords = markovData[currentWord];
        if (!nextWords || nextWords.length === 0) {
            const keys = Object.keys(markovData);
            currentWord = keys[Math.floor(Math.random() * keys.length)];
        } else {
            currentWord = nextWords[Math.floor(Math.random() * nextWords.length)];
        }
        result += ' ' + currentWord;
    }
    
    return result + '.';
}

function generateWordAssociation(seed, maxWords) {
    const words = seed.toLowerCase().split(' ');
    let result = seed;
    let currentWord = words[words.length - 1];
    
    for (let i = 0; i < maxWords && i < 20; i++) {
        const associations = wordAssociations[currentWord];
        if (!associations || associations.length === 0) {
            const keys = Object.keys(wordAssociations);
            currentWord = keys[Math.floor(Math.random() * keys.length)];
        } else {
            currentWord = associations[Math.floor(Math.random() * associations.length)];
        }
        result += ' ' + currentWord;
    }
    
    return result + '.';
}

function generateRandomSentence() {
    const subjects = ['The writer', 'A poet', 'The storyteller', 'An author', 'The dreamer'];
    const verbs = ['crafts', 'weaves', 'creates', 'imagines', 'discovers'];
    const objects = ['beautiful prose', 'vivid imagery', 'compelling narratives', 'magical worlds', 'timeless stories'];
    const endings = ['with passion', 'through dedication', 'using creativity', 'with great care', 'in quiet moments'];
    
    const subject = subjects[Math.floor(Math.random() * subjects.length)];
    const verb = verbs[Math.floor(Math.random() * verbs.length)];
    const object = objects[Math.floor(Math.random() * objects.length)];
    const ending = endings[Math.floor(Math.random() * endings.length)];
    
    return `${subject} ${verb} ${object} ${ending}.`;
}

function generateNeuralText(prompt) {
    const templates = [
        "{prompt} reveals deeper meanings when we consider {concept} and its {connection}.",
        "Building upon {prompt}, we discover that {element} creates {result}.",
        "The essence of {prompt} lies in understanding {principle}.",
        "{prompt} serves as a gateway to exploring {theme}."
    ];
    
    const concepts = ["consciousness", "creativity", "harmony", "transformation", "innovation"];
    const connections = ["human significance", "natural patterns", "artistic expression", "deeper meaning"];
    const elements = ["structure", "rhythm", "flow", "energy", "purpose"];
    const results = ["profound insights", "new possibilities", "deeper understanding"];
    const principles = ["interconnectedness", "emergence", "complexity", "authenticity"];
    const themes = ["human experience", "natural phenomena", "creative expression"];
    
    const template = templates[Math.floor(Math.random() * templates.length)];
    
    return template
        .replace('{prompt}', prompt)
        .replace('{concept}', concepts[Math.floor(Math.random() * concepts.length)])
        .replace('{connection}', connections[Math.floor(Math.random() * connections.length)])
        .replace('{element}', elements[Math.floor(Math.random() * elements.length)])
        .replace('{result}', results[Math.floor(Math.random() * results.length)])
        .replace('{principle}', principles[Math.floor(Math.random() * principles.length)])
        .replace('{theme}', themes[Math.floor(Math.random() * themes.length)]);
}

function generateAdvancedTemplate(prompt) {
    const patterns = [
        "As {prompt} unfolds, we witness {development} that {action} {outcome}.",
        "Within {prompt}, there exists {mystery} that {beckons} toward {discovery}.",
        "The narrative of {prompt} weaves together {elements} to create {meaning}."
    ];
    
    const developments = ["transformation", "evolution", "growth", "change"];
    const actions = ["reveals", "unveils", "demonstrates", "illuminates"];
    const outcomes = ["profound truths", "new possibilities", "unexpected beauty"];
    const mysteries = ["untold stories", "hidden dimensions", "secret truths"];
    const beckons = ["calls", "draws", "invites", "guides"];
    const discoveries = ["understanding", "insights", "revelations", "knowledge"];
    const elements = ["themes", "characters", "emotions", "experiences"];
    const meanings = ["deeper significance", "lasting impact", "universal truth"];
    
    const pattern = patterns[Math.floor(Math.random() * patterns.length)];
    
    return pattern
        .replace('{prompt}', prompt)
        .replace('{development}', developments[Math.floor(Math.random() * developments.length)])
        .replace('{action}', actions[Math.floor(Math.random() * actions.length)])
        .replace('{outcome}', outcomes[Math.floor(Math.random() * outcomes.length)])
        .replace('{mystery}', mysteries[Math.floor(Math.random() * mysteries.length)])
        .replace('{beckons}', beckons[Math.floor(Math.random() * beckons.length)])
        .replace('{discovery}', discoveries[Math.floor(Math.random() * discoveries.length)])
        .replace('{elements}', elements[Math.floor(Math.random() * elements.length)])
        .replace('{meaning}', meanings[Math.floor(Math.random() * meanings.length)]);
}

// API generation functions (simplified)
async function generateWithAPI(model, prompt) {
    const apiKey = document.getElementById('external-api-key')?.value;
    if (!apiKey) {
        return 'Please enter your API key for this model.';
    }
    
    // This is a simplified placeholder - in reality you'd implement each API
    return `${prompt} continues with sophisticated AI-generated content. [${model} API would generate actual text here with your API key]`;
}

async function generateWithLocalAPI(model, prompt) {
    const ports = { 'ollama-local': '11434', 'lmstudio': '1234' };
    const port = ports[model];
    
    try {
        // Basic connectivity test
        const response = await fetch(`http://localhost:${port}/api/generate`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: prompt, model: 'default' })
        });
        
        if (!response.ok) {
            return `${model} not running on localhost:${port}`;
        }
        
        const result = await response.json();
        return result.response || `${prompt} [Generated by local ${model}]`;
        
    } catch (error) {
        return `${model} not accessible on localhost:${port}. Make sure it's running.`;
    }
}

// Main generation function
async function generateText() {
    if (isGenerating) {
        console.log('Already generating, ignoring click');
        return;
    }
    
    console.log('Generate text button clicked');
    
    const prompt = document.getElementById('ai-prompt')?.value?.trim();
    if (!prompt) {
        alert('Please enter a prompt first');
        return;
    }
    
    const model = document.getElementById('ai-model-select')?.value;
    if (!model) {
        alert('Please select a model');
        return;
    }
    
    const generateBtn = document.getElementById('generate-btn');
    const aiResponse = document.getElementById('ai-response');
    const statusText = document.getElementById('status-text');
    
    console.log(`Generating with model: ${model}, prompt: "${prompt}"`);
    
    isGenerating = true;
    if (generateBtn) generateBtn.disabled = true;
    if (generateBtn) generateBtn.textContent = 'Generating...';
    if (statusText) statusText.textContent = 'WordStar Online - Generating text...';
    
    try {
        let generatedText = '';
        
        switch (model) {
            case 'markov':
                generatedText = generateMarkovText(prompt, 30);
                break;
            case 'wordassociation':
                generatedText = generateWordAssociation(prompt, 20);
                break;
            case 'randomsentence':
                generatedText = generateRandomSentence();
                break;
            case 'neural-generator':
                generatedText = generateNeuralText(prompt);
                break;
            case 'template-advanced':
                generatedText = generateAdvancedTemplate(prompt);
                break;
            case 'ollama-local':
            case 'lmstudio':
                generatedText = await generateWithLocalAPI(model, prompt);
                break;
            default:
                generatedText = await generateWithAPI(model, prompt);
        }
        
        console.log('Generated text:', generatedText);
        
        if (aiResponse) {
            aiResponse.textContent = generatedText;
        }
        
    } catch (error) {
        console.error('Generation error:', error);
        if (aiResponse) {
            aiResponse.textContent = `Error: ${error.message}`;
        }
    } finally {
        isGenerating = false;
        if (generateBtn) generateBtn.disabled = false;
        if (generateBtn) generateBtn.textContent = 'Create Text';
        if (statusText) statusText.textContent = 'WordStar Online - Ready';
        console.log('Generation complete');
    }
}

// Original WordStar functions
function newDocument() {
    console.log('New document clicked');
    if (editor && editor.setValue) {
        editor.setValue("");
    } else if (editor && editor.value !== undefined) {
        editor.value = "";
    }
    updateStatusBar("New document created");
    updateWordCount();
}

function saveDocument() {
    console.log('Save document clicked');
    let content = '';
    if (editor && editor.getValue) {
        content = editor.getValue();
    } else if (editor && editor.value !== undefined) {
        content = editor.value;
    }
    
    const blob = new Blob([content], {type: "text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "document.txt";
    a.click();
    URL.revokeObjectURL(url);
    updateStatusBar("Document saved");
}

function exportTxt() {
    saveDocument();
}

function exportRtf() {
    console.log('Export RTF clicked');
    let content = '';
    if (editor && editor.getValue) {
        content = editor.getValue();
    } else if (editor && editor.value !== undefined) {
        content = editor.value;
    }
    
    const rtfContent = "{\\rtf1\\ansi\\deff0{\\fonttbl{\\f0 Times New Roman;}}\n\n" + content.replace(/\n/g, "\\par\n") + "}";
    const blob = new Blob([rtfContent], {type: "application/rtf"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "document.rtf";
    a.click();
    URL.revokeObjectURL(url);
    updateStatusBar("Document exported as RTF");
}

function exportPdf() {
    console.log('Export PDF clicked');
    if (typeof jsPDF === 'undefined') {
        alert('PDF export not available');
        return;
    }
    
    let content = '';
    if (editor && editor.getValue) {
        content = editor.getValue();
    } else if (editor && editor.value !== undefined) {
        content = editor.value;
    }
    
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text(content, 10, 10);
    doc.save("document.pdf");
    updateStatusBar("Document exported as PDF");
}

function insertPoeticParagraph() {
    console.log('Insert poetic paragraph clicked');
    const poeticParagraphs = [
        "Whispers of twilight dance on autumn leaves,\nAs golden hues paint the sky's canvas,\nNature's symphony echoes through the trees,\nA moment of beauty, forever to last.",
        "Moonlit waves caress the shore,\nStars above, a cosmic dance,\nIn this quiet, forevermore,\nWe find life's gentle romance.",
        "Sunflowers reach for azure skies,\nTheir petals, a sea of gold,\nIn fields where summer never dies,\nAnd stories of light unfold."
    ];
    
    const randomParagraph = poeticParagraphs[Math.floor(Math.random() * poeticParagraphs.length)];
    
    if (editor && editor.insert) {
        editor.insert(randomParagraph + "\n\n");
    } else if (editor && editor.value !== undefined) {
        editor.value += randomParagraph + "\n\n";
    }
    
    updateStatusBar("Poetic paragraph inserted");
    updateWordCount();
}

function insertRandomScientificWord() {
    console.log('Insert random word clicked');
    const scientificWords = [
        "Quantum", "Photosynthesis", "Entropy", "Mitochondria", "Neuroplasticity",
        "Genome", "Algorithm", "Nanotechnology", "Thermodynamics", "Synapse"
    ];
    
    const randomWord = scientificWords[Math.floor(Math.random() * scientificWords.length)];
    
    if (editor && editor.insert) {
        editor.insert(randomWord + " ");
    } else if (editor && editor.value !== undefined) {
        editor.value += randomWord + " ";
    }
    
    updateStatusBar("Random scientific word inserted");
    updateWordCount();
}

function insertNoteToEditor() {
    console.log('Insert note clicked');
    const noteContent = document.getElementById('notebookText')?.value;
    if (!noteContent || noteContent.trim() === '') {
        alert('Note is empty. Please write something before inserting.');
        return;
    }
    
    if (editor && editor.insert) {
        editor.insert(noteContent + '\n');
    } else if (editor && editor.value !== undefined) {
        editor.value += noteContent + '\n';
    }
    
    updateStatusBar("Note inserted into main text area");
    updateWordCount();
}

function updateStatusBar(message) {
    const statusBarElement = document.getElementById('status-text');
    if (statusBarElement) {
        statusBarElement.textContent = "WordStar Online - " + message;
    }
}

function updateWordCount() {
    let content = '';
    if (editor && editor.getValue) {
        content = editor.getValue();
    } else if (editor && editor.value !== undefined) {
        content = editor.value;
    }
    
    const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
    const wordCountElement = document.getElementById('word-count');
    if (wordCountElement) {
        wordCountElement.textContent = `Words: ${wordCount}`;
    }
}

// Initialize when DOM is ready
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeApp);
} else {
    initializeApp();
}

// Also try on window load as backup
window.addEventListener('load', function() {
    if (!editor) {
        console.log('Backup initialization on window load');
        initializeApp();
    }
});
</script>
</body>
</html>
