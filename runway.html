<!DOCTYPE html>
<html lang="en">
<link rel="icon" href="https://github.com/ghostm68/pantheon/raw/main/atari.gif" type="image/x-icon"/>
<link rel="shortcut icon" href="https://github.com/ghostm68/pantheon/raw/main/atari.gif" type="image/x-icon"/>
<!-- SEO Meta Tags -->
<meta name="description" content="Step back into fashion with Inkrealm's 'Runway' experience! This unique website combines a fully functional video-style word processor with all the classic features '+'. Immerse yourself in the magic of fashion computing and notes, all within a captivating pixel art design reminiscent of the cutting edge.">
<meta name="keywords" content="Runway, Inkrealm, retro, word processor, modern, video, pixel art,literature, typing">

<!-- Open Graph Meta Tags -->
<meta property="og:title" content="Inkrealm: runway word processor">
<meta property="og:description" content="Relish the new age of fashion and writing with Inkrealm's 'Runway'! Enjoy an easy typing experience with our fashion-inspired word processor and challenge yourself in action. All wrapped in a stunning pixel art design that captures the essence of high fashion.">
<meta property="og:url" content="https://inkrealm.info/runway">
<meta property="og:type" content="website">

<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=1024">
<title>RUNWAY by inkrealm.info</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<!-- jsPDF (for PDF export) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* SPLASH SCREEN STYLES - SINGLE LOADER ONLY */
#splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #1a2a6c 0%, #2a5298 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.8s ease-out;
}

.splash-content {
    text-align: center;
    color: white;
    z-index: 10;
}

/* SPINNING GIF LOADER */
.loader {
    width: 188px;
    height: 188px;
    border-radius: 50%;
    background: url('https://raw.githubusercontent.com/ghostm68/pantheon/main/myText_20251002-024217.png') center/cover;
    animation: spin 4s linear infinite;
    margin: 0 auto;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

#floatingLetters {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}
</style>

<style type="text/tailwindcss">
    :root {
      --primary-color: #a413ec;
    }
    body {
      font-family: 'Be Vietnam Pro', sans-serif;
    }
    .bar-graph {
      display: flex;
      align-items: flex-end;
      height: 24px;
      gap: 2px;
    }
    .bar {
      width: 4px;
      background-color: var(--primary-color);
      animation: pulse 1.5s infinite ease-in-out;
    }
    @keyframes pulse {
      0%, 100% { transform: scaleY(0.2); }
      50% { transform: scaleY(1); }
    }
    .format-button.active {
      background-color: var(--primary-color);
    }
    .auto-save-indicator {
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .auto-save-indicator.show {
      opacity: 1;
    }
    .search-highlight {
      background-color: rgba(164, 19, 236, 0.3);
      padding: 0 2px;
      border-radius: 2px;
    }
</style>

<style type="text/tailwindcss">
    :root {
      --primary-color: #a413ec;
      --bg-primary: #100C13;
      --bg-secondary: #1C1820;
      --text-primary: white;
      --text-secondary: #9CA3AF;
      --border-color: #2A232E;
    }

    /* Light mode color scheme */
    .light-mode {
      --bg-primary: #F3F4F6;
      --bg-secondary: #E5E7EB;
      --text-primary: #111827;
      --text-secondary: #6B7280;
      --border-color: #D1D5DB;
    }

    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      transition: background-color 0.3s, color 0.3s;
    }

    /* Enhanced accessibility and theme transitions */
    * {
      transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }

    /* Improved focus states */
    :focus-visible {
      outline: 2px solid var(--primary-color);
      outline-offset: 2px;
    }

    /* Scrollbar styling for both themes */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }
    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }
</style>
</head>

<body class="bg-[var(--bg-primary)] text-[var(--text-primary)] flex flex-col min-h-screen">
  <!-- SPLASH SCREEN - SINGLE LOADER -->
  <div id="splash-screen">
    <canvas id="floatingLetters"></canvas>
    <div class="splash-content">
      <div class="loader"></div>
    </div>
  </div>

  <!-- REMOVED: loading-overlay div completely -->

<div class="flex flex-col min-h-screen">
<header class="sticky top-0 z-20 bg-[#100C13]/80 backdrop-blur-sm border-b border-[#2A232E]">
  <div class="container mx-auto px-6 h-20 flex items-center justify-between">
    <div class="flex items-center gap-6">
      <div class="flex flex-col">
        <a class="flex items-center gap-3" href="#">
          <span class="text-xl font-bold">RUNWAY by inkrealm.info</span>
        </a>
        <span class="text-xs text-gray-500">Powered by google stitch, Javascript by claude sonnet</span>
      </div>
      <div class="flex items-center gap-2 bg-[#2A232E] p-1 rounded-lg">
        <select id="font-select" class="bg-transparent border-none text-white text-sm focus:ring-0 w-32">
          <option>Be Vietnam Pro</option>
          <option>Inter</option>
          <option>Roboto</option>
          <option>Lato</option>
          <option>Montserrat</option>
          <option>Open Sans</option>
          <option>Poppins</option>
          <option>Source Sans Pro</option>
          <option>Work Sans</option>
        </select>
        <div class="border-l border-gray-600 h-6"></div>
        <button id="bold-btn" class="format-button p-2 rounded-md hover:bg-[#3a3142] transition-colors">
          <span class="material-symbols-outlined text-base">format_bold</span>
        </button>
        <button id="italic-btn" class="format-button p-2 rounded-md hover:bg-[#3a3142] transition-colors">
          <span class="material-symbols-outlined text-base">format_italic</span>
        </button>
        <button id="underline-btn" class="format-button p-2 rounded-md hover:bg-[#3a3142] transition-colors">
          <span class="material-symbols-outlined text-base">format_underlined</span>
        </button>
      </div>
    </div>

    <div class="flex items-center gap-6">
      <div class="flex items-center gap-3">
        <div class="text-right">
        <div class="h-8 w-px bg-[#2A232E]"></div>
        <div class="text-right">
          <p class="text-sm font-semibold">Rome</p>
          <p class="text-xs text-gray-400" id="rome-time">10:45 AM</p>
        </div>
      </div>

      <div class="auto-save-indicator text-sm text-green-400 flex items-center gap-2">
        <span class="material-symbols-outlined text-sm">cloud_done</span>
        <span>Auto-saved</span>
      </div>
    </div>
  </div>
</header>

<main class="flex-grow container mx-auto px-6 py-8">
  <div class="flex flex-col @container">
    <div class="mb-8 flex justify-between items-center">
      <h1 class="text-4xl font-bold tracking-tight">Runway Text</h1>
      <div class="flex items-center gap-4">
        <input type="file" id="pdf-file-input" accept=".pdf" style="display: none;">
        <button id="save-pdf" class="flex items-center gap-2 bg-[var(--primary-color)] hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
          <span class="material-symbols-outlined">file_download</span>
          <span>Save as PDF</span>
        </button>
      </div>
    </div>

    <div class="border-b border-[#2A232E] mb-6">
      <nav class="-mb-px flex gap-8">
        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="">RESOURCES:</a>
        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://fashionmuseum.fitnyc.edu/collections" target="_blank">collections</a>
        <a class="py-4 px-1 text-white border-b-2 border-[var(--primary-color)] text-sm font-medium" href="https://www.palaisgalliera.paris.fr/en/palais-galliera/ressources-en-ligne" target="_blank">galliera</a>
        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://digimuse.westphal.drexel.edu/ddm/" target="_blank">drexel</a>
        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://fitnyc.libguides.com/?b=s" target="_blank">marcus</a>
      </nav>
    </div>

    <!-- Word Counter -->
    <div class="col-span-1 sticky top-28 h-fit">
      <div class="bg-[#1C1820] border border-[#2A232E] rounded-lg p-6 space-y-6">
        <div>
          <h3 class="text-lg font-semibold mb-4">Word Counter</h3>
          <div class="flex items-center justify-between mb-2">
            <span class="text-sm text-gray-400">Word Count</span>
            <span id="word-count" class="font-semibold">0 / 500</span>
          </div>
          <div class="bg-[#2A232E] rounded-full h-2 mb-4">
            <div id="word-progress" class="bg-[var(--primary-color)] h-2 rounded-full" style="width: 0%;"></div>
          </div>
          <div class="flex items-center justify-between">
            <div id="activity-bars" class="bar-graph w-full">
              <div class="bar" style="height: 60%; animation-delay: -0.1s;"></div>
              <div class="bar" style="height: 90%; animation-delay: -0.2s;"></div>
              <div class="bar" style="height: 40%; animation-delay: -0.3s;"></div>
              <div class="bar" style="height: 70%; animation-delay: -0.4s;"></div>
              <div class="bar" style="height: 100%; animation-delay: -0.5s;"></div>
              <div class="bar" style="height: 50%; animation-delay: -0.6s;"></div>
              <div class="bar" style="height: 80%; animation-delay: -0.7s;"></div>
              <div class="bar" style="height: 60%; animation-delay: -0.8s;"></div>
              <div class="bar" style="height: 90%; animation-delay: -0.9s;"></div>
              <div class="bar" style="height: 40%; animation-delay: -1.0s;"></div>
              <div class="bar" style="height: 70%; animation-delay: -1.1s;"></div>
              <div class="bar" style="height: 100%; animation-delay: -1.2s;"></div>
              <div class="bar" style="height: 50%; animation-delay: -1.3s;"></div>
              <div class="bar" style="height: 80%; animation-delay: -1.4s;"></div>
              <div class="bar" style="height: 60%; animation-delay: -1.5s;"></div>
              <div class="bar" style="height: 90%; animation-delay: -1.6s;"></div>
              <div class="bar" style="height: 40%; animation-delay: -1.7s;"></div>
              <div class="bar" style="height: 70%; animation-delay: -1.8s;"></div>
              <div class="bar" style="height: 100%; animation-delay: -1.9s;"></div>
              <div class="bar" style="height: 50%; animation-delay: -2.0s;"></div>
            </div>
            <span class="text-sm text-gray-400 ml-4 whitespace-nowrap">Live</span>
          </div>
        </div>

        <div>
          <h3 class="text-lg font-semibold mb-4">Preferences</h3>
          <div class="space-y-4">
            <div class="flex items-center justify-between">
              <label class="text-sm text-gray-300" for="video-bg">Video Background</label>
              <label class="relative inline-flex items-center cursor-pointer">
                <input checked="" class="sr-only peer" id="video-bg" type="checkbox" value=""/>
                <div class="w-11 h-6 bg-[#2A232E] peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[var(--primary-color)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--primary-color)]"></div>
              </label>
            </div>

            <div>
              <label class="text-sm text-gray-300" for="video-url">Custom Video URL</label>
              <input id="video-url" class="mt-1 bg-[#2A232E] border border-transparent focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] rounded-lg px-4 py-2 text-sm w-full transition-all" placeholder="Enter YouTube video or playlist URL" type="text"/>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Editor -->
    <div class="col-span-1 @5xl:col-span-2 relative overflow-hidden rounded-lg border border-[#2A232E]">
      <div id="video-background" class="absolute inset-0 z-0">
        <iframe id="video-iframe" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full object-cover" frameborder="0" src="https://www.youtube.com/embed/zsu2WRFaUoQ?autoplay=1&mute=1&loop=1&playlist=zsu2WRFaUoQ&controls=0"></iframe>
      </div>

      <textarea id="main-editor" class="relative z-10 w-full h-full min-h-[500px] bg-transparent p-6 text-base text-gray-200 leading-relaxed placeholder-gray-400 focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition resize-none outline-none" placeholder="Describe your collection's story, key silhouettes, and fabric choices...">A key piece in the collection is a structured bustier top, crafted from duchess satin. The intricate boning and precisely placed darts create a flattering, sculpted silhouette that references classic corsetry while feeling modern and empowered. It's paired with a high-waisted, A-line skirt in a contrasting lightweight chiffon, allowing for fluid movement. The design employs a bias cut technique on the skirt to achieve a beautiful drape that follows the body's natural curves.</textarea>

      <div id="related-terms" class="absolute bottom-4 right-4 z-10 bg-[#1C1820]/80 border border-[#2A232E] rounded-lg p-3 shadow-lg flex items-center gap-3 text-sm">
        <span class="material-symbols-outlined text-[var(--primary-color)]">lightbulb</span>
        <span class="text-gray-300">Related:</span>
        <span class="font-medium text-white cursor-pointer hover:underline" data-term="corset">Corset</span>
        <span class="font-medium text-white cursor-pointer hover:underline" data-term="bodice">Bodice</span>
        <span class="font-medium text-white cursor-pointer hover:underline" data-term="satin">Satin</span>
      </div>
    </div>

    <!-- Theme Toggle -->
    <div class="fixed top-4 right-4 z-50 flex items-center space-x-2">
      <button id="theme-toggle" class="bg-[var(--bg-secondary)] text-[var(--text-primary)] p-2 rounded-full shadow-lg interactive-element">
        <span class="material-symbols-outlined">light_mode</span>
      </button>
    </div>
  </div>
</main>

<footer class="bg-[#1C1820] border-t border-[#2A232E] py-8 mt-auto">
  <div class="container mx-auto px-6">
    <div class="flex flex-col md:flex-row justify-between items-center">
      <div class="text-sm text-gray-400 mb-4 md:mb-0">
        <p>© 2025 Inkrealm. All rights reserved.</p>
      </div>
      <div class="flex items-center space-x-4">
        <a href="mailto:inkrealm@wordstar.nexus" class="text-gray-300 hover:text-white transition-colors flex items-center gap-2">
          <span class="material-symbols-outlined text-[var(--primary-color)]">mail</span>
          inkrealm@wordstar.nexus ↗
        </a>
      </div>
    </div>
  </div>
</footer>
</div>

<script>
// ===============================
// FLOATING LETTERS WITH PROPER CLEANUP
// ===============================
class FloatingLetters {
    constructor() {
        this.canvas = document.getElementById('floatingLetters');
        if (!this.canvas) return;
        
        this.ctx = this.canvas.getContext('2d');
        this.letters = [];
        this.mouse = { x: 0, y: 0, radius: 100 };
        this.animationId = null; // Track animation frame
        
        this.russianLetters = '.,?!;:'"()[]{}-–—_*/&%$#@~^';
        this.colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
        
        this.resize();
        this.init();
        this.animate();
        
        this.resizeHandler = () => this.resize();
        this.mouseMoveHandler = (e) => {
            this.mouse.x = e.clientX;
            this.mouse.y = e.clientY;
        };
        
        window.addEventListener('resize', this.resizeHandler);
        window.addEventListener('mousemove', this.mouseMoveHandler);
    }

    resize() {
        if (!this.canvas) return;
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
    }

    init() {
        const numberOfLetters = Math.min(50, Math.floor(window.innerWidth / 20));
        
        for (let i = 0; i < numberOfLetters; i++) {
            this.letters.push({
                char: this.russianLetters[Math.floor(Math.random() * this.russianLetters.length)],
                x: Math.random() * this.canvas.width,
                y: Math.random() * this.canvas.height,
                size: Math.random() * 20 + 15,
                speedX: (Math.random() - 0.5) * 2,
                speedY: (Math.random() - 0.5) * 2,
                opacity: Math.random() * 0.5 + 0.3,
                color: this.colors[Math.floor(Math.random() * this.colors.length)],
                rotation: Math.random() * 360,
                rotationSpeed: (Math.random() - 0.5) * 2,
                targetOpacity: Math.random() * 0.5 + 0.3,
                changeOpacity: Math.random() * 100
            });
        }
    }

    animate() {
        if (!this.canvas || !this.ctx) return;
        
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        this.letters.forEach(letter => {
            letter.x += letter.speedX;
            letter.y += letter.speedY;
            letter.rotation += letter.rotationSpeed;
            
            if (letter.x < 0 || letter.x > this.canvas.width) letter.speedX *= -1;
            if (letter.y < 0 || letter.y > this.canvas.height) letter.speedY *= -1;
            
            const dx = letter.x - this.mouse.x;
            const dy = letter.y - this.mouse.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < this.mouse.radius) {
                const angle = Math.atan2(dy, dx);
                const force = (this.mouse.radius - distance) / this.mouse.radius;
                letter.x += Math.cos(angle) * force * 5;
                letter.y += Math.sin(angle) * force * 5;
            }
            
            letter.changeOpacity--;
            if (letter.changeOpacity <= 0) {
                letter.targetOpacity = Math.random() * 0.5 + 0.3;
                letter.changeOpacity = Math.random() * 100 + 50;
            }
            
            letter.opacity += (letter.targetOpacity - letter.opacity) * 0.05;
            
            this.ctx.save();
            this.ctx.translate(letter.x, letter.y);
            this.ctx.rotate(letter.rotation * Math.PI / 180);
            this.ctx.globalAlpha = letter.opacity;
            this.ctx.fillStyle = letter.color;
            this.ctx.font = `${letter.size}px Arial`;
            this.ctx.textAlign = 'center';
            this.ctx.textBaseline = 'middle';
            this.ctx.fillText(letter.char, 0, 0);
            this.ctx.restore();
        });
        
        this.animationId = requestAnimationFrame(() => this.animate());
    }

    destroy() {
        // Cancel animation frame
        if (this.animationId) {
            cancelAnimationFrame(this.animationId);
            this.animationId = null;
        }
        
        // Remove event listeners
        window.removeEventListener('resize', this.resizeHandler);
        window.removeEventListener('mousemove', this.mouseMoveHandler);
        
        // Clear canvas
        if (this.ctx && this.canvas) {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        }
        
        // Nullify references
        this.canvas = null;
        this.ctx = null;
        this.letters = [];
    }
}

// Initialize and manage splash screen
let floatingLettersInstance = null;

document.addEventListener('DOMContentLoaded', function() {
    const splashScreen = document.getElementById('splash-screen');
    floatingLettersInstance = new FloatingLetters();
    
    // Hide splash screen after 3 seconds
    setTimeout(() => {
        splashScreen.style.opacity = '0';
        
        setTimeout(() => {
            // Properly destroy the animation
            if (floatingLettersInstance) {
                floatingLettersInstance.destroy();
                floatingLettersInstance = null;
            }
            
            // Remove from DOM
            if (splashScreen && splashScreen.parentNode) {
                splashScreen.parentNode.removeChild(splashScreen);
            }
        }, 800);
    }, 3000);
});

// ===============================
// State management
// ===============================
let autoSaveTimeout;
const savedState = {
  content: '',
  preferences: {
    videoBackground: true,
    customVideoUrl: 'https://www.youtube.com/watch?v=zsu2WRFaUoQ',
    font: 'Be Vietnam Pro'
  }
};

// ===============================
// Fashion Dictionary
// ===============================
const fashionDictionary = {
  'a-line': 'A garment silhouette that is fitted at the hips and gradually widens towards the hem, giving the impression of the shape of a capital letter A.',
  'applique': 'A decorative design made by cutting pieces of one material and applying them to the surface of another.',
  'avant-garde': 'New and experimental fashion ideas, often unconventional and ahead of current trends.',
  'bias-cut': 'A technique of cutting fabric diagonally across the grain, creating garments that drape naturally with body movement.',
  'bespoke': 'Custom-made clothing created specifically for an individual customer.',
  'bustier': 'A form-fitting garment worn as underwear or outerwear, designed to push up the bust and define the waist.',
  'chiffon': 'A lightweight, sheer fabric with a slightly rough texture.',
  'dart': 'A tapered seam used to shape flat fabric to the curves of the body.',
  'draping': 'The technique of positioning and pinning fabric on a dress form to design in 3D.',
  'embroidery': 'Decorative needlework in which designs are formed by stitching threads onto fabric.',
  'empire-waist': 'A style where the waistline is raised above the natural waist, just below the bust.',
  'haute-couture': 'High-end fashion constructed by hand from start to finish.',
  'peplum': 'A short overskirt or ruffle attached at the waist of a garment.',
  'corset': 'A close-fitting undergarment worn to shape and support the torso.',
  'bodice': 'The upper part of a dress or the part above the waist.',
  'satin': 'A smooth, glossy fabric with a lustrous surface.',
  'silhouette': 'The overall shape or outline of a garment when worn.',
  'texture': 'The surface quality or feel of a fabric.',
  'couture': 'High-quality, custom-fitted clothing made with attention to detail.'
};

// ===============================
// Get editor element
// ===============================
function getEditor() {
  return document.getElementById('main-editor');
}

// ===============================
// On page load
// ===============================
window.addEventListener('DOMContentLoaded', function() {
  const editor = getEditor();
  
  // Restore saved content
  const savedContent = localStorage.getItem('runway-content');
  if (savedContent) {
    editor.value = savedContent;
  }

  // Restore preferences or set defaults
  const savedPrefs = localStorage.getItem('runway-preferences');
  if (savedPrefs) {
    Object.assign(savedState.preferences, JSON.parse(savedPrefs));
    applyPreferences();
  } else {
    updateVideoUrl(savedState.preferences.customVideoUrl);
  }

  updateWordCount();
  updateClocks();
  setInterval(updateClocks, 1000);
  updateActivityBars();
});

// ===============================
// Real-time clocks
// ===============================
function updateClocks() {
  const now = new Date();
  const rome = new Date(now.toLocaleString("en-US", { timeZone: "Europe/Rome" }));
  document.getElementById('rome-time').textContent = rome.toLocaleTimeString('en-US', {
    hour: 'numeric', minute: '2-digit', hour12: true
  });
}

// ===============================
// Text formatting
// ===============================
function formatText(command) {
  const editor = getEditor();
  const start = editor.selectionStart;
  const end = editor.selectionEnd;
  const selectedText = editor.value.substring(start, end);
  
  if (selectedText) {
    let formattedText = selectedText;
    switch(command) {
      case 'bold':
        formattedText = `**${selectedText}**`;
        break;
      case 'italic':
        formattedText = `*${selectedText}*`;
        break;
      case 'underline':
        formattedText = `__${selectedText}__`;
        break;
    }
    
    editor.value = editor.value.substring(0, start) + formattedText + editor.value.substring(end);
    editor.focus();
    editor.setSelectionRange(start + formattedText.length, start + formattedText.length);
    
    triggerAutoSave();
    updateWordCount();
  }
}

// Formatting button events
document.getElementById('bold-btn').addEventListener('click', () => formatText('bold'));
document.getElementById('italic-btn').addEventListener('click', () => formatText('italic'));
document.getElementById('underline-btn').addEventListener('click', () => formatText('underline'));

// ===============================
// Font selector
// ===============================
document.getElementById('font-select').addEventListener('change', function(e) {
  const font = e.target.value;
  getEditor().style.fontFamily = font;
  savedState.preferences.font = font;
  savePreferences();
});

// ===============================
// Word counter
// ===============================
const editor = getEditor();
editor.addEventListener('input', function() {
  updateWordCount();
  triggerAutoSave();
  updateActivityBars();
});

function updateWordCount() {
  const text = getEditor().value.trim();
  const wordCount = text === '' ? 0 : text.split(/\s+/).length;
  const maxWords = 500;
  const percentage = Math.min((wordCount / maxWords) * 100, 100);

  document.getElementById('word-count').textContent = `${wordCount} / ${maxWords}`;
  document.getElementById('word-progress').style.width = `${percentage}%`;

  const progressBar = document.getElementById('word-progress');
  if (percentage > 90) {
    progressBar.style.backgroundColor = '#ef4444';
  } else if (percentage > 75) {
    progressBar.style.backgroundColor = '#f59e0b';
  } else {
    progressBar.style.backgroundColor = 'var(--primary-color)';
  }
}

function updateActivityBars() {
  const bars = document.querySelectorAll('#activity-bars .bar');
  bars.forEach(bar => {
    const randomHeight = Math.random() * 80 + 20;
    bar.style.height = `${randomHeight}%`;
  });
}

// ===============================
// Auto-save
// ===============================
function triggerAutoSave() {
  clearTimeout(autoSaveTimeout);
  autoSaveTimeout = setTimeout(autoSave, 2000);
}

function autoSave() {
  const content = getEditor().value;
  localStorage.setItem('runway-content', content);

  const indicator = document.querySelector('.auto-save-indicator');
  indicator.classList.add('show');
  setTimeout(() => indicator.classList.remove('show'), 2000);
}

function savePreferences() {
  localStorage.setItem('runway-preferences', JSON.stringify(savedState.preferences));
}

function applyPreferences() {
  document.getElementById('video-bg').checked = savedState.preferences.videoBackground;
  document.getElementById('video-url').value = savedState.preferences.customVideoUrl;
  document.getElementById('font-select').value = savedState.preferences.font;

  getEditor().style.fontFamily = savedState.preferences.font;

  toggleVideoBackground(savedState.preferences.videoBackground);
  if (savedState.preferences.customVideoUrl) {
    updateVideoUrl(savedState.preferences.customVideoUrl);
  }
}

// ===============================
// Dictionary functionality
// ===============================
function insertAtCursor(text) {
  const editor = getEditor();
  const start = editor.selectionStart;
  const end = editor.selectionEnd;
  
  editor.value = editor.value.substring(0, start) + ' ' + text + ' ' + editor.value.substring(end);
  editor.focus();
  editor.setSelectionRange(start + text.length + 2, start + text.length + 2);
  
  triggerAutoSave();
  updateWordCount();
}

function showDefinition(term) {
  const definition = fashionDictionary[term.toLowerCase()] || fashionDictionary[term.replace('-', '').toLowerCase()];
  if (definition) {
    let popup = document.getElementById('definition-popup');
    if (!popup) {
      popup = document.createElement('div');
      popup.id = 'definition-popup';
      popup.className = 'fixed bottom-20 left-6 bg-[#1C1820] border border-[#2A232E] rounded-lg p-4 max-w-sm z-30 shadow-lg';
      document.body.appendChild(popup);
    }

    popup.innerHTML = `
      <div class="flex justify-between items-start mb-2">
        <h4 class="font-semibold text-[var(--primary-color)] capitalize">${term.replace('-', ' ')}</h4>
        <button onclick="closeDefinition()" class="text-gray-400 hover:text-white">
          <span class="material-symbols-outlined text-sm">close</span>
        </button>
      </div>
      <p class="text-sm text-gray-300 leading-relaxed">${definition}</p>
    `;

    popup.style.display = 'block';
    setTimeout(() => { if (popup) closeDefinition(); }, 8000);
  }
}

function closeDefinition() {
  const popup = document.getElementById('definition-popup');
  if (popup) popup.style.display = 'none';
}

// Related terms
document.querySelectorAll('#related-terms [data-term]').forEach(term => {
  term.addEventListener('click', function(e) {
    e.preventDefault();
    const termText = this.textContent;
    const termKey = this.getAttribute('data-term');
    insertAtCursor(termText);
    showDefinition(termKey);
  });
});

// ===============================
// Video background controls
// ===============================
document.getElementById('video-bg').addEventListener('change', function(e) {
  savedState.preferences.videoBackground = e.target.checked;
  toggleVideoBackground(e.target.checked);
  savePreferences();
});

document.getElementById('video-url').addEventListener('change', function(e) {
  savedState.preferences.customVideoUrl = e.target.value;
  if (e.target.value && savedState.preferences.videoBackground) {
    updateVideoUrl(e.target.value);
  }
  savePreferences();
});

function toggleVideoBackground(show) {
  const videoBackground = document.getElementById('video-background');
  videoBackground.style.display = show ? 'block' : 'none';
}

function updateVideoUrl(url) {
  const iframe = document.getElementById('video-iframe');
  let embedUrl = url;

  if (url.includes('youtube.com/watch')) {
    const videoId = url.split('v=')[1].split('&')[0];
    embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&controls=0&playlist=${videoId}`;
  } else if (url.includes('youtu.be/')) {
    const videoId = url.split('youtu.be/')[1].split('?')[0];
    embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&controls=0&playlist=${videoId}`;
  } else if (url.includes('youtube.com/playlist') || url.includes('list=')) {
    const playlistId = url.split('list=')[1].split('&')[0];
    embedUrl = `https://www.youtube.com/embed/videoseries?list=${playlistId}&autoplay=1&mute=1&loop=1&controls=0`;
  }

  iframe.src = embedUrl;
}

// ===============================
// PDF functionality
// ===============================
document.getElementById('save-pdf').addEventListener('click', function() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  
  const title = 'Runway Text';
  const content = getEditor().value;
  const wordCount = content.trim() === '' ? 0 : content.trim().split(/\s+/).length;
  
  doc.setFontSize(20);
  doc.text(title, 20, 30);
  
  doc.setFontSize(10);
  doc.text(`Generated: ${new Date().toLocaleDateString()}`, 20, 45);
  doc.text(`Word Count: ${wordCount}`, 20, 52);
  
  doc.setFontSize(12);
  const splitContent = doc.splitTextToSize(content, 170);
  doc.text(splitContent, 20, 70);
  
  doc.save('runway-project.pdf');
  
  const button = this;
  const originalText = button.innerHTML;
  button.innerHTML = '<span class="material-symbols-outlined">check</span><span>Saved!</span>';
  setTimeout(() => { button.innerHTML = originalText; }, 2000);
});

// ===============================
// Theme toggle
// ===============================
const themeToggle = document.getElementById('theme-toggle');
const themeIcon = themeToggle.querySelector('.material-symbols-outlined');

const savedTheme = localStorage.getItem('runway-theme') || 
    (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

function setTheme(theme) {
    if (theme === 'light') {
        document.documentElement.classList.add('light-mode');
        themeIcon.textContent = 'dark_mode';
        localStorage.setItem('runway-theme', 'light');
    } else {
        document.documentElement.classList.remove('light-mode');
        themeIcon.textContent = 'light_mode';
        localStorage.setItem('runway-theme', 'dark');
    }
}

setTheme(savedTheme);

themeToggle.addEventListener('click', () => {
    const currentTheme = document.documentElement.classList.contains('light-mode') ? 'light' : 'dark';
    setTheme(currentTheme === 'dark' ? 'light' : 'dark');
});

// ===============================
// Keyboard shortcuts
// ===============================
document.addEventListener('keydown', function(e) {
  if (e.ctrlKey || e.metaKey) {
    switch(e.key) {
      case 'b': e.preventDefault(); formatText('bold'); break;
      case 'i': e.preventDefault(); formatText('italic'); break;
      case 'u': e.preventDefault(); formatText('underline'); break;
      case 's': e.preventDefault(); autoSave(); break;
    }
  }
});

// Initialize word count
setTimeout(updateWordCount, 100);
