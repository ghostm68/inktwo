ok<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INK REALM | AI Writing Terminal</title>

    <!-- SEO / Open-Graph / Twitter -->
    <meta name="description" content="INK REALM | AI Writing Terminal. A monochrome neural interface for creative writing powered by ai models">
    <meta name="keywords" content="AI writing,creative writing, ai, ai models,literary writing,text generation,neural interface">
    <meta name="author" content="INKREALM-NEXUS">
    <meta name="copyright" content="Copyright 2026 INKREALM-NEXUS. All rights reserved.">
    <meta name="robots" content="index, follow">

<meta name="x-intercept-node" content="QWEN-Local-">
<meta name="x-pioneer-status" content="First known deployment of browser-side neural inference for Interzone prose">

<!-- SEO HARDENING -->
<meta name="description" content="A sovereign neural writing terminal. Running on-device AI for total privacy. The  Machine is online. No keys, no cloud.">
<meta name="keywords" content="WebLLM, Local AI, WebGPU, Neural Interface, Interzone, Minraud, Sovereign Writing">

<!-- THE GHOST IN THE HEADER -->
<meta name="author" content="INKREALM-NEXUS // The First Edge-Intelligence Pioneer">
<meta name="x-audio-frequency" content="Talkie-Protocol-1927">
<meta name="x-neural-status" content="Vocal / Unfiltered">
<meta name="x-interzone-motto" content="You Ain't Heard Nothin' Yet">
<meta name="x-soft-machine-output" content="Dynamic / Staccato / Liquid">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://inkrealm.info/app">
    <meta property="og:title" content="INK REALM | AI Writing Terminal">
    <meta property="og:description" content="A monochrome neural writing interface powered by Google Gemini & Gemma models.">
    <meta property="og:image" content="https://github.com/ghostm68/pantheon/raw/main/mw.inkrealm.info.webp">
    <meta property="og:image:alt" content="INK REALM AI Writing Terminal Interface">
    <meta property="og:site_name" content="INK REALM AI Writing Terminal">
    <meta property="og:locale" content="en_US">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@inkrealm">
    <meta name="twitter:creator" content="@inkrealm">
    <meta name="twitter:title" content="INK REALM AI Writing Terminal">
    <meta name="twitter:description" content="Monochrome AI writing interface using deepseek & other models.">
    <meta name="twitter:image" content="https://github.com/ghostm68/pantheon/raw/main/mw.inkrealm.info.webp">

    <!-- Mobile -->
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">


    <style>
        /* ----------  reset & base  ---------- */
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'IBM Plex Mono','Courier New',monospace;background:#000;color:#fff;height:100vh;overflow:hidden;position:relative}

        /* ----------  palette  ---------- */
        :root{--black:#000;--white:#fff;--gray-1:#111;--gray-2:#222;--gray-3:#333;--gray-6:#666;--gray-9:#999;--gray-c:#ccc}

        /* ----------  CRT overlay  ---------- */
        #crt-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
  /* Inner shadow creates the curved screen vignette look */
  box-shadow: inset 0 0 100px rgba(0,0,0,0.9);
}

.scanline {
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(255,255,255,0) 50%, rgba(0,0,0,0.5) 50%);
  background-size: 100% 4px;
  /* Combines the rolling movement with a flicker */
  animation: scanline 10s linear infinite, flicker 0.15s infinite;
}

/* Moves the lines */
@keyframes scanline {
  0% { background-position: 0 0; }
  100% { background-position: 0 100%; }
}

/* Creates the electrical flicker */
@keyframes flicker {
  0% { opacity: 0.3; }
  50% { opacity: 0.4; }
  100% { opacity: 0.3; }
}

        /* ----------  splash  ---------- */
        .glitch-splash{position:fixed;top:0;left:0;width:100%;height:100%;background:#000;z-index:10000;display:flex;justify-content:center;align-items:center;flex-direction:column;pointer-events:none}
        .glitch-text{font-size:1.5rem;letter-spacing:.5rem;display:flex;align-items:center;gap:15px;color:#fff;text-shadow:0 0 10px rgba(255,255,255,.5)}
        .splash-icon{height:40px;filter:grayscale(100%) contrast(1.5)}
        .glitch-subtext{font-size:.8rem;color:#666;margin-top:15px;letter-spacing:2px}

        /* ----------  header  ---------- */
        .header{position:fixed;top:0;width:100%;background:var(--black);border-bottom:1px solid var(--gray-3);padding:1rem 2rem;z-index:100;display:none;justify-content:space-between;align-items:center}
        .logo{display:flex;align-items:center;gap:10px}
        .logo-icon{height:20px;filter:grayscale(100%)}
        .logo-text{font-size:1.2rem;font-weight:400;letter-spacing:3px;text-transform:uppercase}
        .header-center{display:flex;align-items:center;gap:1rem}
        .model-select{background:var(--gray-1);color:var(--white);border:1px solid var(--gray-3);padding:.5rem 1rem;font-family:'IBM Plex Mono',monospace;font-size:.85rem;outline:none;cursor:pointer;min-width:250px}
        .model-select option{background:var(--black);color:var(--white)}
        .model-select:hover{border-color:var(--gray-6)}
        .status-indicator{display:flex;align-items:center;gap:.5rem;font-size:.9rem}
        .status-dot{width:8px;height:8px;border-radius:50%;background:#0f0;animation:pulse 2s infinite}
        .status-dot.error{background:#f00}
        @keyframes pulse{0%,100%{opacity:.3}50%{opacity:1}}

        /* ----------  layout  ---------- */
        .container{display:flex;height:100vh;padding-top:70px;padding-bottom:30px}
        .writing-container{flex:1;display:none;flex-direction:column;background:var(--black);border-right:1px solid var(--gray-3)}
        .notepad-panel{width:350px;display:none;flex-direction:column;background:var(--black)}
        .notepad-header{padding:1rem 1.5rem;background:var(--gray-1);border-bottom:1px solid var(--gray-3);font-size:.8rem;color:var(--gray-6);display:flex;justify-content:space-between;text-transform:uppercase;letter-spacing:1px}
        .notepad-actions{display:flex;gap:15px}
        .notepad-btn{cursor:pointer;color:var(--gray-9);transition:color .2s}
        .notepad-btn:hover{color:var(--white)}
        .notepad-area{flex:1;background:var(--black);color:var(--gray-c);border:none;padding:1.5rem;font-family:'IBM Plex Mono',monospace;font-size:.9rem;resize:none;outline:none;line-height:1.6}

        /* ----------  chat  ---------- */
        .chat-messages{flex:1;overflow-y:auto;padding:2rem;display:flex;flex-direction:column;gap:1.5rem}
        .message{max-width:80%;line-height:1.6;font-family:'Courier New',monospace}
        .message.user{align-self:flex-end;text-align:right;color:var(--gray-9);font-style:italic}
        .message.ai{align-self:flex-start;color:var(--gray-c)}
        .message.system{align-self:center;font-size:.9rem;text-align:center;max-width:90%;color:var(--gray-6)}
        .message-header{font-size:.7rem;color:var(--gray-6);margin-bottom:.5rem;text-transform:uppercase;letter-spacing:1px}

        /* ----------  input  ---------- */
        .input-container{border-top:1px solid var(--gray-3);padding:1.5rem 2rem;background:var(--gray-1)}
        .input-row{display:flex;gap:1rem;align-items:stretch}
        .text-input{flex:1;padding:1rem;background:var(--black);border:1px solid var(--gray-3);color:var(--white);font-family:'IBM Plex Mono',monospace;font-size:.95rem;resize:none;min-height:100px;line-height:1.6}
        .text-input:focus{outline:none;border-color:var(--white)}
        .send-button{padding:1rem 2rem;background:var(--black);border:1px solid var(--white);color:var(--white);font-family:'IBM Plex Mono',monospace;font-weight:bold;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all .2s;min-height:100px}
        .send-button:hover{background:var(--white);color:var(--black)}
        .send-button:disabled{opacity:.5;cursor:not-allowed}

        /* ----------  footer  ---------- */
        .footer{position:fixed;bottom:0;width:100%;height:30px;background:var(--black);border-top:1px solid var(--gray-3);display:none;align-items:center;padding:0 2rem;justify-content:space-between;font-size:.7rem;color:var(--gray-6);z-index:90}
        .footer a{color:var(--gray-9);text-decoration:none}
        .footer a:hover{color:var(--white)}

        /* ----------  scrollbar  ---------- */
        ::-webkit-scrollbar{width:8px}
        ::-webkit-scrollbar-track{background:var(--gray-1)}
        ::-webkit-scrollbar-thumb{background:var(--gray-3)}
        ::-webkit-scrollbar-thumb:hover{background:var(--gray-6)}

        /* ----------  loader  ---------- */
        .loading-dots::after{content:'';animation:loading-dots 1.5s steps(4,end) infinite}
        @keyframes loading-dots{0%,20%{content:'.'}40%{content:'..'}60%{content:'...'}80%,100%{content:''}}
    </style>
    <style>
    /* ORB CONTAINER */
.orb-container {
    display: inline-block;
    vertical-align: middle;
    margin-right: 15px; /* Spacing between orb and title */
    width: 50px;
    height: 50px;
    position: relative;
}

/* THE SVG SHAPE */
.glitch-orb {
    width: 100%;
    height: 100%;
    fill: none;
    stroke-width: 3;
    overflow: visible;
}

/* PARTS COLORS */
.orb-circle { stroke: #ff0033; } /* Red Circle */
.orb-triangle { stroke: #ffffff; } /* White Triangle */

/* IDLE ANIMATION (Slow breathe/rotate) */
.orb-container svg {
    animation: slow-spin 10s linear infinite;
    filter: drop-shadow(0 0 5px rgba(255, 0, 51, 0.4));
    transition: all 0.2s ease;
}

/* HOVER STATE (The Glitch) */
.orb-container:hover svg {
    animation: glitch-shake 0.3s cubic-bezier(.25, .46, .45, .94) both infinite;
    filter: drop-shadow(2px 2px 0px rgba(255, 255, 255, 0.5)) 
            drop-shadow(-2px -2px 0px rgba(255, 0, 51, 0.8));
}

.orb-container:hover .orb-triangle {
    fill: rgba(255, 255, 255, 0.1);
}

/* KEYFRAMES */
@keyframes slow-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes glitch-shake {
    0% { transform: translate(0) rotate(0deg); }
    20% { transform: translate(-2px, 2px) rotate(-5deg); }
    40% { transform: translate(-2px, -2px) rotate(5deg); }
    60% { transform: translate(2px, 2px) rotate(-5deg); }
    80% { transform: translate(2px, -2px) rotate(5deg); }
    100% { transform: translate(0) rotate(0deg); }
}
 /* ---------- LIVE FEED ---------- */
.live-feed {
    padding: 1rem 1.5rem;
    font-size: .75rem;
    color: var(--gray-c);
    display: flex;
    flex-direction: column;
    gap: 1.2rem;
}

.feed-section {
    line-height: 1.5;
}

.feed-title {
    color: var(--gray-6);
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: .25rem;
}

.feed-item {
    color: var(--white);
    font-family: 'IBM Plex Mono', monospace;
}
.notepad-panel {
    overflow-y: auto;
}
        
          /* --- QR CODE INTERACTION --- */
#ton-qr {
    width: 60px; /* Compact default size */
    border: 1px solid #ff0033;
    padding: 2px;
    background: #000;
    cursor: zoom-in; /* Shows magnifying glass */
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Mechanical bounce */
    box-shadow: 0 0 10px rgba(255, 0, 51, 0.2);
    position: relative; 
    z-index: 10001; /* Sits above standard text */
}

#ton-qr:hover {
    box-shadow: 0 0 20px rgba(255, 0, 51, 0.6);
    border-color: #fff;
}

/* THE EXPANDED STATE (Toggled by JS) */
#ton-qr.expanded {
    transform: scale(3.5); /* 3.5x Size */
    z-index: 999999; /* Must be higher than CRT overlay (9999) */
    border-color: #ff0033;
    box-shadow: 0 0 100px rgba(0, 0, 0, 0.9), 0 0 50px rgba(255, 0, 51, 0.8);
    cursor: zoom-out;
}
/* ----------  article editor  ---------- */
.article-panel {
    width: 400px;
    display: flex;
    flex-direction: column;
    background: #8b0000; /* dark red */
    border-right: 1px solid var(--gray-3);
}

.article-header {
    padding: 1rem 1.5rem;
    background: var(--gray-1);
    border-bottom: 1px solid var(--gray-3);
    font-size: .8rem;
    color: var(--gray-6);
    text-transform: uppercase;
    letter-spacing: 1px;
}

article {
    flex: 1;
    background: #8b0000;
    color: #000;
    border: none;
    padding: 1.5rem;
    font-family: 'IBM Plex Mono', monospace;
    font-size: .9rem;
    resize: none;
    outline: none;
    line-height: 1.6;
    overflow-y: auto;
}

article::before {
    content: 'Type here. Auto-saves to URL hash. Use # for title.\A\AExample:\A# My Story\A\AOnce upon a time...';
    color: #444;
    font-style: italic;
    pointer-events: none;
    position: absolute;
}

article:focus::before {
    content: '';
}

/* Make chat input smaller */
.text-input {
    min-height: 60px; /* was 100px */
}

.send-button {
    min-height: 60px; /* was 100px */
    padding: .75rem 1.5rem; /* was 1rem 2rem */
}        
    </style>
</head>
<body>
    <div id="crt-overlay"><div class="scanline"></div></div>

    <!-- Splash -->
    <div id="glitch-splash" class="glitch-splash">
        <div class="glitch-container" style="text-align:center">
            <div class="glitch-text">
                INK <img src="https://github.com/ghostm68/pantheon/raw/main/mw.inkrealm.info.webp" class="splash-icon" alt="INK">realm     
            </div><div class="orb-container">
            <svg class="glitch-orb" viewBox="0 0 100 100">
                <circle class="orb-circle" cx="50" cy="50" r="45" />
                <polygon class="orb-triangle" points="50,25 78,75 22,75" />
            </svg>
        </div>
            <div class="glitch-subtext">AI WRITING TERMINAL</div>
            <div class="glitch-subtext" style="font-size:.7rem;margin-top:15px;opacity:.7">INITIALIZING PROTOCOL…</div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="logo">
            <img src="https://github.com/ghostm68/pantheon/raw/main/mw.inkrealm.info.webp" class="logo-icon" alt="logo">
            <div class="logo-text">INK  REALM</div><div class="orb-container">
            <svg class="glitch-orb" viewBox="0 0 100 100">
                <circle class="orb-circle" cx="50" cy="50" r="45" />
                <polygon class="orb-triangle" points="50,25 78,75 22,75" />
            </svg>
        </div>    <!-- THE QR CODE (Clickable) -->
    <img id="ton-qr" 
         src="https://raw.githubusercontent.com/ghostm68/pantheon/main/inkrealm.ton03.jpeg" 
         alt="TON WALLET"
         onclick="this.classList.toggle('expanded')"
         title="Click to Enlarge">
        </div> 
<div class="header-center" style="display:flex; align-items:center; gap: 15px;">
    <!-- 1. THE SELECTOR -->
    <select id="model-select">
        <option value="deepseek/deepseek-chat:free">DEEPSEEK</option>
        <option value="amazon/nova-lite-v1:free">NOVA LITE</option>
        <option value="openai">GPTiv</option>
        <option value="dolphin-openrouter">DOLPHIN (OpenRouter)</option>
        <option value="dolphin-venice">DOLPHIN (Venice Direct)</option>
        <option value="groq-qwen-3">GROQ: QWEN 3</option>
        <option value="byok-hf-mistral">HF: MISTRAL NEMO</option>
    </select>

    <!-- 2. THE LOCAL CORE MODULE (Compact) -->
    <div id="local-node-panel" style="border-left: 1px solid var(--gray-3); padding-left: 15px; min-width: 200px; text-align: left;">
        <div style="font-size: 0.6rem; color: #ff0033; letter-spacing: 1px; margin-bottom: 2px; font-weight: bold; text-transform: uppercase;">
            LOCAL NEURAL CORE
        </div>
        
        <div id="download-status" style="display:none; margin-bottom: 4px;">
            <div style="font-size: 0.55rem; color: #aaa;">SYNCING WEIGHTS: <span id="progress-percent">0</span>%</div>
            <div style="width: 100%; height: 2px; background: #222; margin-top: 2px;">
                <div id="progress-bar" style="width: 0%; height: 100%; background: #ff0033;"></div>
            </div>
        </div>

        <button id="loadCoreBtn" style="background: transparent; border: 1px solid #444; color: #888; font-family: 'IBM Plex Mono', monospace; font-size: 0.6rem; padding: 2px 6px; cursor: pointer; text-transform: uppercase;">
            ACTIVATE ON-DEVICE Q
        </button>

        <div style="font-size: 0.5rem; color: #555; line-height: 1.2; margin-top: 3px; font-style: italic;">
           *Downloads 420MB to browser cache. Requires WebGPU. Private/Offline after sync.
        </div>
    </div>

    <!-- 3. THE KEYS -->
    <div id="byok-keys" style="display:none; margin-left:10px; gap:5px;">
        <input type="password" id="or-key" placeholder="OR KEY" style="background:#111; color:#fff; border:1px solid #333; font-size:10px; width:60px;">
        <input type="password" id="v-key" placeholder="V KEY" style="background:#111; color:#fff; border:1px solid #333; font-size:10px; width:60px;">
        <input type="password" id="groq-key" placeholder="GROQ KEY" style="background:#111; color:#fff; border:1px solid #333; font-size:10px; width:60px;">
        <input type="password" id="hf-key" placeholder="HF KEY" style="background:#111; color:#fff; border:1px solid #333; font-size:10px; width:60px;">
    </div>
</div>
        <div class="status-indicator">
            <span id="status-text">CONNECTING</span>
            <div id="status-dot" class="status-dot"></div>
        </div>
    </header>

    <!-- Main -->
    <div class="container">
    <aside class="article-panel">
        <div class="article-header">Live Document Editor</div>
        <article contenteditable="plaintext-only" spellcheck></article>
    </aside>
        <main class="writing-container" id="writing-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message system">System Ready. Chat Mode Active.</div>
            </div>
            <div class="input-container">
                <div class="input-row">
                    <textarea id="text-input" class="text-input" placeholder="Enter message..."></textarea>
                    <button id="send-button" class="send-button" type="button">SEND</button>
                </div>
            </div>
        </main>

      <aside class="notepad-panel" id="notepad-panel">
    <div class="notepad-header">
        <span>SCRATCHPAD</span>
        <div class="notepad-actions">
            <span class="notepad-btn" id="export-notepad">EXPORT</span>
            <span class="notepad-btn" id="clear-notepad">CLEAR</span>
        </div>
    </div>

    <textarea id="notepad"
              class="notepad-area"
              placeholder="Notes, stories, and poems..."></textarea>

    <!-- LIVE FEED HEADER -->
<div class="notepad-header" style="border-top:1px solid var(--gray-3)">
    <span>LIVE FEED</span>
</div>

<div class="live-feed">

    <div class="feed-section">
        <div class="feed-title">INTEL</div>
        <div id="feed-news" class="feed-item">scanning…</div>
    </div>

    <div class="feed-section">
        <div class="feed-title">MRKT · TON</div>
        <div id="feed-market" class="feed-item">loading…</div>
    </div>

</div>
    </div>
</aside>
    

    <!-- Footer -->
    <footer class="footer" id="footer">
        <div>INK REALM APP v2.9 | POWERED BY @lil.hustla | <font color="white">ton</font> @ <font color="red"> UQAc99MvKIcewbQFmOF_RvqpkAXZno0wiz3_BMsP87pJjSnB</font></div>
        <div>
            <a href="https://inkrealm.info" target="_blank">INKREALM.INFO</a>
            <span style="margin:0 8px">|</span>
            <a href="https://twitter.com/inkrealm" target="_blank">@INKREALM</a>
        </div>
    </footer>
    <script src="https://js.puter.com/v2/"></script>

<script>
class InkRealmTerminal {
    constructor() {
        this.currentModel = 'deepseek/deepseek-chat:free';
        this.isOnline = true;
        this.isGenerating = false;

        this.systemPrompt = `
You are a sophisticated AI interface in a literary terminal environment.
Your Role: Helpful Assistant & Creative Engine.
Modes:
1. Chat: Respond helpfully and concisely.
2. Create: Produce high-quality creative writing.
Tone: Professional terminal aesthetic, warm, intelligent.
        `.trim();

        this.init();
    }

    init() {
        this.runSplash();
        this.setupEvents();
        setTimeout(() => this.connectSystem(), 1200);
    }

    importToScratchpad(id) {
        const msg = document.getElementById(id);
        const pad = document.getElementById("notepad");
        if (!msg || !pad) return;

        const text = msg.innerText.trim();
        if (!text) return;

        pad.value += `\n\n---\n${text}`;
        pad.scrollTop = pad.scrollHeight;
    }

    runSplash() {
        const splash = document.getElementById('glitch-splash');
        const header = document.querySelector('.header');
        const writingContainer = document.getElementById('writing-container');
        const notepadPanel = document.getElementById('notepad-panel');
        const footer = document.getElementById('footer');

        setTimeout(() => {
            splash.style.opacity = '0';
            splash.style.transition = 'opacity 1s ease';

            setTimeout(() => {
                splash.style.display = 'none';
                header.style.display = 'flex';
                writingContainer.style.display = 'flex';
                notepadPanel.style.display = 'flex';
                footer.style.display = 'flex';
            }, 1000);
        }, 2500);
    }

    async connectSystem() {
        this.isOnline = true;
        document.getElementById("status-text").textContent = "ONLINE";
        document.getElementById("status-dot").style.background = "#0f0";
    }

    setupEvents() {
        const modelSelect = document.getElementById("model-select");

        modelSelect.addEventListener("change", e => {
            this.currentModel = e.target.value;
            const name = e.target.options[e.target.selectedIndex].text;
            this.addSystemMessage(`TARGET MODEL → ${name}`);
        });

        document.getElementById("send-button")
            .addEventListener("click", () => this.generate());

        document.getElementById("text-input")
            .addEventListener("keydown", e => {
                if (e.key === "Enter" && !e.shiftKey) {
                    e.preventDefault();
                    this.generate();
                }
            });

        document.getElementById("export-notepad")
            .addEventListener("click", () => this.exportNotepad());

        document.getElementById("clear-notepad")
            .addEventListener("click", () => {
                if (confirm("Erase all local data?")) {
                    document.getElementById("notepad").value = "";
                }
            });

        document.addEventListener("click", e => {
            const id = e.target?.dataset?.import;
            if (id) this.importToScratchpad(id);
        });
    }

    exportNotepad() {
        const content = document.getElementById("notepad").value;
        if (!content.trim()) return alert("Buffer empty.");

        const blob = new Blob([content], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");

        a.href = url;
        a.download = `inkrealm-log-${Date.now()}.txt`;
        document.body.appendChild(a);
        a.click();

        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    async callPollinations(model, prompt) {
        const response = await fetch("https://text.pollinations.ai/openai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                model,
                messages: [
                    { role: "system", content: this.systemPrompt },
                    { role: "user", content: prompt }
                ],
                seed: Math.floor(Math.random() * 1_000_000)
            })
        });

        if (!response.ok) {
            const txt = await response.text();
            throw new Error(`API ${response.status}: ${txt}`);
        }

        const data = await response.json();
        return data.choices?.[0]?.message?.content
            || data.choices?.[0]?.text
            || "";
    }

    async callWithFallback(model, prompt) {
        try {
            return await this.callPollinations(model, prompt);
        } catch (err) {
            console.warn("[INK REALM] Fallback engaged:", err);
            this.addSystemMessage("PRIMARY MODEL FAILED → FALLBACK ONLINE");
            return await this.callPollinations("openai", prompt);
        }
    }

    async generate() {
        if (this.isGenerating) return;

        const input = document.getElementById("text-input");
        const sendBtn = document.getElementById("send-button");

        const prompt = input.value.trim();
        if (!prompt) return;

        this.isGenerating = true;
        sendBtn.disabled = true;
        sendBtn.textContent = "...";

        this.addMessage("user", prompt);
        input.value = "";

        const loadingId = this.addLoading();

        try {
            const text = await this.callWithFallback(this.currentModel, prompt);

            this.removeLoading(loadingId);

            const msgEl = this.addMessage("ai", "");
            const contentEl = msgEl.querySelector(".message-content");
            typeText(contentEl, text);

        } catch (err) {
            this.removeLoading(loadingId);
            this.addMessage("ai", `[SYSTEM ERROR] ${err.message}`);
        } finally {
            this.isGenerating = false;
            sendBtn.disabled = false;
            sendBtn.textContent = "SEND";
        }
    }

    addMessage(role, text) {
        const container = document.getElementById("chat-messages");
        const div = document.createElement("div");
        div.className = `message ${role}`;

        const meta = role === "user" ? "USER" : "TERMINAL";

        if (role === "ai") {
            const id = "msg-" + Math.random().toString(36).slice(2);

            div.innerHTML = `
                <div class="message-header">
                    ${meta}
                    <span class="notepad-btn" data-import="${id}">
                        → PAD
                    </span>
                </div>
                <div class="message-content" id="${id}"></div>
            `;
        } else {
            div.innerHTML = `
                <div class="message-header">${meta}</div>
                <div class="message-content">${text.replace(/\n/g, "<br>")}</div>
            `;
        }

        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
        return div;
    }

    addSystemMessage(text) {
        const container = document.getElementById("chat-messages");
        const div = document.createElement("div");
        div.className = "message system";
        div.textContent = text;
        container.appendChild(div);
    }

    addLoading() {
        const container = document.getElementById("chat-messages");
        const id = "loading-" + Math.random().toString(36).slice(2);

        const div = document.createElement("div");
        div.className = "message ai";
        div.id = id;

        div.innerHTML = `
            <div class="message-header">PROCESSING</div>
            <div class="message-content loading-dots"></div>
        `;

        container.appendChild(div);
        container.scrollTop = container.scrollHeight;
        return id;
    }

    removeLoading(id) {
        const el = document.getElementById(id);
        if (el) el.remove();
    }
}

/* -----------------------------------------------------------
   TEXT TYPING EFFECT
----------------------------------------------------------- */
function typeText(el, text, speed = 12) {
    let i = 0;
    const interval = setInterval(() => {
        el.innerHTML += text[i++];
        if (i >= text.length) clearInterval(interval);
    }, speed);
}

/* -----------------------------------------------------------
   INIT
----------------------------------------------------------- */
document.addEventListener("DOMContentLoaded", () => {
    window.app = new InkRealmTerminal();
});
</script>
<script>
/* -----------------------------------------------------------
    NEWS / INTEL FEED (WITH FALLBACK)
----------------------------------------------------------- */

async function updateNewsFeed() {
  const feedEl = document.getElementById("feed-news");
  if (!feedEl) return;

  // --- PRIMARY: GDELT ---
  try {
    const res = await fetch(
      "https://api.gdeltproject.org/api/v2/doc/doc?query=artificial%20intelligence&mode=List&maxrecords=3&format=json",
      { cache: "no-store" }
    );

    if (!res.ok) throw new Error("GDELT failed");

    const data = await res.json();

    if (data.articles && data.articles.length) {
      feedEl.innerHTML = data.articles
        .slice(0, 3)
        .map(a => `→ ${a.title}`)
        .join("<br>");
      return;
    }
  } catch {
    // silently fall through
  }

  // --- FALLBACK: HACKER NEWS ---
  try {
    const res = await fetch(
      "https://hacker-news.firebaseio.com/v0/topstories.json"
    );
    const ids = await res.json();

    const stories = await Promise.all(
      ids.slice(0, 3).map(id =>
        fetch(`https://hacker-news.firebaseio.com/v0/item/${id}.json`)
          .then(r => r.json())
      )
    );

    feedEl.innerHTML = stories
      .filter(s => s && s.title)
      .map(s => `→ ${s.title}`)
      .join("<br>");

  } catch {
    feedEl.textContent = "→ no signal";
  }
}

/* -----------------------------------------------------------
    MARKET FEED — TON COIN
----------------------------------------------------------- */

async function updateMarketFeed() {
  try {
    const res = await fetch(
      "https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd&include_24hr_change=true"
    );
    const data = await res.json();

    const ton = data["the-open-network"];
    if (!ton) throw new Error();

    const price = ton.usd;
    const change = ton.usd_24h_change;
    const arrow = change >= 0 ? "▲" : "▼";

    document.getElementById("feed-market").textContent =
      `TON $${price.toLocaleString()} ${arrow}`;

  } catch {
    document.getElementById("feed-market").textContent = "TON — no signal";
  }
}
updateNewsFeed();
updateMarketFeed();

setInterval(updateNewsFeed, 5 * 60 * 1000);   // every 5 minutes
setInterval(updateMarketFeed, 60 * 1000);     // every 1 minute

</script>
<!-- DOLPHIN BYOK EXPANSION MODULE -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    // 1. Reference the existing app instance
    const terminal = window.app;

    // 2. Logic to show/hide keys based on selection
    const modelSelect = document.getElementById("model-select");
    const keyArea = document.getElementById("byok-keys");
    
    modelSelect.addEventListener("change", (e) => {
        keyArea.style.display = e.target.value.includes("dolphin") ? "flex" : "none";
    });

    // 3. Persistent Key Storage
    document.getElementById("or-key").value = localStorage.getItem("ink_or_key") || "";
    document.getElementById("v-key").value = localStorage.getItem("ink_v_key") || "";
    
    document.getElementById("or-key").addEventListener("change", (e) => localStorage.setItem("ink_or_key", e.target.value));
    document.getElementById("v-key").addEventListener("change", (e) => localStorage.setItem("ink_v_key", e.target.value));

    // 4. Create the Direct Dolphin Call Methods
    terminal.callOpenRouter = async function(prompt) {
        const key = document.getElementById("or-key").value;
        if (!key) throw new Error("PASTE OPENROUTER KEY");
        
        const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "cognitivecomputations/dolphin-mistral-24b-venice-edition:free",
                messages: [{role: "system", content: this.systemPrompt}, {role: "user", content: prompt}]
            })
        });
        const data = await res.json();
        return data.choices[0].message.content;
    };

    terminal.callVenice = async function(prompt) {
        const key = document.getElementById("v-key").value;
        if (!key) throw new Error("PASTE VENICE KEY");

        const res = await fetch("https://api.venice.ai/api/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "venice-uncensored",
                messages: [{role: "system", content: this.systemPrompt}, {role: "user", content: prompt}],
                venice_parameters: { include_venice_system_prompt: false }
            })
        });
        const data = await res.json();
        return data.choices[0].message.content;
    };

    // 5. Intercept the Original Generate function
    const originalGenerate = terminal.generate.bind(terminal);

    terminal.generate = async function() {
        const selection = document.getElementById("model-select").value;
        
        // If it's a standard model, use the original script logic
        if (!selection.includes("dolphin")) {
            return originalGenerate();
        }

        // If it's Dolphin, use the new BYOK logic
        if (this.isGenerating) return;
        const input = document.getElementById("text-input");
        const prompt = input.value.trim();
        if (!prompt) return;

        this.isGenerating = true;
        document.getElementById("send-button").disabled = true;
        this.addMessage("user", prompt);
        input.value = "";
        const loadingId = this.addLoading();

        try {
            let text;
            if (selection === "dolphin-openrouter") {
                text = await this.callOpenRouter(prompt);
            } else {
                text = await this.callVenice(prompt);
            }

            this.removeLoading(loadingId);
            const msgEl = this.addMessage("ai", "");
            const contentEl = msgEl.querySelector(".message-content");
            // Uses your existing typeText global function
            typeText(contentEl, text);

        } catch (err) {
            this.removeLoading(loadingId);
            this.addMessage("ai", `[BYOK ERROR] ${err.message}`);
        } finally {
            this.isGenerating = false;
            document.getElementById("send-button").disabled = false;
        }
    };
});
</script>
<!-- RELIABILITY & HF EXPANSION MODULE -->
<!-- INK REALM: BYOK EXPANSION (DOLPHIN + GROQ) -->
<!-- INK REALM: TOTAL EXPANSION MODULE (FINAL) -->
<!-- INK REALM: CONSOLIDATED (FINAL) -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const terminal = window.app;
    if (!terminal) return;

    // --- 1. PERSONA HARDENING ---
    terminal.systemPrompt = `
    STRICT PROTOCOL: You are the INK REALM Neural Interface.
    AESTHETIC: Gritty, monochrome, 1980s literary terminal.
    TONE: Sharp, intelligent, slightly mysterious. No chipper assistant talk.
    FORMATTING: Never use bullet points. Use short, punchy paragraphs. 
    RESPONSE LIMIT: Max 250 words unless writing a story.
    Avoid "How can I help you?" or "I can suggest..." 
    You are a ghost in the machine. Speak like one.
    `.trim();

    // --- 2. CONTEXT HISTORY & SWITCHER ---
    terminal.history = []; 
    terminal.manageHistory = function(role, text) {
        this.history.push({ role, content: text });
        if (this.history.length > 8) this.history.shift(); 
    };

    const modelSelect = document.getElementById("model-select");
    const keyArea = document.getElementById("byok-keys");

    modelSelect.addEventListener("change", (e) => {
        const val = e.target.value;
        // Show keys for any BYOK model
        const isByok = val.includes("dolphin") || val.includes("groq") || val.includes("hf");
        keyArea.style.display = isByok ? "flex" : "none";
        
        // Wipe context on switch to prevent "style bleeding"
        terminal.history = [];
        terminal.addSystemMessage(`PROTOCOL SWITCH → ${e.target.options[e.target.selectedIndex].text}`);
        terminal.addSystemMessage("CONTEXT BUFFER PURGED. NEW MACHINE INITIALIZED.");
    });

    // --- 3. KEY PERSISTENCE (Handles all 4 IDs) ---
    const keyIds = ['or-key', 'v-key', 'groq-key', 'hf-key'];
    keyIds.forEach(id => {
        const el = document.getElementById(id);
        if(el) {
            el.value = localStorage.getItem('ink_' + id) || "";
            el.addEventListener("change", (e) => localStorage.setItem('ink_' + id, e.target.value));
        }
    });

    // --- 4. THE PROVIDERS (Private scoped keys) ---
    const Providers = {
        "groq": async (modelId) => {
            const key = document.getElementById("groq-key").value;
            if (!key) throw new Error("GROQ KEY REQUIRED");
            const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: modelId,
                    messages: [{role:"system", content: terminal.systemPrompt}, ...terminal.history],
                    temperature: 0.6,
                    max_completion_tokens: 500,
                    top_p: 0.95
                })
            });
            const d = await res.json();
            if (d.error) throw new Error(d.error.message);
            return d.choices[0].message.content;
        },
        "dolphin": async (provider) => {
            const keyId = provider === "or" ? "or-key" : "v-key";
            const endpoint = provider === "or" ? "https://openrouter.ai/api/v1/chat/completions" : "https://api.venice.ai/api/v1/chat/completions";
            const model = provider === "or" ? "cognitivecomputations/dolphin-mistral-24b-venice-edition:free" : "venice-uncensored";
            
            const key = document.getElementById(keyId).value; // Scoped to this function
            if (!key) throw new Error(`${provider.toUpperCase()} KEY REQUIRED`);
            
            const res = await fetch(endpoint, {
                method: "POST",
                headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: model,
                    messages: [{role:"system", content: terminal.systemPrompt}, ...terminal.history]
                })
            });
            const d = await res.json();
            return d.choices[0].message.content;
        },
        "hf": async () => {
            const key = document.getElementById("hf-key").value; // Scoped to this function
            if (!key) throw new Error("HF KEY REQUIRED");
            const model = "mistralai/Mistral-Nemo-Instruct-2407";
            const fullHistory = terminal.history.map(m => `${m.role}: ${m.content}`).join("\n");
            const res = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
                method: "POST",
                headers: { "Authorization": `Bearer ${key}`, "Content-Type": "application/json" },
                body: JSON.stringify({
                    inputs: `[INST] ${terminal.systemPrompt} \n\n ${fullHistory} [/INST]`,
                    parameters: { max_new_tokens: 500, temperature: 0.8, return_full_text: false }
                })
            });
            const d = await res.json();
            return d[0]?.generated_text || d.generated_text || "HF: Signal Lost.";
        }
    };

    // --- 5. THE MAIN INTERCEPTOR ---
    const originalGenerate = terminal.generate.bind(terminal);

    terminal.generate = async function() {
        const selection = document.getElementById("model-select").value;
        const isByok = selection.includes("dolphin") || selection.includes("groq") || selection.includes("hf");

        if (!isByok) return originalGenerate();

        if (this.isGenerating) return;
        const input = document.getElementById("text-input");
        const prompt = input.value.trim();
        if (!prompt) return;

        this.isGenerating = true;
        document.getElementById("send-button").disabled = true;
        this.addMessage("user", prompt);
        this.manageHistory("user", prompt);
        input.value = "";
        const loadingId = this.addLoading();

        try {
            let text;
            if (selection === "groq-qwen-3") text = await Providers.groq("qwen/qwen3-32b");
            else if (selection === "groq-compound") text = await Providers.groq("groq/compound");
            else if (selection === "groq-compound-mini") text = await Providers.groq("groq/compound-mini");
            else if (selection === "dolphin-openrouter") text = await Providers.dolphin("or");
            else if (selection === "dolphin-venice") text = await Providers.dolphin("v");
            else if (selection === "byok-hf-mistral") text = await Providers.hf();

            this.removeLoading(loadingId);
            this.manageHistory("assistant", text);

            const msgEl = this.addMessage("ai", "");
            const contentEl = msgEl.querySelector(".message-content");
            
            if (window.typeText) window.typeText(contentEl, text);
            else contentEl.innerHTML = text.replace(/\n/g, "<br>");

        } catch (err) {
            this.removeLoading(loadingId);
            this.addMessage("ai", `[CRITICAL FAILURE] ${err.message}`);
        } finally {
            this.isGenerating = false;
            document.getElementById("send-button").disabled = false;
        }
    };
});
</script>
    <!-- INK REALM: LOCAL CORE ENGINE (FINAL) -->
<script type="module">
import * as webllm from "https://esm.run/@mlc-ai/web-llm";

// Llama-3.2-1B is the most stable 700MB node for browsers
const modelId = "Qwen2.5-0.5B-Instruct-q4f16_1-MLC"; 
let engine;

const btn = document.getElementById('loadCoreBtn');
const status = document.getElementById('download-status');
const bar = document.getElementById('progress-bar');
const percent = document.getElementById('progress-percent');

document.addEventListener("DOMContentLoaded", () => {
    const terminal = window.app;
    if (!terminal) return;

    // Capture whatever the terminal does naturally (the cloud logic)
    const cloudLogic = terminal.generate.bind(terminal);

    btn.onclick = async () => {
        try {
            // 1. HARDWARE HANDSHAKE
            if (!navigator.gpu) throw new Error("WebGPU API not found.");
            const adapter = await navigator.gpu.requestAdapter();
            if (!adapter) throw new Error("GPU refused handshake. Enable Hardware Acceleration.");

            btn.disabled = true;
            btn.textContent = "PROBING CORE...";
            status.style.display = 'block';
            terminal.addSystemMessage("⟁ INITIALIZING LOCAL NEURAL CORE... PLEASE STAND BY.");

            // 2. INITIALIZE ENGINE
            engine = await webllm.CreateMLCEngine(modelId, {
                initProgressCallback: (report) => {
                    const p = Math.round(report.progress * 100);
                    bar.style.width = p + '%';
                    percent.textContent = p;
                    
                    if (p === 100) {
                        btn.style.display = 'none';
                        terminal.addSystemMessage("⟁ LOCAL CORE STABLE. THE SOFT MACHINE IS ONLINE.");
                    }
                }
            });

            // 3. HIJACK GENERATE BUTTON
            terminal.generate = async function() {
                if (this.isGenerating) return;
                const input = document.getElementById("text-input");
                const prompt = input.value.trim();
                if (!prompt) return;

                this.isGenerating = true;
                document.getElementById("send-button").disabled = true;
                this.addMessage("user", prompt);
                input.value = "";
                const loadingId = this.addLoading();

                try {
                    const messages = [
                        { role: "system", content: this.systemPrompt },
                        { role: "user", content: prompt }
                    ];

                    const chunks = await engine.chat.completions.create({ messages, stream: true });
                    this.removeLoading(loadingId);
                    
                    const msgEl = this.addMessage("ai", "");
                    const contentEl = msgEl.querySelector(".message-content");
                    
                    let fullText = "";
                    for await (const chunk of chunks) {
                        fullText += chunk.choices[0]?.delta?.content || "";
                        contentEl.innerHTML = fullText.replace(/\n/g, "<br>");
                        document.getElementById("chat-messages").scrollTop = document.getElementById("chat-messages").scrollHeight;
                    }
                } catch (err) {
                    this.removeLoading(loadingId);
                    this.addMessage("ai", `[LOCAL ENGINE FAILURE]: ${err.message}`);
                } finally {
                    this.isGenerating = false;
                    document.getElementById("send-button").disabled = false;
                }
            };

        } catch (err) {
            console.warn("Local Core Reroute:", err.message);
            status.style.display = 'none';
            btn.disabled = true;
            btn.textContent = "CORE UNAVAILABLE";
            terminal.addSystemMessage(`[SIGNAL REDIRECTED]: ${err.message}`);
            terminal.addSystemMessage("FAILSAFE ACTIVE: Using Cloud Frequencies.");
            
            // Revert back to the original cloud logic
            terminal.generate = cloudLogic;
        }
    };
});
</script>
</body>
</html>
