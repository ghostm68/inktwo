<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INK REALM | AI Writing Terminal</title>
    
    <!-- Meta Data -->
    <meta name="description" content="INK REALM | AI Writing Terminal. A monochrome neural interface for creative writing and text generation powered by Google's Gemini & Gemma models via Puter.js. Cyberpunk writing environment with minimalist aesthetics.">
    <meta name="keywords" content="AI writing, creative writing, Google Gemini, Gemma models, Puter.js, cyberpunk writing, text generation, neural interface, black and white aesthetic, writing assistant, AI author, creative writing app">
    <meta name="author" content="INKREALM-NEXUS">
    <meta name="copyright" content="Copyright 2026 INKREALM-NEXUS. All rights reserved.">
    <meta name="robots" content="index, follow">

    <!-- OPEN GRAPH -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://inkrealm.info/app">
    <meta property="og:title" content="INK REALM | AI Writing Terminal">
    <meta property="og:description" content="A monochrome neural writing interface powered by Google Gemini & Gemma models. Creative writing, text generation, and literary exploration in a cyberpunk aesthetic.">
    <meta property="og:image" content="https://github.com/ghostm68/pantheon/raw/main/mw.inkrealm.info.webp">
    <meta property="og:image:alt" content="INK REALM AI Writing Terminal Interface">
    <meta property="og:site_name" content="INK REALM AI Writing Terminal">
    <meta property="og:locale" content="en_US">

    <!-- TWITTER / X -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@inkrealm">
    <meta name="twitter:creator" content="@inkrealm">
    <meta name="twitter:title" content="INK REALM AI Writing Terminal">
    <meta name="twitter:description" content="Monochrome AI writing interface using Google Gemini 2.5 & Gemma models. Creative writing, prose generation, and literary AI. Powered by Puter.js">
    <meta name="twitter:image" content="https://github.com/ghostm68/pantheon/raw/main/mw.inkrealm.info.webp">

    <!-- MOBILE APP STYLING -->
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-navbutton-color" content="#000000">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    
    <!-- PuterJS SDK -->
    <script src="https://js.puter.com/v2/"></script>
    
    <style>
        /* Reset & Base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'IBM Plex Mono', 'Courier New', monospace;
            background: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }
        
        /* Monochrome palette */
        :root {
            --black: #000000;
            --white: #ffffff;
            --gray-1: #111111;
            --gray-2: #222222;
            --gray-3: #333333;
            --gray-6: #666666;
            --gray-9: #999999;
            --gray-c: #cccccc;
        }
        
        /* Typewriter Effect */
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .cursor {
            display: inline-block;
            width: 3px;
            height: 1.2em;
            background: var(--white);
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }
        
        /* Header */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: var(--black);
            border-bottom: 1px solid var(--gray-3);
            padding: 1rem 2rem;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.2rem;
            font-weight: 400;
            letter-spacing: 3px;
            text-transform: uppercase;
        }
        
        .logo-sub {
            color: var(--gray-9);
            font-size: 0.8rem;
            margin-top: 2px;
            letter-spacing: 1px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.3; }
            50% { opacity: 1; }
            100% { opacity: 0.3; }
        }
        
        /* Main Layout */
        .container {
            display: flex;
            height: 100vh;
            padding-top: 70px;
        }
        
        /* Model Panel */
        .model-panel {
            width: 300px;
            background: var(--gray-1);
            border-right: 1px solid var(--gray-3);
            padding: 2rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .model-group {
            border: 1px solid var(--gray-3);
            padding: 1rem;
        }
        
        .model-group-title {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
            color: var(--gray-c);
            border-bottom: 1px solid var(--gray-3);
            padding-bottom: 0.5rem;
        }
        
        .model-option {
            padding: 0.8rem;
            margin: 0.3rem 0;
            border: 1px solid transparent;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            background: var(--gray-2);
            font-family: 'Courier New', monospace;
        }
        
        .model-option:hover {
            border-color: var(--gray-6);
            background: var(--gray-3);
        }
        
        .model-option.active {
            border-color: var(--white);
            background: var(--gray-3);
            font-weight: bold;
        }
        
        .model-badge {
            display: inline-block;
            font-size: 0.7rem;
            padding: 1px 4px;
            margin-left: 5px;
            border-radius: 2px;
            font-family: 'Courier New', monospace;
        }
        
        .model-badge.free {
            background: #00aa00;
            color: white;
        }
        
        .model-badge.image {
            background: #aa00aa;
            color: white;
        }
        
        .model-badge.writing {
            background: #0066aa;
            color: white;
        }
        
        /* Writing Interface */
        .writing-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--black);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .message {
            max-width: 80%;
            padding: 1.2rem;
            line-height: 1.6;
            border: 1px solid var(--gray-3);
            font-family: 'Courier New', monospace;
        }
        
        .message.user {
            align-self: flex-end;
            background: var(--gray-2);
            border-color: var(--gray-6);
            font-style: italic;
        }
        
        .message.ai {
            align-self: flex-start;
            background: var(--gray-1);
            border-color: var(--gray-3);
        }
        
        .message.system {
            align-self: center;
            background: var(--gray-1);
            border-color: var(--gray-6);
            font-size: 0.9rem;
            text-align: center;
            max-width: 90%;
        }
        
        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: var(--gray-9);
            border-bottom: 1px solid var(--gray-3);
            padding-bottom: 0.3rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .message-content {
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .message-content pre {
            background: var(--gray-2);
            padding: 1rem;
            overflow-x: auto;
            margin: 0.5rem 0;
            border: 1px solid var(--gray-3);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.85rem;
        }
        
        .message-content code {
            background: var(--gray-2);
            padding: 2px 4px;
            font-family: 'IBM Plex Mono', monospace;
        }
        
        /* Input Area */
        .input-container {
            border-top: 1px solid var(--gray-3);
            padding: 1.5rem 2rem;
            background: var(--gray-1);
        }
        
        .writing-tools {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .writing-tool {
            padding: 0.5rem 1rem;
            background: var(--black);
            border: 1px solid var(--gray-6);
            color: var(--white);
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .writing-tool:hover {
            background: var(--gray-3);
            border-color: var(--white);
        }
        
        .input-row {
            display: flex;
            gap: 1rem;
            align-items: flex-start;
        }
        
        .text-input {
            flex: 1;
            padding: 1rem;
            background: var(--black);
            border: 1px solid var(--gray-3);
            color: var(--white);
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.95rem;
            resize: none;
            min-height: 100px;
            line-height: 1.6;
        }
        
        .text-input:focus {
            outline: none;
            border-color: var(--white);
        }
        
        .send-button {
            padding: 1rem 2rem;
            background: var(--black);
            border: 1px solid var(--white);
            color: var(--white);
            font-family: 'IBM Plex Mono', monospace;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.2s;
            height: 100px;
        }
        
        .send-button:hover {
            background: var(--white);
            color: var(--black);
        }
        
        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Writing Stats */
        .writing-stats {
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: var(--gray-9);
        }
        
        /* Model Info Panel */
        .model-info {
            position: fixed;
            top: 70px;
            right: 0;
            width: 300px;
            height: calc(100vh - 70px);
            background: var(--gray-1);
            border-left: 1px solid var(--gray-3);
            padding: 2rem;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.3s;
        }
        
        .model-info.active {
            transform: translateX(0);
        }
        
        .info-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: 1px solid var(--gray-6);
            color: var(--white);
            width: 30px;
            height: 30px;
            cursor: pointer;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-1);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-3);
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-6);
        }
        
        /* Loading Animation */
        .typing-indicator {
            display: inline-flex;
            gap: 3px;
            align-items: center;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            background: var(--gray-9);
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                background: var(--gray-9);
            }
            30% {
                transform: translateY(-5px);
                background: var(--white);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            INK REALM<div class="logo-sub">AI WRITING TERMINAL</div>
        </div>
        <div class="status-indicator">
            <div class="status-dot"></div>
            <span id="status-text">Initializing PuterJS...</span>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Model Selection Panel -->
        <div class="model-panel">
            <!-- Gemini 2.5 Series -->
            <div class="model-group">
                <div class="model-group-title">Gemini 2.5 Series</div>
                <div class="model-option active" data-model="google/gemini-2.5-pro">
                    gemini-2.5-pro
                    <span class="model-badge writing">Creative</span>
                </div>
                <div class="model-option" data-model="google/gemini-2.5-flash">
                    gemini-2.5-flash
                    <span class="model-badge writing">Fast</span>
                </div>
                <div class="model-option" data-model="google/gemini-2.5-flash-lite">
                    gemini-2.5-flash-lite
                </div>
                <div class="model-option" data-model="google/gemini-2.5-pro-preview">
                    gemini-2.5-pro-preview
                </div>
            </div>

            <!-- Gemini 2.0 Series -->
            <div class="model-group">
                <div class="model-group-title">Gemini 2.0 Series</div>
                <div class="model-option" data-model="google/gemini-2.0-flash-001">
                    gemini-2.0-flash-001
                </div>
                <div class="model-option" data-model="google/gemini-2.0-flash-exp:free">
                    gemini-2.0-flash-exp:free
                    <span class="model-badge free">Free</span>
                </div>
            </div>

            <!-- Gemini 1.5 Series -->
            <div class="model-group">
                <div class="model-group-title">Gemini 1.5 Series</div>
                <div class="model-option" data-model="google/gemini-pro-1.5">
                    gemini-pro-1.5
                    <span class="model-badge writing">Prose</span>
                </div>
                <div class="model-option" data-model="google/gemini-flash-1.5">
                    gemini-flash-1.5
                </div>
            </div>

            <!-- Gemma 3 Series -->
            <div class="model-group">
                <div class="model-group-title">Gemma 3 Series</div>
                <div class="model-option" data-model="google/gemma-3-27b-it">
                    gemma-3-27b-it
                    <span class="model-badge writing">Detailed</span>
                </div>
                <div class="model-option" data-model="google/gemma-3-27b-it:free">
                    gemma-3-27b-it:free
                    <span class="model-badge free">Free</span>
                </div>
                <div class="model-option" data-model="google/gemma-3-12b-it">
                    gemma-3-12b-it
                </div>
                <div class="model-option" data-model="google/gemma-3-12b-it:free">
                    gemma-3-12b-it:free
                    <span class="model-badge free">Free</span>
                </div>
                <div class="model-option" data-model="google/gemma-3-4b-it">
                    gemma-3-4b-it
                </div>
            </div>

            <!-- Image Models -->
            <div class="model-group">
                <div class="model-group-title">Image & Vision</div>
                <div class="model-option" data-model="google/gemini-2.5-flash-image-preview">
                    gemini-2.5-flash-image-preview
                    <span class="model-badge image">Vision</span>
                </div>
                <div class="model-option" data-model="gemini-3-pro-image-preview">
                    gemini-3-pro-image-preview
                    <span class="model-badge image">Generate</span>
                </div>
            </div>

            <button id="model-info-btn" class="send-button" style="margin-top: 1rem; font-size: 0.9rem; height: auto; padding: 0.8rem;">
                Model Details
            </button>
        </div>

        <!-- Writing Interface -->
        <div class="writing-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message system">
                    <div class="message-header">
                        <span>INK REALM WRITING TERMINAL</span>
                        <span>v2.5</span>
                    </div>
                    <div class="message-content">
                        <p>Neural writing interface initialized...</p>
                        <p>Accessing Google AI models via PuterJS</p>
                        <p>Select a model and begin your writing session</p>
                    </div>
                </div>
            </div>

            <div class="input-container">
                <!-- Writing Tools -->
                <div class="writing-tools">
                    <button class="writing-tool" data-prompt="Continue the story:">Continue Story</button>
                    <button class="writing-tool" data-prompt="Write a poem about:">Write Poem</button>
                    <button class="writing-tool" data-prompt="Describe a character:">Character Sketch</button>
                    <button class="writing-tool" data-prompt="Create dialogue between:">Dialogue</button>
                    <button class="writing-tool" data-prompt="Write a scene set in:">Scene Setting</button>
                    <button class="writing-tool" data-prompt="Revise this text for:">Revise</button>
                    <button class="writing-tool" data-prompt="Brainstorm ideas for:">Brainstorm</button>
                </div>
                
                <!-- Main Input -->
                <div class="input-row">
                    <textarea 
                        id="user-input" 
                        class="text-input" 
                        placeholder="Begin your writing... Describe your scene, continue your story, or ask for creative assistance..."
                        rows="6"
                    ></textarea>
                    <button id="send-button" class="send-button">WRITE</button>
                </div>
                
                <!-- Writing Stats -->
                <div class="writing-stats">
                    <span id="word-count">Words: 0</span>
                    <span id="char-count">Characters: 0</span>
                    <span id="model-indicator">Model: Gemini 2.5 Pro</span>
                </div>
                
                <!-- Controls -->
                <div style="margin-top: 1rem; display: flex; gap: 0.5rem; justify-content: center;">
                    <button id="clear-chat" class="send-button" style="padding: 0.5rem 1rem; font-size: 0.8rem; height: auto;">
                        New Session
                    </button>
                    <button id="export-text" class="send-button" style="padding: 0.5rem 1rem; font-size: 0.8rem; height: auto;">
                        Export Text
                    </button>
                    <button id="example-query" class="send-button" style="padding: 0.5rem 1rem; font-size: 0.8rem; height: auto;">
                        Examples
                    </button>
                </div>
            </div>
        </div>

        <!-- Model Info Panel -->
        <div class="model-info" id="model-info">
            <button class="info-close" id="info-close">Ã—</button>
            <h3 id="model-info-title">Model Information</h3>
            <div id="model-info-content">
                <p>Select a model to view details...</p>
            </div>
        </div>
    </div>

    <script>
        class WritingAITerminal {
            constructor() {
                this.currentModel = 'google/gemini-2.5-pro';
                this.chatHistory = [];
                this.isInitialized = false;
                this.isImageModel = false;
                this.wordCount = 0;
                
                // Model information database
                this.modelInfo = {
                    'google/gemini-2.5-pro': {
                        name: 'Gemini 2.5 Pro',
                        description: 'Most capable model for creative writing, complex narratives, and detailed prose',
                        capabilities: ['Creative writing', 'Character development', 'Plot structuring', 'Literary analysis'],
                        maxTokens: 8192,
                        context: '2M tokens',
                        bestFor: 'Novels, short stories, detailed descriptions'
                    },
                    'google/gemini-2.5-flash': {
                        name: 'Gemini 2.5 Flash',
                        description: 'Fast model for quick writing assistance and brainstorming',
                        capabilities: ['Quick responses', 'Brainstorming', 'First drafts', 'Ideation'],
                        maxTokens: 8192,
                        context: '2M tokens',
                        bestFor: 'Brainstorming, quick drafts, poetry'
                    },
                    'google/gemini-pro-1.5': {
                        name: 'Gemini Pro 1.5',
                        description: 'Reliable model for general writing and prose generation',
                        capabilities: ['General writing', 'Prose generation', 'Editing assistance', 'Style adaptation'],
                        maxTokens: 8192,
                        context: '1M tokens',
                        bestFor: 'General writing, articles, blog posts'
                    },
                    'google/gemma-3-27b-it': {
                        name: 'Gemma 3 27B IT',
                        description: '27B parameter model excellent for detailed, nuanced writing',
                        capabilities: ['Detailed descriptions', 'Character depth', 'World building', 'Literary devices'],
                        maxTokens: 8192,
                        context: '8K tokens',
                        bestFor: 'Fantasy, sci-fi, detailed world building'
                    },
                    'google/gemma-3-27b-it:free': {
                        name: 'Gemma 3 27B IT (Free)',
                        description: 'Free tier of detailed writing model',
                        capabilities: ['Detailed writing', 'Character development', 'Free tier access'],
                        maxTokens: 4096,
                        context: '4K tokens',
                        bestFor: 'Experimentation, learning, casual writing'
                    },
                    'google/gemini-2.5-flash-image-preview': {
                        name: 'Gemini 2.5 Flash Image Preview',
                        description: 'Multimodal model for image-inspired writing',
                        capabilities: ['Image analysis', 'Descriptive writing', 'Visual storytelling', 'Setting descriptions'],
                        maxTokens: 8192,
                        context: '2M tokens',
                        bestFor: 'Writing from images, descriptive passages'
                    },
                    'gemini-3-pro-image-preview': {
                        name: 'Gemini 3 Pro Image Preview',
                        description: 'Latest multimodal model for creative image generation and analysis',
                        capabilities: ['Image generation', 'Visual writing prompts', 'Creative inspiration'],
                        maxTokens: 4096,
                        context: '128K tokens',
                        bestFor: 'Visual writing prompts, cover art ideas'
                    }
                };
                
                this.writingContext = `You are WRITING_AI, an expert creative writing assistant with deep knowledge of:
                
LITERARY ELEMENTS:
- Character development and psychology
- Plot structure and narrative arc
- Setting and world-building
- Dialogue and voice
- Theme and symbolism
- Point of view and tense

WRITING STYLES:
- Literary fiction and modernism
- Science fiction and fantasy
- Mystery and thriller
- Romance and drama
- Poetry and verse
- Creative non-fiction

WRITING TECHNIQUES:
- Show don't tell
- Foreshadowing and Chekhov's gun
- Stream of consciousness
- Minimalism vs maximalism
- Experimental forms
- Genre conventions

Your responses should:
1. Maintain the user's writing style and voice
2. Suggest improvements without being prescriptive
3. Provide creative options, not just one solution
4. Consider pacing, tension, and reader engagement
5. Balance literary quality with readability

Current model: ${this.currentModel}
Focus on creative exploration and writing excellence.`;

                this.init();
            }
            
            async init() {
                this.setupEventListeners();
                await this.initializePuter();
                this.setupModelSelection();
                this.setupWritingTools();
                this.addWelcomeMessage();
                this.setupWordCount();
            }
            
            async initializePuter() {
                try {
                    document.getElementById('status-text').textContent = 'Connecting to PuterJS...';
                    
                    await puter.init();
                    
                    const test = await puter.ai.test();
                    
                    if (test.success) {
                        this.isInitialized = true;
                        const modelName = this.getModelDisplayName(this.currentModel);
                        document.getElementById('status-text').textContent = `Connected | ${modelName}`;
                        document.getElementById('model-indicator').textContent = `Model: ${modelName}`;
                        console.log('âœ… PuterJS initialized successfully');
                        
                        this.updateModelInfo(this.currentModel);
                        
                        return true;
                    } else {
                        throw new Error('Puter test failed');
                    }
                } catch (error) {
                    console.error('âŒ PuterJS initialization failed:', error);
                    document.getElementById('status-text').textContent = 'Connection Failed - Using Local Mode';
                    this.addMessage('system', 'PuterJS connection failed. Using local writing simulation.');
                    return false;
                }
            }
            
            setupEventListeners() {
                // Send button
                document.getElementById('send-button').addEventListener('click', () => this.processWriting());
                
                // Enter key in textarea (with Shift+Enter for new line)
                const textInput = document.getElementById('user-input');
                textInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.processWriting();
                    }
                });
                
                // Clear chat button
                document.getElementById('clear-chat').addEventListener('click', () => this.clearSession());
                
                // Export button
                document.getElementById('export-text').addEventListener('click', () => this.exportSession());
                
                // Example query button
                document.getElementById('example-query').addEventListener('click', () => this.showWritingExamples());
                
                // Model info button
                document.getElementById('model-info-btn').addEventListener('click', () => {
                    document.getElementById('model-info').classList.add('active');
                });
                
                // Close info panel
                document.getElementById('info-close').addEventListener('click', () => {
                    document.getElementById('model-info').classList.remove('active');
                });
            }
            
            setupWritingTools() {
                const tools = document.querySelectorAll('.writing-tool');
                tools.forEach(tool => {
                    tool.addEventListener('click', () => {
                        const prompt = tool.getAttribute('data-prompt');
                        const input = document.getElementById('user-input');
                        input.value = prompt + ' ';
                        input.focus();
                    });
                });
            }
            
            setupWordCount() {
                const textInput = document.getElementById('user-input');
                textInput.addEventListener('input', () => {
                    const text = textInput.value;
                    const words = text.trim() ? text.trim().split(/\s+/).length : 0;
                    const chars = text.length;
                    
                    this.wordCount = words;
                    document.getElementById('word-count').textContent = `Words: ${words}`;
                    document.getElementById('char-count').textContent = `Characters: ${chars}`;
                });
            }
            
            setupModelSelection() {
                const modelOptions = document.querySelectorAll('.model-option');
                
                modelOptions.forEach(option => {
                    option.addEventListener('click', () => {
                        modelOptions.forEach(opt => opt.classList.remove('active'));
                        option.classList.add('active');
                        
                        const modelId = option.getAttribute('data-model');
                        this.currentModel = modelId;
                        
                        this.isImageModel = modelId.includes('image') || 
                                          modelId === 'gemini-3-pro-image-preview';
                        
                        if (this.isInitialized) {
                            const modelName = this.getModelDisplayName(modelId);
                            document.getElementById('status-text').textContent = `Connected | ${modelName}`;
                            document.getElementById('model-indicator').textContent = `Model: ${modelName}`;
                        }
                        
                        this.updateModelInfo(modelId);
                        
                        this.addMessage('system', 
                            `Switched to writing model: ${this.getModelDisplayName(modelId)}\n` +
                            (this.isImageModel ? 'ðŸ“¸ Image mode enabled for visual writing prompts' : '')
                        );
                    });
                });
            }
            
            getModelDisplayName(modelId) {
                const parts = modelId.split('/');
                return parts[parts.length - 1]
                    .replace(/google\//, '')
                    .replace(/:free$/, '')
                    .replace(/-/g, ' ')
                    .toUpperCase();
            }
            
            updateModelInfo(modelId) {
                const info = this.modelInfo[modelId] || {
                    name: this.getModelDisplayName(modelId),
                    description: 'Google AI model for creative writing via PuterJS',
                    capabilities: ['Creative writing', 'Text generation'],
                    maxTokens: 4096,
                    context: 'Unknown',
                    bestFor: 'General writing tasks'
                };
                
                document.getElementById('model-info-title').textContent = info.name;
                
                const content = `
                    <p><strong>Description:</strong> ${info.description}</p>
                    <p><strong>Best For:</strong> ${info.bestFor}</p>
                    <p><strong>Capabilities:</strong> ${info.capabilities.join(', ')}</p>
                    <p><strong>Max Response:</strong> ${info.maxTokens.toLocaleString()} tokens</p>
                    <p><strong>Context Window:</strong> ${info.context}</p>
                    <p><strong>Provider:</strong> Google AI via PuterJS</p>
                    ${modelId.includes(':free') ? '<p><strong>Note:</strong> Free tier model may have rate limits</p>' : ''}
                `;
                
                document.getElementById('model-info-content').innerHTML = content;
            }
            
            async processWriting() {
                const inputElement = document.getElementById('user-input');
                const message = inputElement.value.trim();
                
                if (!message) return;
                
                this.addMessage('user', message);
                inputElement.value = '';
                
                const typingId = this.showTypingIndicator();
                
                try {
                    let response;
                    
                    if (this.isInitialized) {
                        response = await this.queryWritingAI(message);
                    } else {
                        response = this.getSimulatedWritingResponse(message);
                    }
                    
                    this.removeTypingIndicator(typingId);
                    this.addMessage('ai', response, this.currentModel);
                    
                } catch (error) {
                    console.error('Error getting response:', error);
                    this.removeTypingIndicator(typingId);
                    
                    this.addMessage('system', 
                        `Error: ${error.message}\nUsing fallback writing response...`
                    );
                    
                    this.addMessage('ai', this.getSimulatedWritingResponse(message));
                }
            }
            
            async queryWritingAI(prompt) {
                const startTime = Date.now();
                
                try {
                    const messages = [
                        {
                            role: 'system',
                            content: this.writingContext
                        },
                        ...this.chatHistory.slice(-10).map(msg => ({
                            role: msg.type === 'user' ? 'user' : 'assistant',
                            content: msg.content
                        })),
                        { role: 'user', content: prompt }
                    ];
                    
                    const requestData = {
                        model: this.currentModel,
                        messages: messages,
                        temperature: 0.8,
                        max_tokens: 2000
                    };
                    
                    const completion = await puter.ai.chat.completions.create(requestData);
                    
                    const response = completion.choices[0].message.content;
                    const latency = Date.now() - startTime;
                    
                    this.chatHistory.push(
                        { type: 'user', content: prompt },
                        { type: 'ai', content: response, model: this.currentModel }
                    );
                    
                    if (this.chatHistory.length > 20) {
                        this.chatHistory = this.chatHistory.slice(-20);
                    }
                    
                    console.log(`Writing response time: ${latency}ms`);
                    
                    return response;
                    
                } catch (error) {
                    console.error('Writing AI error:', error);
                    throw new Error(`Writing service error: ${error.message}`);
                }
            }
            
            getSimulatedWritingResponse(prompt) {
                const writingPrompts = [
                    `[WRITING ASSISTANT] Based on your prompt: "${prompt.substring(0, 50)}..."

Consider these writing approaches:

1. **Character Development**: Introduce internal conflict or backstory
2. **Setting Enhancement**: Use sensory details (sight, sound, smell)
3. **Dialogue Options**: Vary speech patterns to distinguish characters
4. **Pacing Control**: Adjust sentence length for tension or reflection
5. **Theme Integration**: Weave underlying messages through subtext

Example direction:
The rain fell like shattered glass on the city streets, each drop a memory trying to forget itself. She walked through puddles that reflected neon signs in distorted fragments, her footsteps echoing the rhythm of a heart learning to beat differently.

Try expanding with specific sensory details or character thoughts.`,

                    `[CREATIVE EXPLORATION] Your idea suggests: ${prompt}

Literary devices to consider:
- **Metaphor & Simile**: Compare the unfamiliar to the familiar
- **Foreshadowing**: Plant seeds for future development
- **Stream of Consciousness**: Internal monologue style
- **Minimalism**: Sparse, impactful language
- **Maximalism**: Rich, detailed descriptions

Writing Exercise:
Take one element (character, object, location) and describe it from three different perspectives:
1. As the character sees it
2. As an outsider sees it
3. As it exists in memory

This creates depth and complexity in your narrative.`,

                    `[PROSE GENERATION | Model: ${this.getModelDisplayName(this.currentModel)}]

The night was a canvas of unanswered questions. Streetlights painted amber pools on wet asphalt, each one a temporary island in the urban sea. A figure moved through shadows with purpose, their breath visible in the cold airâ€”tiny ghosts of intention.

**Writing Suggestions:**
- Add specific sounds: distant traffic, dripping water, muffled music
- Include tactile sensations: cold metal railing, damp fabric, rough brick
- Introduce conflict: internal doubt, external obstacle, moral dilemma
- Create mystery: unexplained detail, unanswered question, strange occurrence

Remember: Specificity creates reality in fiction.`
                ];
                
                return writingPrompts[Math.floor(Math.random() * writingPrompts.length)];
            }
            
            addMessage(type, content, model = null) {
                const messagesContainer = document.getElementById('chat-messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${type}`;
                
                const timestamp = new Date().toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                
                let headerText = type === 'user' ? 'WRITER' : 'WRITING AI';
                if (type === 'ai' && model) {
                    headerText += ` | ${this.getModelDisplayName(model)}`;
                }
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <span>${headerText}</span>
                        <span>${timestamp}</span>
                    </div>
                    <div class="message-content">${this.formatWritingContent(content)}</div>
                `;
                
                messagesContainer.appendChild(messageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }
            
            formatWritingContent(content) {
                let formatted = content
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                    .replace(/\*(.*?)\*/g, '<em>$1</em>')
                    .replace(/`(.*?)`/g, '<code>$1</code>')
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/\n/g, '<br>');
                
                formatted = formatted.replace(/```(\w+)?\n([\s\S]*?)```/g, 
                    '<pre><code>$2</code></pre>');
                
                return `<p>${formatted}</p>`;
            }
            
            showTypingIndicator() {
                const messagesContainer = document.getElementById('chat-messages');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message ai';
                typingDiv.id = 'typing-indicator';
                
                typingDiv.innerHTML = `
                    <div class="message-header">
                        <span>WRITING AI</span>
                        <span>${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                    </div>
                    <div class="message-content">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <span style="margin-left: 10px; color: #999;">Generating prose...</span>
                        </div>
                    </div>
                `;
                
                messagesContainer.appendChild(typingDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
                
                return 'typing-indicator';
            }
            
            removeTypingIndicator(id) {
                const element = document.getElementById(id);
                if (element) {
                    element.remove();
                }
            }
            
            clearSession() {
                const messagesContainer = document.getElementById('chat-messages');
                messagesContainer.innerHTML = '';
                
                this.chatHistory = [];
                this.wordCount = 0;
                document.getElementById('user-input').value = '';
                document.getElementById('word-count').textContent = 'Words: 0';
                document.getElementById('char-count').textContent = 'Characters: 0';
                
                this.addWelcomeMessage();
            }
            
            exportSession() {
                const messages = document.querySelectorAll('.message-content');
                let exportText = 'INK REALM WRITING SESSION EXPORT\n';
                exportText += '='.repeat(50) + '\n\n';
                
                messages.forEach((msg, index) => {
                    const header = msg.parentElement.querySelector('.message-header');
                    const type = header.textContent.includes('WRITER') ? 'WRITER' : 'AI';
                    const content = msg.textContent;
                    
                    exportText += `${type}:\n${content}\n\n`;
                    exportText += '-'.repeat(30) + '\n\n';
                });
                
                exportText += `\nTotal Words Written: ${this.wordCount}`;
                exportText += `\nModel: ${this.getModelDisplayName(this.currentModel)}`;
                exportText += `\nExported: ${new Date().toLocaleString()}`;
                
                const blob = new Blob([exportText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `inkrealm-writing-session-${Date.now()}.txt`;
                a.click();
                
                this.addMessage('system', 'Writing session exported to text file.');
            }
            
            addWelcomeMessage() {
                this.addMessage('system', `
                    <strong>INK REALM AI WRITING TERMINAL</strong><br><br>
                    
                    <strong>Writing Models Available:</strong><br>
                    â€¢ Gemini 2.5 Pro â€“ For detailed narratives and complex prose<br>
                    â€¢ Gemini 2.5 Flash â€“ For quick writing and brainstorming<br>
                    â€¢ Gemma 3 27B â€“ For nuanced, literary writing<br>
                    â€¢ Image Models â€“ For visual writing prompts and inspiration<br><br>
                    
                    <strong>Writing Tools:</strong><br>
                    â€¢ Story continuation and plot development<br>
                    â€¢ Character creation and dialogue<br>
                    â€¢ Poetry and creative forms<br>
                    â€¢ Scene setting and description<br>
                    â€¢ Revision and editing assistance<br><br>
                    
                    Begin by typing your writing prompt or using the quick tools above.
                `);
            }
            
            showWritingExamples() {
                const examples = [
                    "Continue this opening line: 'The last library in the city was closing, and I was the only one who knew what was really inside the forbidden section...'",
                    "Write a poem about digital ghosts in a decaying server farm",
                    "Describe a character who can hear colors as music",
                    "Create dialogue between an AI and its creator who wants to shut it down",
                    "Write a scene set in a rain-soaked cyberpunk city at 3 AM",
                    "Brainstorm ideas for a story about memory thieves in a future society",
                    "Revise this paragraph to be more atmospheric and moody",
                    "Write from the perspective of a sentient piece of forgotten code"
                ];
                
                const randomExample = examples[Math.floor(Math.random() * examples.length)];
                document.getElementById('user-input').value = randomExample;
                document.getElementById('user-input').focus();
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.writingAI = new WritingAITerminal();
        });
    </script>
</body>
						</html>
