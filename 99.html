<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="https://github.com/ghostm68/pantheon/raw/main/atari.gif" type="image/x-icon"/>
    <link rel="shortcut icon" href="https://github.com/ghostm68/pantheon/raw/main/atari.gif" type="image/x-icon"/>
    
    <!-- SEO Meta Tags -->
    <title>Runway: The Video-Integrated Text Editor | Type & Edit Text Over Any Video | InkRealm</title>
    <meta name="description" content="Runway is the first text editor that lives inside a video player. Type, edit, and format text directly on top of any video. Perfect for creating video captions, transcripts, lyric videos, and immersive multimedia documents." />
    <meta name="keywords" content="Runway, Inkrealm, retro, word processor, modern, video, pixel art, literature, typing">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Runway: The Video-Integrated Text Editor by InkRealm" />
    <meta property="og:description" content="Type and edit text directly over any video. Create captions, lyrics, and immersive documents in a whole new way." />
    <meta property="og:url" content="https://inkrealm.info/runway" />
    <meta property="og:image" content="https://inkrealm.info/assets/runway-preview-image.png" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="InkRealm" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <meta charset="utf-8"/>  
    <meta name="viewport" content="width=1024">
    
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Mermaid JS -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    
    <style>
        /* === DEFINE VARIABLES FIRST === */
        :root {
            --red: #ff0033;
            --black: #0a0a0a;
            --primary-color: #fc2b39;
            --bg-primary: #100C13;
            --bg-secondary: #1C1820;
            --text-primary: white;
            --text-secondary: #9CA3AF;
            --border-color: #2A232E;
        }

        /* Light mode color scheme */
        .light-mode {
            --bg-primary: #F3F4F6;
            --bg-secondary: #E5E7EB;
            --text-primary: #111827;
            --text-secondary: #6B7280;
            --border-color: #D1D5DB;
        }

        ::selection {
            background: var(--red);
            color: var(--black);
            text-shadow: none;
        }

        /* CRITICAL: LOADER MUST BE FIRST IN VISIBILITY */
        #fullscreen-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #fc2b39 !important;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 999999;
            transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
        }

        #fullscreen-loader.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #fullscreen-loader img {
            width: 400px;
            height: 400px;
            max-width: 80vw;
            max-height: 80vh;
            object-fit: contain;
            animation: smoothSpin 4s linear infinite;
            filter: drop-shadow(0 0 60px rgba(255, 255, 255, 0.6)) 
                    drop-shadow(0 0 30px rgba(252, 43, 57, 0.4));
        }

        @keyframes smoothSpin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Hide all body content until loaded */
        body:not(.loaded) > *:not(#fullscreen-loader) {
            visibility: hidden !important;
            opacity: 0 !important;
        }

        body.loaded > * {
            visibility: visible;
            opacity: 1;
        }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Enhanced accessibility and theme transitions */
        * {
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }

        /* Improved focus states */
        :focus-visible {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Scrollbar styling for both themes */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color) !important;
            border-radius: 4px;
        }

        /* Subtle animation for interactive elements */
        @keyframes subtle-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .interactive-element:hover {
            animation: subtle-pulse 0.3s ease-in-out;
        }

        /* Internationalization and collaboration styles */
        .collaboration-cursor {
            position: absolute;
            border-left: 2px solid var(--primary-color);
            animation: cursor-blink 1s infinite;
        }
        
        @keyframes cursor-blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
        
        .translation-badge {
            background-color: rgba(252, 43, 57, 0.2);
            color: var(--primary-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
        }

        /* Splash Page Animation */
        @keyframes pixel-pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        @keyframes runway-reveal {
            0% { 
                letter-spacing: -0.5em; 
                opacity: 0; 
                transform: scale(0.5);
            }
            100% { 
                letter-spacing: normal; 
                opacity: 1; 
                transform: scale(1);
            }
        }

        .bar-graph {
            display: flex;
            align-items: flex-end;
            height: 24px;
            gap: 2px;
        }
        
        .bar {
            width: 4px;
            background-color: var(--primary-color);
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scaleY(0.2); }
            50% { transform: scaleY(1); }
        }
        
        .format-button.active {
            background-color: var(--primary-color);
        }
        
        .auto-save-indicator {
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
        }
        
        .search-highlight {
            background-color: rgba(252, 43, 57, 0.3);
            padding: 0 2px;
            border-radius: 2px;
        }

        select:focus, input:focus, textarea:focus, button:focus {
            outline: none !important;
            border-color: #fc2b39 !important;
            box-shadow: 0 0 0 1px #fc2b39 !important;
        }

        /* Fix specific AI dropdown background */
        #wordstar-model-select option {
            background-color: #1C1820;
            color: white;
        }

        /* Mermaid specific styles */
        .mermaid-example {
            margin: 15px 0;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 5px;
        }
        
        .mermaid-example pre {
            background: #000;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        #mermaid-code {
            width: 100%;
            background: #1a1a1a;
            color: #fff;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            margin: 10px 0;
        }
        
        #chart-creation-section button {
            background: #fc2b39;
            color: #000;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        #chart-creation-section button:hover {
            background: #ff4455;
        }

        /* FORCE VIDEO VISIBILITY */
        #main-editor {
            background-color: transparent !important;
        }
    </style>
</head>
<body>
    <div id="fullscreen-loader">
        <img src="https://raw.githubusercontent.com/ghostm68/pantheon/main/runway453.gif" alt="Loading Runway...">
    </div>

    <div class="flex flex-col min-h-screen">
        <!-- HEADER -->
        <header class="sticky top-0 z-20 bg-[#100C13]/80 backdrop-blur-sm border-b border-[#2A232E]">
            <div class="container mx-auto px-6 h-20 flex items-center justify-between">
                <div class="flex items-center gap-6">
                    <div class="flex flex-col">
                        <a class="flex items-center gap-3" href="#">
                            <span class="text-xl font-bold">.......by inkrealm.info</span>
                        </a>
                        <span class="text-xs text-gray-500">.............Powered by google stitch</span>
                    </div>
                    <div class="flex items-center gap-2 bg-[#2A232E] p-1 rounded-lg">
                        <select id="font-select" class="bg-transparent border-none text-white text-sm focus:ring-0 w-32">
                            <option>Be Vietnam Pro</option>
                            <option>Inter</option>
                            <option>Roboto</option>
                            <option>Lato</option>
                            <option>Montserrat</option>
                            <option>Open Sans</option>
                            <option>Poppins</option>
                            <option>Source Sans Pro</option>
                            <option>Work Sans</option>
                        </select>
                        <div class="border-l border-gray-600 h-6"></div>
                        <button id="bold-btn" class="format-button p-2 rounded-md hover:bg-[#3a3142] transition-colors">
                            <span class="material-symbols-outlined text-base">format_bold</span>
                        </button>
                        <button id="italic-btn" class="format-button p-2 rounded-md hover:bg-[#3a3142] transition-colors">
                            <span class="material-symbols-outlined text-base">format_italic</span>
                        </button>
                        <button id="underline-btn" class="format-button p-2 rounded-md hover:bg-[#3a3142] transition-colors">
                            <span class="material-symbols-outlined text-base">format_underlined</span>
                        </button>
                    </div>
                </div>

                <!-- Qwen AI Toggle (Vertical Stack) -->
                <div id="fashion-node-container" style="display: inline-block; font-family: 'Courier New', monospace; vertical-align: middle; margin-right: 15px;">
                    <button id="qwen-toggle" style="padding: 5px 10px; background: #000; color: #ff0033; border: 1px solid #ff0033; cursor: pointer; font-weight: bold; font-size: 11px; text-transform: uppercase;">
                        [ QWEN_OFFLINE ]
                    </button>
                    
                    <div id="qwen-sidebar" style="display: none; position: absolute; width: 350px; background: #000; border: 2px solid #ff0033; padding: 15px; box-shadow: 0 10px 40px rgba(0,0,0,1); z-index: 10001; margin-top: 5px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 1px solid #333; padding-bottom: 8px;">
                            <h4 style="margin: 0; color: #ff0033; font-size: 11px; letter-spacing: 2px;">LOCAL_CORE // 0.5B</h4>
                            <span id="node-status" style="font-size: 9px; color: #666;">STANDBY</span>
                        </div>

                        <div id="boot-zone">
                            <button id="loadCoreBtn" style="width: 100%; padding: 10px; background: #ff0033; color: #000; border: none; cursor: pointer; font-size: 11px; font-weight: bold; text-transform: uppercase;">
                                Initialize Neural Link
                            </button>
                        </div>

                        <div id="download-status" style="display: none; margin-bottom: 10px;">
                            <div style="width: 100%; height: 2px; background: #222;">
                                <div id="progress-bar" style="width: 0%; height: 100%; background: #ff0033;"></div>
                            </div>
                            <div style="font-size: 9px; color: #ff0033; margin-top: 4px; text-align: right;"><span id="progress-percent">0</span>%</div>
                        </div>

                        <div id="output" style="height: 180px; border: 1px solid #222; padding: 10px; overflow-y: auto; margin-bottom: 10px; font-size: 11px; background: #050505; color: #eee; line-height: 1.4; white-space: pre-wrap;">OFFLINE: CORE NOT SYNCED</div>
                        
                        <textarea id="prompt" placeholder="DESCRIBE THE SILHOUETTE..." style="width: 100%; height: 50px; padding: 8px; margin-bottom: 8px; background: #111; border: 1px solid #333; color: white; font-size: 12px; resize: none; box-sizing: border-box; font-family: monospace;"></textarea>
                        
                        <div style="display: flex; gap: 5px;">
                            <button id="generateButton" style="flex: 2; padding: 8px; background: #222; color: #444; border: 1px solid #333; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 10px;">Transmit</button>
                            <button id="insert-btn" style="flex: 1; padding: 8px; background: #000; color: #fff; border: 1px solid #ff0033; cursor: pointer; display: none; text-transform: uppercase; font-size: 10px;">Insert</button>
                        </div>
                    </div>
                </div>

                <div class="flex items-center gap-6">
                    <div class="flex items-center gap-3">
                        <div class="text-right">
                            <div class="h-8 w-px bg-[#2A232E]"></div>
                            <div class="text-right">
                                <p class="text-sm font-semibold">Rome</p>
                                <p class="text-xs text-gray-400" id="rome-time">10:45 AM</p>
                            </div>
                        </div>

                        <div class="auto-save-indicator text-sm text-green-400 flex items-center gap-2">
                            <span class="material-symbols-outlined text-sm">cloud_done</span>
                            <span>Auto-saved</span>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- MAIN CONTENT -->
        <main class="flex-grow container mx-auto px-6 py-8">
            <div class="flex flex-col @container">
                <div class="mb-8 flex justify-between items-center">
                    <h1 class="text-4xl font-bold tracking-tight">Runway Text</h1>
                    <div class="flex items-center gap-4">
                        <input type="file" id="pdf-file-input" accept=".pdf" style="display: none;">
                        <button id="save-pdf" class="flex items-center gap-2 bg-[#fc2b39] hover:bg-[#b91c1c] text-white font-bold py-2 px-4 rounded-lg transition-colors">
                            <span class="material-symbols-outlined">file_download</span>
                            <span>Save PDF</span>
                        </button>
                    </div>
                </div>

                <div class="border-b border-[#2A232E] mb-6">
                    <nav class="-mb-px flex gap-8">
                        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="">RESOURCES:</a>
                        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://fashionmuseum.fitnyc.edu/collections" target="_blank">collections</a>
                        <a class="py-4 px-1 text-white border-b-2 border-[var(--primary-color)] text-sm font-medium" href="https://www.palaisgalliera.paris.fr/en/palais-galliera/ressources-en-ligne" target="_blank">galliera</a>
                        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://digimuse.westphal.drexel.edu/ddm/" target="_blank">drexel</a>
                        <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://fitnyc.libguides.com/?b=s" target="_blank">marcus</a>
                    </nav>
                </div>

                <!-- Word Counter & Dictionary Row -->
                <div class="grid grid-cols-1 @5xl:grid-cols-3 gap-6 mb-6">
                    <!-- Word Counter -->
                    <div class="col-span-1 sticky top-28 h-fit">
                        <div class="bg-[#1C1820] border border-[#2A232E] rounded-lg p-6 space-y-6">
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Word Counter</h3>
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm text-gray-400">Word Count</span>
                                    <span id="word-count" class="font-semibold">0 / 500</span>
                                </div>
                                <div class="bg-[#2A232E] rounded-full h-2 mb-4">
                                    <div id="word-progress" class="bg-[var(--primary-color)] h-2 rounded-full" style="width: 0%;"></div>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div id="activity-bars" class="bar-graph w-full">
                                        <!-- Bars generated by JS -->
                                    </div>
                                    <span class="text-sm text-gray-400 ml-4 whitespace-nowrap">Live</span>
                                </div>
                            </div>
                            
                            <!-- Preferences -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Preferences</h3>
                                <div class="space-y-4">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm text-gray-300" for="video-bg">Video Background</label>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input checked class="sr-only peer" id="video-bg" type="checkbox" value=""/>
                                            <div class="w-11 h-6 bg-[#2A232E] peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-[var(--primary-color)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--primary-color)]"></div>
                                        </label>
                                    </div>

                                    <div>
                                        <label class="text-sm text-gray-300" for="video-url">Custom Video URL</label>
                                        <input id="video-url" class="mt-1 bg-[#2A232E] border border-transparent focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] rounded-lg px-4 py-2 text-sm w-full transition-all" placeholder="Enter YouTube video or playlist URL" type="text"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dictionary -->
                    <div class="col-span-1 @5xl:col-span-1 h-fit sticky top-28">
                        <div class="bg-[#1C1820] border border-[#2A232E] rounded-lg p-6">
                            <h3 class="text-lg font-semibold mb-4">Design Dictionary</h3>
                            <div class="relative mb-4">
                                <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">search</span>
                                <input id="dictionary-search" class="bg-[#2A232E] border border-transparent focus:border-[var(--primary-color)] focus:ring-[var(--primary-color)] rounded-lg pl-10 pr-4 py-2 text-sm w-full transition-all" placeholder="Search terms..." type="search"/>
                            </div>
                            <div id="dictionary-list" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                                <!-- Dictionary terms will be populated by JS -->
                            </div>
                        </div>
                    </div>

                    <!-- Editor Column -->
                    <div class="col-span-1 @5xl:col-span-2 relative overflow-hidden rounded-lg border border-[#2A232E]">
                        <div id="video-background" class="absolute inset-0 z-0">
                            <iframe id="video-iframe" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full object-cover" frameborder="0" src="https://www.youtube.com/embed/Q7kGgb4Ja9Y?autoplay=1&mute=1&loop=1&playlist=Q7kGgb4Ja9Y&controls=0"></iframe>
                        </div>

                        <textarea id="main-editor" class="relative z-10 w-full h-full min-h-[500px] bg-transparent p-6 text-base text-gray-200 leading-relaxed placeholder-gray-400 focus:ring-2 focus:ring-[var(--primary-color)] focus:border-[var(--primary-color)] transition resize-none outline-none" placeholder="Describe your collection's story, key silhouettes, and fabric choices...">Type your text and word structures here...</textarea>

                        <div id="related-terms" class="absolute bottom-4 right-4 z-10 bg-[#1C1820]/80 border border-[#2A232E] rounded-lg p-3 shadow-lg flex items-center gap-3 text-sm">
                            <span class="material-symbols-outlined text-[var(--primary-color)]">lightbulb</span>
                            <span class="text-gray-300">Related:</span>
                            <span class="font-medium text-white cursor-pointer hover:underline" data-term="corset">Corset</span>
                            <span class="font-medium text-white cursor-pointer hover:underline" data-term="bodice">Bodice</span>
                            <span class="font-medium text-white cursor-pointer hover:underline" data-term="satin">Satin</span>
                        </div>
                    </div>
                </div>

                <!-- MERMAID CHART CREATOR SECTION (RESTORED) -->
                <div id="chart-creation-section" class="bg-[#1C1820] border border-[#2A232E] rounded-lg p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">Mermaid Chart Creator</h3>

                    <details class="mb-4">
                        <summary class="cursor-pointer text-[var(--primary-color)] font-semibold">Mermaid Cheat Sheet & Fashion Examples</summary>
                        <div class="mt-4 space-y-4">
                            <div class="mermaid-example">
                                <h4 class="text-md font-semibold mb-2">Dior Collection Workflow (Flowchart)</h4>
                                <pre><code>graph TD
    A[Concept & Inspiration] --> B{Sketching & Design};
    B -- Approved --> C[Fabric Selection];
    B -- Rejected --> A;
    C --> D[Pattern Making];
    D --> E[Sample Creation];
    E --> F{Final Review};
    F -- Approved --> G[Production];
    F -- Rejected --> B;</code></pre>
                            </div>

                            <div class="mermaid-example">
                                <h4 class="text-md font-semibold mb-2">Chanel Show Sequence (Sequence Diagram)</h4>
                                <pre><code>sequenceDiagram
    participant Host
    participant Model
    participant Audience
    Host->>Model: Introduction
    Model->>Audience: Runway Walk
    Audience-->>Model: Applause
    Model->>Host: Final Pose
    Host->>Audience: Thank You</code></pre>
                            </div>
                        </div>

                        <p class="mt-3 text-sm text-gray-400"><b>Tip:</b> Use <code>graph TD</code> for flowcharts and <code>sequenceDiagram</code> for sequence diagrams.</p>
                        <p class="mt-1 text-sm"><a href="https://mermaid.js.org/" target="_blank" class="text-[var(--primary-color)] hover:underline">Mermaid Documentation & Playground →</a></p>
                    </details>

                    <textarea id="mermaid-code" placeholder="Enter Mermaid code here..." rows="8" cols="50" class="w-full bg-[#2A232E] text-white border border-[var(--primary-color)] rounded-lg p-4 font-mono text-sm mb-4"></textarea>
                    
                    <div class="flex gap-3 mb-4">
                        <button id="insert-chart-button" class="bg-[var(--primary-color)] text-black font-bold px-6 py-2 rounded-lg hover:bg-[#ff4455] transition-colors">
                            Insert Chart
                        </button>
                        <button id="download-code-button" class="bg-[#2A232E] text-white font-bold px-6 py-2 rounded-lg hover:bg-[#3a3142] transition-colors">
                            Download Code
                        </button>
                    </div>
                    
                    <div class="mt-4">
                        <img width="486" height="336" src="https://github.com/ghostm68/pantheon/raw/main/inkrealm.info.runway.mermaid2.gif" alt="Mermaid Animation" class="rounded-lg"><br>
                    </div>
                    
                    <div class="mt-4 text-sm text-gray-400">
                        inkrealm.info/runway is under construction - est. September 13, 2025<br>
                        <a href="https://github.com/ghostm68/eg/raw/refs/heads/main/runway.apk" class="text-[var(--primary-color)] hover:underline">mobile app released October 25, 2024</a>
                    </div>
                </div>
            </div>
        </main>

        <!-- Theme Toggle (Fixed Position) -->
        <div class="fixed top-4 right-4 z-50 flex items-center space-x-2">
            <button id="theme-toggle" class="bg-[var(--bg-secondary)] text-[var(--text-primary)] p-2 rounded-full shadow-lg interactive-element">
                <span class="material-symbols-outlined">light_mode</span>
            </button>
        </div>

        <!-- NVIDIA AI Component (Fixed Position) -->
        <div id="wordstar-ai-container" style="position: fixed; top: 20px; right: 20px; z-index: 10000; font-family: 'Courier New', monospace;">
            <button id="wordstar-ai-toggle" style="padding: 12px 16px; background: #000; color: #ff0033; border: 2px solid #ff0033; border-radius: 4px; cursor: pointer; font-weight: bold; box-shadow: 0 0 10px rgba(255, 0, 51, 0.2); transition: all 0.2s; text-transform: uppercase;">
                AI (NVIDIA)
            </button>
            
            <div id="wordstar-ai-sidebar" style="display: none; width: 350px; background: #000; border: 2px solid #ff0033; border-radius: 0; margin-top: 10px; padding: 20px; box-shadow: 0 8px 24px rgba(0,0,0,0.8);">
                <h4 style="margin-top: 0; color: #ff0033; font-size: 14px; font-weight: 800; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 10px;">NVIDIA NIM // TERMINAL</h4>
                
                <div style="margin-bottom: 15px;">
                    <input type="password" id="wordstar-api-key" placeholder="NVAPI- KEY REQUIRED..." style="width: 100%; padding: 10px; margin-bottom: 8px; background: #111; border: 1px solid #444; border-radius: 0; color: #fff; font-size: 12px; box-sizing: border-box;" autocomplete="off">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div id="wordstar-key-status" style="font-size: 10px; color: #666; text-transform: uppercase;">Status: Offline</div>
                        <button id="wordstar-save-key" style="font-size: 10px; padding: 4px 8px; background: #222; color: #fff; border: 1px solid #444; cursor: pointer; text-transform: uppercase;">Authorize</button>
                    </div>
                </div>

                <select id="wordstar-model-select" style="width: 100%; padding: 10px; margin-bottom: 15px; background: #111; border: 1px solid #ff0033; border-radius: 0; color: white; font-size: 12px; box-sizing: border-box; cursor: pointer;">
                    <optgroup label="NVIDIA MODELS" style="background: #000;">
                        <option value="nvidia/nvidia-nemotron-nano-9b-v2" selected>Nemotron Nano 9B (Free)</option>
                        <option value="nvidia/llama-3.1-nemotron-70b-instruct">Llama 3.1 Nemotron 70B</option>
                        <option value="meta/llama-3.1-8b-instruct">Llama 3.1 8B</option>
                    </optgroup>
                </select>

                <div id="wordstar-chat-history" style="height: 250px; border: 1px solid #333; padding: 12px; overflow-y: auto; margin-bottom: 12px; font-size: 13px; background: #080808;"></div>
                
                <textarea id="wordstar-user-input" placeholder="Enter prompt..." style="width: 100%; height: 60px; padding: 10px; margin-bottom: 10px; background: #111; border: 1px solid #444; border-radius: 0; color: white; font-size: 13px; resize: none; box-sizing: border-box;" autocomplete="off"></textarea>
                
                <div style="display: flex; gap: 8px;">
                    <button id="wordstar-send-btn" style="flex: 2; padding: 12px; background: #ff0033; color: #000; border: none; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 1px;">Transmit</button>
                    <button id="wordstar-insert-btn" style="flex: 1; padding: 12px; background: #000; color: #fff; border: 1px solid #ff0033; font-weight: 500; cursor: pointer; display: none; text-transform: uppercase; font-size: 11px;">Insert</button>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <footer class="bg-[#1C1820] border-t border-[#2A232E] py-8 mt-auto">
            <div class="container mx-auto px-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-sm text-gray-400 mb-4 md:mb-0">
                        <center>
                            <p>Get <a class="py-4 px-1 text-gray-400 hover:text-white border-b-2 border-transparent hover:border-gray-400 text-sm font-medium" href="https://liroemagazine.com/" target="_blank">liroe</a> 
                            <img width="66" height="60" src="https://github.com/ghostm68/pantheon/raw/main/lireo.inkrealm.info.runway.promotionalQ.gif"><br></p>
                            
                            <div id="search-container">
                                <input type="text" id="search-input" placeholder="Enter a word to look up" class="bg-[#2A232E] text-white border border-[var(--primary-color)] rounded-lg px-4 py-2 mb-2">
                                <button id="search-button" class="bg-[var(--primary-color)] text-black font-bold px-4 py-2 rounded-lg hover:bg-[#ff4455]">Further Dictionary (w/German)</button>
                            </div>
                            <div id="result" class="mt-4 text-left max-h-60 overflow-y-auto"></div>
                        </center>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <a href="mailto:inkrealm@wordstar.nexus" class="text-gray-300 hover:text-white transition-colors flex items-center gap-2">
                            <span class="material-symbols-outlined text-[var(--primary-color)]">mail</span>
                            inkrealm@wordstar.nexus ↗
                        </a>
                    </div>
                    <div class="text-xs text-gray-500 mt-4 md:mt-0">
                        <p>© 2025 Inkrealm. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- SCRIPTS -->
    <script type="module">
        import * as webllm from "https://esm.run/@mlc-ai/web-llm";

        const modelId = "Qwen2.5-0.5B-Instruct-q4f16_1-MLC"; 
        let engine;

        // DOM Elements
        const btn = document.getElementById('loadCoreBtn');
        const status = document.getElementById('download-status');
        const bar = document.getElementById('progress-bar');
        const percent = document.getElementById('progress-percent');
        const output = document.getElementById('output');
        const generateBtn = document.getElementById('generateButton');
        const sidebar = document.getElementById('qwen-sidebar');

        // UI Toggle
        if (document.getElementById('qwen-toggle')) {
            document.getElementById('qwen-toggle').onclick = (e) => {
                sidebar.style.display = sidebar.style.display === 'none' ? 'block' : 'none';
                sidebar.style.top = (e.target.getBoundingClientRect().bottom + 5) + 'px';
            };
        }

        if (btn) {
            btn.onclick = async () => {
                try {
                    if (!navigator.gpu) {
                        throw new Error("WebGPU API not found.");
                    }
                    const adapter = await navigator.gpu.requestAdapter();
                    if (!adapter) {
                        throw new Error("GPU refused handshake.");
                    }

                    btn.disabled = true;
                    btn.textContent = "SYNCING CORE...";
                    status.style.display = 'block';
                    output.textContent = "⟁ INITIALIZING LOCAL INTERCEPT... PLEASE STAND BY.";

                    engine = await webllm.CreateMLCEngine(modelId, {
                        initProgressCallback: (report) => {
                            const p = Math.round(report.progress * 100);
                            bar.style.width = p + '%';
                            percent.textContent = p;
                            
                            if (p < 100) {
                                output.textContent = "⟁ SYNCING: " + report.text;
                            } else {
                                btn.style.display = 'none';
                                output.textContent = "⟁ LOCAL CORE STABLE. THE SOFT MACHINE IS ONLINE.";
                                generateBtn.style.background = "#ff0033";
                                generateBtn.style.color = "#000";
                                document.getElementById('node-status').textContent = "ACTIVE";
                                document.getElementById('node-status').style.color = "#ff0033";
                            }
                        }
                    });

                    generateBtn.onclick = async () => {
                        const promptInput = document.getElementById('prompt');
                        const prompt = promptInput.value.trim();
                        if (!prompt) return;
                        
                        generateBtn.disabled = true;
                        generateBtn.textContent = "PROCESSING...";
                        output.textContent = ""; 
                        
                        try {
                            const messages = [
                                { 
                                    role: "system", 
                                    content: "You are the INK REALM Fashion Interface. Write with haute couture precision. AVOID generic filler like 'sophistication' or 'beauty.' Focus on technical materiality: the grain of the fabric, the tension of the seams, and the sharp geometry of the silhouette. Be terse, luxurious, and incisive. Describe the garment as a physical object of construction." 
                                },
                                { role: "user", content: prompt }
                            ];

                            const chunks = await engine.chat.completions.create({ 
                                messages, 
                                stream: true,
                                temperature: 0.6, 
                                top_p: 0.9,
                                max_tokens: 512   
                            });

                            let fullText = "";
                            output.textContent = "";

                            for await (const chunk of chunks) {
                                fullText += chunk.choices[0]?.delta?.content || "";
                                output.textContent = fullText;
                                output.scrollTop = output.scrollHeight;
                            }

                            const insBtn = document.getElementById('insert-btn');
                            insBtn.style.display = 'block';
                            
                            insBtn.onclick = () => {
                                const editor = document.getElementById('main-editor');
                                if (editor) {
                                    const s = editor.selectionStart;
                                    const e = editor.selectionEnd;
                                    editor.value = editor.value.slice(0, s) + fullText + editor.value.slice(e);
                                    insBtn.style.display = 'none';
                                    editor.focus(); 
                                }
                            };

                        } catch (genErr) {
                            output.textContent = "[LOCAL ENGINE ERROR]: " + genErr.message;
                        } finally {
                            generateBtn.disabled = false;
                            generateBtn.textContent = "Transmit";
                        }
                    };

                } catch (err) {
                    console.warn("Local Core failed:", err.message);
                    status.style.display = 'none';
                    btn.disabled = true;
                    btn.textContent = "CORE UNAVAILABLE";
                    output.textContent = `[SIGNAL INTERRUPTED]: ${err.message}`;
                }
            };
        }
    </script>

    <script>
        // Fashion Dictionary
        const fashionDictionary = {
            'a-line': 'A garment silhouette that is fitted at the hips and gradually widens towards the hem, giving the impression of the shape of a capital letter A.',
            'applique': 'A decorative design made by cutting pieces of one material and applying them to the surface of another.',
            'avant-garde': 'New and experimental fashion ideas, often unconventional and ahead of current trends.',
            'bias-cut': 'A technique of cutting fabric diagonally across the grain, creating garments that drape naturally with body movement.',
            'bespoke': 'Custom-made clothing created specifically for an individual customer.',
            'bustier': 'A form-fitting garment worn as underwear or outerwear, designed to push up the bust and define the waist.',
            'chiffon': 'A lightweight, sheer fabric with a slightly rough texture.',
            'dart': 'A tapered seam used to shape flat fabric to the curves of the body.',
            'draping': 'The technique of positioning and pinning fabric on a dress form to design in 3D.',
            'embroidery': 'Decorative needlework in which designs are formed by stitching threads onto fabric.',
            'empire-waist': 'A style where the waistline is raised above the natural waist, just below the bust.',
            'haute-couture': 'High-end fashion constructed by hand from start to finish.',
            'peplum': 'A short overskirt or ruffle attached at the waist of a garment.',
            'corset': 'A close-fitting undergarment worn to shape and support the torso.',
            'bodice': 'The upper part of a dress or the part above the waist.',
            'satin': 'A smooth, glossy fabric with a lustrous surface.',
            'silhouette': 'The overall shape or outline of a garment when worn.',
            'texture': 'The surface quality or feel of a fabric.',
            'couture': 'High-quality, custom-fitted clothing made with attention to detail.',
            'minimalism': 'A design approach characterized by simplicity, clean lines, and a monochromatic palette.',
            'sustainable-fashion': 'An approach to clothing design, production, and consumption that prioritizes environmental and social responsibility.',
            'upcycling': 'The process of transforming by-products, waste materials, or unwanted products into new materials or products of better quality or environmental value.',
            'gender-neutral': 'Clothing designed to be non-specific to a particular gender, focusing on universal styles and fits.',
            'streetwear': 'Casual clothing style that originated from urban youth culture and has since become a global fashion phenomenon.',
            'tech-wear': 'Fashion that integrates technological elements and performance materials into clothing design.',
            'circular-fashion': 'A regenerative approach where materials are reused, recycled, and kept in use for as long as possible.',
            'capsule-wardrobe': 'A compact collection of versatile clothing pieces that can be mixed and matched to create multiple outfits.',
            'zero-waste-design': 'A pattern cutting and construction method that eliminates textile waste during the garment creation process.'
        };

        // Populate dictionary list
        function populateDictionary() {
            const dictList = document.getElementById('dictionary-list');
            if (!dictList) return;
            
            dictList.innerHTML = '';
            Object.keys(fashionDictionary).forEach(term => {
                const link = document.createElement('a');
                link.href = '#';
                link.className = 'dictionary-term block text-sm text-gray-300 hover:text-white';
                link.setAttribute('data-term', term);
                link.textContent = term.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
                dictList.appendChild(link);
            });
        }

        // Get editor element
        function getEditor() {
            return document.getElementById('main-editor');
        }

        // Format text
        function formatText(command) {
            const editor = getEditor();
            if (!editor) return;
            
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selectedText = editor.value.substring(start, end);
            
            if (selectedText) {
                let formattedText = selectedText;
                switch(command) {
                    case 'bold':
                        formattedText = `**${selectedText}**`;
                        break;
                    case 'italic':
                        formattedText = `*${selectedText}*`;
                        break;
                    case 'underline':
                        formattedText = `__${selectedText}__`;
                        break;
                }
                
                editor.value = editor.value.substring(0, start) + formattedText + editor.value.substring(end);
                editor.focus();
                editor.setSelectionRange(start + formattedText.length, start + formattedText.length);
                
                triggerAutoSave();
                updateWordCount();
            }
        }

        // Formatting button events
        document.getElementById('bold-btn')?.addEventListener('click', () => formatText('bold'));
        document.getElementById('italic-btn')?.addEventListener('click', () => formatText('italic'));
        document.getElementById('underline-btn')?.addEventListener('click', () => formatText('underline'));

        // Font selector
        document.getElementById('font-select')?.addEventListener('change', function(e) {
            const editor = getEditor();
            if (editor) {
                editor.style.fontFamily = e.target.value;
                localStorage.setItem('runway-font', e.target.value);
            }
        });

        // Word counter
        function updateWordCount() {
            const editor = getEditor();
            if (!editor) return;
            
            const text = editor.value.trim();
            const wordCount = text === '' ? 0 : text.split(/\s+/).length;
            const maxWords = 500;
            const percentage = Math.min((wordCount / maxWords) * 100, 100);

            const wordCountEl = document.getElementById('word-count');
            const progressEl = document.getElementById('word-progress');
            
            if (wordCountEl) wordCountEl.textContent = `${wordCount} / ${maxWords}`;
            if (progressEl) {
                progressEl.style.width = `${percentage}%`;
                
                if (percentage > 90) {
                    progressEl.style.backgroundColor = '#ef4444';
                } else if (percentage > 75) {
                    progressEl.style.backgroundColor = '#f59e0b';
                } else {
                    progressEl.style.backgroundColor = 'var(--primary-color)';
                }
            }
        }

        // Activity bars
        function updateActivityBars() {
            const bars = document.querySelectorAll('#activity-bars .bar');
            if (bars.length === 0) {
                const container = document.getElementById('activity-bars');
                if (container) {
                    for (let i = 0; i < 20; i++) {
                        const bar = document.createElement('div');
                        bar.className = 'bar';
                        bar.style.animationDelay = `-${i * 0.1}s`;
                        container.appendChild(bar);
                    }
                }
            }
            
            document.querySelectorAll('#activity-bars .bar').forEach(bar => {
                const randomHeight = Math.random() * 80 + 20;
                bar.style.height = `${randomHeight}%`;
            });
        }

        // Auto-save
        let autoSaveTimeout;
        function triggerAutoSave() {
            clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(autoSave, 2000);
        }

        function autoSave() {
            const editor = getEditor();
            if (editor) {
                localStorage.setItem('runway-content', editor.value);
            }

            const indicator = document.querySelector('.auto-save-indicator');
            if (indicator) {
                indicator.classList.add('show');
                setTimeout(() => indicator.classList.remove('show'), 2000);
            }
        }

        // Clocks
        function updateClocks() {
            const now = new Date();
            const romeEl = document.getElementById('rome-time');
            if (romeEl) {
                romeEl.textContent = now.toLocaleTimeString('en-US', {
                    timeZone: 'Europe/Rome',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                });
            }
        }

        // Dictionary search
        function setupDictionarySearch() {
            const searchInput = document.getElementById('dictionary-search');
            if (!searchInput) return;
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('.dictionary-term').forEach(term => {
                    const termText = term.textContent.toLowerCase();
                    const isVisible = termText.includes(searchTerm);
                    term.style.display = isVisible ? 'block' : 'none';
                });
            });
        }

        // Dictionary term clicks
        function setupDictionaryClicks() {
            document.addEventListener('click', function(e) {
                const term = e.target.closest('.dictionary-term, [data-term]');
                if (!term) return;
                e.preventDefault();
                
                const termText = term.textContent;
                const termKey = term.getAttribute('data-term') || termText.toLowerCase();
                insertAtCursor(termText);
                showDefinition(termKey);
            });
        }

        function insertAtCursor(text) {
            const editor = getEditor();
            if (!editor) return;
            
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            
            editor.value = editor.value.substring(0, start) + ' ' + text + ' ' + editor.value.substring(end);
            editor.focus();
            editor.setSelectionRange(start + text.length + 2, start + text.length + 2);
            
            triggerAutoSave();
            updateWordCount();
        }

        function showDefinition(term) {
            const definition = fashionDictionary[term.toLowerCase()] || fashionDictionary[term.replace('-', '').toLowerCase()];
            if (definition) {
                let popup = document.getElementById('definition-popup');
                if (!popup) {
                    popup = document.createElement('div');
                    popup.id = 'definition-popup';
                    popup.className = 'fixed bottom-20 left-6 bg-[#1C1820] border border-[#2A232E] rounded-lg p-4 max-w-sm z-30 shadow-lg';
                    document.body.appendChild(popup);
                }

                popup.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h4 class="font-semibold text-[var(--primary-color)] capitalize">${term.replace('-', ' ')}</h4>
                        <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white">
                            <span class="material-symbols-outlined text-sm">close</span>
                        </button>
                    </div>
                    <p class="text-sm text-gray-300 leading-relaxed">${definition}</p>
                `;

                popup.style.display = 'block';
                setTimeout(() => { if (popup) popup.remove(); }, 8000);
            }
        }

        // PDF Save
        document.getElementById('save-pdf')?.addEventListener('click', function(e) {
            if (!window.jspdf) {
                alert("PDF Library missing.");
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const title = document.querySelector('h1') ? document.querySelector('h1').textContent : "Runway Text";
            const editor = document.getElementById('main-editor');
            const content = editor ? editor.value : "";
            
            doc.setFontSize(20);
            doc.text(title, 20, 30);
            
            doc.setFontSize(12);
            const splitContent = doc.splitTextToSize(content, 170);
            doc.text(splitContent, 20, 50);

            doc.save('runway-project.pdf');
            
            const btn = this;
            const origText = btn.innerHTML;
            btn.innerHTML = '<span class="material-symbols-outlined">check</span> Saved!';
            setTimeout(() => { btn.innerHTML = origText; }, 2000);
        });

        // Video controls
        function setupVideoControls() {
            const videoInput = document.getElementById('video-url');
            if (videoInput) {
                videoInput.addEventListener('change', function(e) {
                    const url = e.target.value.trim();
                    if (!url) return;

                    let videoId = '';
                    
                    if (url.includes('v=')) {
                        videoId = url.split('v=')[1].split('&')[0];
                    } else if (url.includes('youtu.be/')) {
                        videoId = url.split('youtu.be/')[1].split('?')[0];
                    } else if (url.includes('embed/')) {
                        videoId = url.split('embed/')[1].split('?')[0];
                    }

                    if (videoId) {
                        const iframe = document.getElementById('video-iframe');
                        if (iframe) {
                            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&controls=0&showinfo=0&rel=0&playlist=${videoId}`;
                        }
                    } else {
                        alert("Could not recognize YouTube URL format.");
                    }
                });
            }

            const videoToggle = document.getElementById('video-bg');
            if (videoToggle) {
                videoToggle.addEventListener('change', function(e) {
                    const videoBg = document.getElementById('video-background');
                    if (videoBg) {
                        videoBg.style.display = e.target.checked ? 'block' : 'none';
                    }
                });
            }
        }

        // Theme toggle
        function setupThemeToggle() {
            const themeToggle = document.getElementById('theme-toggle');
            if (!themeToggle) return;
            
            const themeIcon = themeToggle.querySelector('.material-symbols-outlined');
            const savedTheme = localStorage.getItem('runway-theme') || 'dark';
            
            function setTheme(theme) {
                if (theme === 'light') {
                    document.documentElement.classList.add('light-mode');
                    if (themeIcon) themeIcon.textContent = 'dark_mode';
                    localStorage.setItem('runway-theme', 'light');
                } else {
                    document.documentElement.classList.remove('light-mode');
                    if (themeIcon) themeIcon.textContent = 'light_mode';
                    localStorage.setItem('runway-theme', 'dark');
                }
            }

            setTheme(savedTheme);

            themeToggle.addEventListener('click', () => {
                const currentTheme = document.documentElement.classList.contains('light-mode') ? 'light' : 'dark';
                setTheme(currentTheme === 'dark' ? 'light' : 'dark');
            });
        }

        // Mermaid functionality (RESTORED)
        function setupMermaid() {
            const insertBtn = document.getElementById('insert-chart-button');
            const downloadBtn = document.getElementById('download-code-button');
            const mermaidCode = document.getElementById('mermaid-code');
            
            if (insertBtn) {
                insertBtn.addEventListener('click', () => {
                    const code = mermaidCode.value.trim();
                    if (!code) {
                        alert('Please enter Mermaid code first');
                        return;
                    }
                    
                    // Insert as comment with chart preview
                    const editor = getEditor();
                    if (editor) {
                        const start = editor.selectionStart;
                        const text = `\n<!-- MERMAID CHART:\n${code}\n-->\n[Mermaid Chart - View at mermaid.live]\n`;
                        editor.value = editor.value.substring(0, start) + text + editor.value.substring(start);
                        editor.focus();
                        triggerAutoSave();
                    }
                    
                    // Open in Mermaid Live for preview
                    window.open(`https://mermaid.live/edit#pako:${btoa(code)}`, '_blank');
                });
            }
            
            if (downloadBtn) {
                downloadBtn.addEventListener('click', () => {
                    const code = mermaidCode.value.trim();
                    if (!code) {
                        alert('Please enter Mermaid code first');
                        return;
                    }
                    
                    const blob = new Blob([code], { type: "text/plain" });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = "mermaid_chart.mmd";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                });
            }
        }

        // NVIDIA AI Component
        function setupNvidiaAI() {
            const NVIDIA_URL = 'https://integrate.api.nvidia.com/v1/chat/completions';
            let lastAIResponse = '';
            
            const $ = id => document.getElementById(id);
            
            const savedKey = localStorage.getItem('nvidia_nim_key');
            if (savedKey && $('wordstar-api-key')) {
                $('wordstar-api-key').value = savedKey;
                $('wordstar-key-status').innerHTML = '<span style="color:#ff0033">✓ KEY AUTHORIZED</span>';
            }

            $('wordstar-ai-toggle')?.addEventListener('click', () => {
                const box = $('wordstar-ai-sidebar');
                if (box) {
                    box.style.display = box.style.display === 'none' ? 'block' : 'none';
                    if(box.style.display === 'block') $('wordstar-user-input')?.focus();
                }
            });

            $('wordstar-save-key')?.addEventListener('click', () => {
                const key = $('wordstar-api-key')?.value.trim();
                if(key && key.startsWith('nvapi-')) {
                    localStorage.setItem('nvidia_nim_key', key);
                    $('wordstar-key-status').innerHTML = '<span style="color:#ff0033">✓ KEY SAVED</span>';
                } else {
                    alert('Error: Key must start with nvapi-');
                }
            });

            $('wordstar-send-btn')?.addEventListener('click', sendMessage);
            
            $('wordstar-user-input')?.addEventListener('keydown', e => {
                if (e.key === 'Enter' && !e.shiftKey) { 
                    e.preventDefault(); 
                    sendMessage(); 
                }
            });

            $('wordstar-insert-btn')?.addEventListener('click', () => {
                const editor = document.getElementById('main-editor');
                if (!editor) return;
                
                const [start, end] = [editor.selectionStart, editor.selectionEnd];
                editor.value = editor.value.substring(0, start) + lastAIResponse + editor.value.substring(end);
                editor.focus();
                $('wordstar-insert-btn').style.display = 'none';
            });

            async function sendMessage() {
                const msg = $('wordstar-user-input')?.value.trim();
                const key = $('wordstar-api-key')?.value.trim();
                const selectedModel = $('wordstar-model-select')?.value;
                
                if (!msg) return;
                if (!key) { alert('ENTER API KEY'); return; }

                addMessage('user', msg);
                $('wordstar-user-input').value = '';
                
                const btn = $('wordstar-send-btn');
                btn.disabled = true; 
                btn.textContent = 'PROCESSING...';
                btn.style.backgroundColor = '#333';
                btn.style.color = '#666';

                try {
                    const proxyUrl = 'https://lively-limitless.inkrealm.workers.dev/?url=' +  encodeURIComponent(NVIDIA_URL);
                    
                    const response = await fetch(proxyUrl, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json', 
                            'Authorization': 'Bearer ' + key 
                        },
                        body: JSON.stringify({
                            model: selectedModel,
                            messages: [{ role: "user", content: msg }],
                            temperature: 0.5, 
                            top_p: 1, 
                            max_tokens: 1024, 
                            stream: false
                        })
                    });

                    if (!response.ok) {
                        const errText = await response.text();
                        throw new Error(`HTTP ${response.status}: ${errText.substring(0, 50)}`);
                    }

                    const data = await response.json();
                    
                    if (data.choices && data.choices[0]) {
                        lastAIResponse = data.choices[0].message.content;
                        addMessage('assistant', lastAIResponse);
                        $('wordstar-insert-btn').style.display = 'block';
                    } else {
                        throw new Error("Empty response from AI");
                    }

                } catch (error) {
                    console.error(error);
                    addMessage('system', 'CRITICAL FAILURE: ' + error.message);
                } finally {
                    btn.disabled = false; 
                    btn.textContent = 'Transmit';
                    btn.style.backgroundColor = '#ff0033';
                    btn.style.color = '#000';
                }
            }

            function addMessage(role, text) {
                const chat = $('wordstar-chat-history');
                if (!chat) return;
                
                const div = document.createElement('div');
                const config = {
                    user: { color: '#fff', bg: '#111', border: '#444', label: 'USER' },
                    assistant: { color: '#fff', bg: '#000', border: '#ff0033', label: 'NVIDIA' },
                    system: { color: '#ff0033', bg: '#1a0000', border: '#ff0033', label: 'ERROR' }
                }[role];

                div.innerHTML = `
                    <div style="margin-bottom:12px; padding:10px; background:${config.bg}; border:1px solid ${config.border};">
                        <div style="font-size:9px; font-weight:bold; color:${config.border}; text-transform:uppercase; margin-bottom:4px; letter-spacing:1px;">${config.label}</div>
                        <div style="white-space:pre-wrap; color:${config.color}; line-height:1.4; font-size: 13px;">${text}</div>
                    </div>`;
                
                chat.appendChild(div);
                chat.scrollTop = chat.scrollHeight;
            }
        }

        // Loader
        (function() {
            const loader = document.getElementById('fullscreen-loader');
            const body = document.body;
            
            window.addEventListener('load', function() {
                setTimeout(function() {
                    loader.classList.add('hidden');
                    body.classList.add('loaded');
                    
                    setTimeout(function() {
                        if (loader && loader.parentNode) {
                            loader.parentNode.removeChild(loader);
                        }
                    }, 1000);
                }, 2500);
            });
        })();

        // Multi-dictionary search
        function setupMultiDictionary() {
            const searchButton = document.getElementById('search-button');
            const searchInput = document.getElementById('search-input');
            const result = document.getElementById('result');

            const dictionaryUrls = [
                'https://raw.githubusercontent.com/matthewreagan/WebstersEnglishDictionary/master/dictionary.json',
                'https://gist.githubusercontent.com/BideoWego/60fbd40d5d1f0f1beca11ba95221dd38/raw/58fb4cce910fbf5fa67a2f0f1f619c09d7b1b373/dictionary.json',
                'https://raw.githubusercontent.com/adambom/dictionary/master/dictionary.json',
                'https://raw.githubusercontent.com/hathibelagal/German-English-JSON-Dictionary/master/german_english.json'
            ];

            async function searchDictionary(word) {
                if (!result) return;
                result.innerHTML = '<p class="loading">Searching...</p>';
                
                try {
                    const responses = await Promise.all(dictionaryUrls.map(url => axios.get(url)));
                    const dictionaries = responses.map(response => response.data);
                    
                    let definitionsFound = false;
                    let resultHTML = `<h2 class="text-lg font-semibold mb-2">Definitions and Translations for "${word}":</h2>`;

                    dictionaries.forEach((dictionary, index) => {
                        if (index < 3) {
                            if (dictionary[word.toLowerCase()]) {
                                definitionsFound = true;
                                const definition = dictionary[word.toLowerCase()];
                                resultHTML += `
                                    <div class="mb-3 p-2 bg-[#2A232E] rounded">
                                        <h3 class="text-[var(--primary-color)] font-semibold">English Definition (Source ${index + 1}):</h3>
                                        <p class="text-sm">${definition}</p>
                                    </div>
                                `;
                            }
                        } else {
                            const germanTranslations = Object.entries(dictionary).filter(([key, value]) => 
                                value.toLowerCase().includes(word.toLowerCase()) || key.toLowerCase() === word.toLowerCase()
                            );
                            if (germanTranslations.length > 0) {
                                definitionsFound = true;
                                resultHTML += `<h3 class="text-[var(--primary-color)] font-semibold mt-2">German Translations:</h3><ul class="list-disc pl-5">`;
                                germanTranslations.forEach(([german, english]) => {
                                    resultHTML += `<li class="text-sm"><span class="font-semibold">${german}</span> - ${english}</li>`;
                                });
                                resultHTML += `</ul>`;
                            }
                        }
                    });

                    if (definitionsFound) {
                        result.innerHTML = resultHTML;
                    } else {
                        result.innerHTML = `<p class="text-gray-400">No definition or translation found for "${word}" in any of the sources.</p>`;
                    }
                } catch (error) {
                    console.error('Error fetching dictionary data:', error);
                    result.innerHTML = '<p class="text-red-500">An error occurred while searching. Please try again later.</p>';
                }
            }

            if (searchButton) {
                searchButton.addEventListener('click', () => {
                    const word = searchInput?.value.trim();
                    if (word) {
                        searchDictionary(word);
                    }
                });
            }

            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        const word = searchInput.value.trim();
                        if (word) {
                            searchDictionary(word);
                        }
                    }
                });
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'b': e.preventDefault(); formatText('bold'); break;
                    case 'i': e.preventDefault(); formatText('italic'); break;
                    case 'u': e.preventDefault(); formatText('underline'); break;
                    case 's': e.preventDefault(); autoSave(); break;
                }
            }
        });

        // Initialize everything on DOM load
        document.addEventListener('DOMContentLoaded', function() {
            populateDictionary();
            setupDictionarySearch();
            setupDictionaryClicks();
            setupVideoControls();
            setupThemeToggle();
            setupMermaid();
            setupNvidiaAI();
            setupMultiDictionary();
            
            // Generate activity bars
            updateActivityBars();
            setInterval(updateActivityBars, 2000);
            
            // Restore saved content
            const savedContent = localStorage.getItem('runway-content');
            if (savedContent && getEditor()) {
                getEditor().value = savedContent;
            }
            
            // Restore saved font
            const savedFont = localStorage.getItem('runway-font');
            if (savedFont && getEditor()) {
                getEditor().style.fontFamily = savedFont;
                const fontSelect = document.getElementById('font-select');
                if (fontSelect) fontSelect.value = savedFont;
            }
            
            updateWordCount();
            updateClocks();
            setInterval(updateClocks, 1000);
            
            // Editor input handler
            const editor = getEditor();
            if (editor) {
                editor.addEventListener('input', function() {
                    updateWordCount();
                    triggerAutoSave();
                });
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</body>
</html>
