<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="https://github.com/ghostm68/pantheon/raw/main/atari.gif" type="image/x-icon"/>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Step back in time with Inkrealm's 'Atari' experience! Retro word processor with classic arcade vibes.">
    <meta name="keywords" content="Atari, Inkrealm, retro, word processor, Asteroids, gaming, pixel art, nostalgia, vintage computer">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Inkrealm: Atari Word Processor & Asteroids">
    <meta property="og:description" content="Relive the golden age of gaming and computing with Inkrealm's 'Atari'!">
    <meta property="og:url" content="https://inkrealm.info/atari">
    <meta property="og:type" content="website">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Inkrealm: Atari Word Processor & Asteroids">
    <meta name="twitter:description" content="Type like it's 1980 with our retro word processor and blast asteroids!">
    
    <title>Atari Terminal | INKREALM</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.1/css/all.css" integrity="sha384-xxzQGERXS00kBmZW/6qxqJPyxW3UR0BPsL4c8ILaIWXva5kFi7TxkIIaMiKtqV1Q" crossorigin="anonymous">
    <style>
    /* Scrollbar styling */
    ::-webkit-scrollbar {
        width: 20px;
    }
    ::-webkit-scrollbar-track {
        box-shadow: inset 0 0 5px #888;
        border-radius: 10px;
        background: #f0f0f0;
    }
    ::-webkit-scrollbar-thumb {
        background: #666;
        border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: #d00;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        background-color: #222;
        color: #fff;
        font-family: 'VT323', monospace;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }

    /* Header */
    .atari-header {
        width: 100%;
        max-width: 1200px;
        background-color: #111;
        padding: 15px 20px;
        margin-bottom: 15px;
        text-align: center;
        border: 3px solid #fff;
        position: relative;
    }

    .atari-header h1 {
        font-size: 36px;
        color: #fff;
        margin-bottom: 5px;
        text-shadow: 2px 2px 0 #d00;
    }

    .atari-header p {
        font-size: 14px;
        margin: 0;
        color: #aaa;
    }

    .game-link {
        background: none;
        border: 2px solid #fff;
        color: #fff;
        padding: 8px 16px;
        font-family: 'VT323', monospace;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 8px;
    }

    .game-link:hover {
        background-color: #d00;
        color: #fff;
        border-color: #d00;
    }

    /* Atari marquee */
    .atari-marquee {
        margin: 0 0 15px 0;
        padding: 8px;
        background-color: #111;
        border: 2px solid #fff;
        width: 100%;
        max-width: 1200px;
        color: #fff;
    }
    
    /* Main container with side-by-side layout */
    .main-wrapper {
        width: 100%;
        max-width: 1200px;
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
    }

    .terminal-container {
        flex: 1;
        background-color: #111;
        border: 3px solid #fff;
        padding: 15px;
    }

    /* Magic 8-Ball side panel */
    .side-panel {
        width: 260px;
    }

    /* Magic 8-Ball */
    .magic-ball {
        background-color: #111;
        border: 3px solid #fff;
        padding: 15px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .ball-title {
        color: #fff;
        font-size: 24px;
        text-align: center;
        margin-bottom: 10px;
        text-transform: uppercase;
    }

    .ball-container {
        background: linear-gradient(135deg, #333 0%, #111 100%);
        border: 3px solid #d00;
        border-radius: 50%;
        width: 180px;
        height: 180px;
        margin: 0 auto 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: inset 0 0 30px rgba(221, 0, 0, 0.5),
                    0 0 20px rgba(221, 0, 0, 0.3);
    }

    .ball-container:hover {
        transform: scale(1.05);
        box-shadow: inset 0 0 40px rgba(221, 0, 0, 0.7),
                    0 0 30px rgba(221, 0, 0, 0.5);
    }

    .ball-container:active {
        transform: scale(0.95);
    }

    .ball-window {
        background-color: #000;
        border: 2px solid #fff;
        border-radius: 50%;
        width: 120px;
        height: 120px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 15px;
        box-shadow: inset 0 0 20px rgba(255, 255, 255, 0.3);
    }

    .ball-answer {
        color: #fff;
        font-size: 18px;
        text-align: center;
        line-height: 1.2;
        text-shadow: 0 0 10px #d00;
    }

    .ball-number {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 72px;
        color: #d00;
        text-shadow: 2px 2px 0 #000;
        font-weight: bold;
    }

    .ball-instruction {
        color: #ccc;
        font-size: 16px;
        text-align: center;
        margin-bottom: 10px;
        line-height: 1.3;
    }

    .shake {
        animation: shake 0.5s;
    }

    @keyframes shake {
        0%, 100% { transform: rotate(0deg); }
        25% { transform: rotate(-10deg); }
        75% { transform: rotate(10deg); }
    }

    /* Menu bar */
    .menu-bar {
        background-color: #333;
        padding: 10px;
        margin-bottom: 15px;
        border: 2px solid #fff;
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 10px;
    }

    .menu-bar button {
        background: none;
        border: 2px solid #fff;
        color: #fff;
        font-size: 18px;
        font-family: 'VT323', monospace;
        padding: 6px 12px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .menu-bar button:hover {
        background-color: #d00;
        color: #fff;
        border-color: #d00;
    }

    /* Text editor */
    .editor-wrapper {
        margin-bottom: 15px;
    }

    textarea#textEditor {
        width: 100%;
        height: 350px;
        background-color: #222;
        color: #fff;
        border: 2px solid #fff;
        padding: 12px;
        font-family: 'VT323', monospace;
        font-size: 18px;
        resize: vertical;
    }

    textarea#textEditor::placeholder {
        color: #888;
    }

    /* Footer actions */
    .footer-actions {
        background-color: #333;
        padding: 10px;
        border: 2px solid #fff;
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 8px;
    }

    .footer-actions button {
        background: none;
        border: 2px solid #fff;
        color: #fff;
        font-size: 16px;
        font-family: 'VT323', monospace;
        padding: 6px 12px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .footer-actions button:hover {
        background-color: #d00;
        color: #fff;
        border-color: #d00;
    }

    /* Site footer */
    .site-footer {
        width: 100%;
        max-width: 1200px;
        background-color: #111;
        background-image: url('https://github.com/ghostm68/pantheon/raw/main/atari.inkrealm.ad.gif');
        background-repeat: repeat;
        background-size: 100px;
        background-blend-mode: overlay;
        border: 3px solid #fff;
        padding: 20px;
        text-align: center;
        color: #fff;
        font-size: 16px;
        position: relative;
    }

    .site-footer::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(17, 17, 17, 0.85);
        z-index: 0;
    }

    .site-footer > * {
        position: relative;
        z-index: 1;
    }

    .site-footer p {
        margin: 8px 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
    }

    .site-footer a {
        color: #fff;
        text-decoration: none;
        transition: color 0.3s;
    }

    .site-footer a:hover {
        color: #d00;
    }

    .footer-donate {
        margin: 15px 0;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 15px;
    }

    .paypal-btn {
        background: linear-gradient(135deg, #666 0%, #333 100%);
        color: white;
        border: 2px solid #000;
        padding: 10px 20px;
        font-family: 'VT323', monospace;
        font-size: 20px;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.3s;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }

    .paypal-btn:hover {
        background: linear-gradient(135deg, #d00 0%, #a00 100%);
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    }

    .paypal-btn:active {
        transform: translateY(0);
    }

    .paypal-btn::before {
        content: 'üí≥ ';
    }

    /* Game overlay */
    .game-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.95);
        z-index: 1000;
        overflow: auto;
    }

    .game-overlay.active {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    main {
        outline: none;
    }

    #gameCanvas {
        border: 3px solid #fff;
    }

    #instructions {
        color: #fff;
        font-family: 'VT323', monospace;
        font-size: 18px;
        margin-top: 20px;
        text-align: center;
    }

    .commands {
        margin: 5px 0;
    }

    kbd {
        background-color: #111;
        border: 2px solid #fff;
        padding: 5px 10px;
        margin: 0 5px;
        border-radius: 3px;
        color: #fff;
    }

    .volume {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 20px;
    }

    .volume i {
        font-size: 32px;
        color: #fff;
        cursor: pointer;
        transition: color 0.3s;
    }

    .volume i:hover {
        color: #d00;
    }

    .volume i.mute {
        color: #666;
    }

    #sound {
        cursor: pointer;
    }

    .close-game {
        position: absolute;
        top: 20px;
        right: 20px;
        background: none;
        border: 2px solid #fff;
        color: #fff;
        padding: 10px 20px;
        font-family: 'VT323', monospace;
        font-size: 20px;
        cursor: pointer;
        z-index: 1001;
    }

    .close-game:hover {
        background-color: #d00;
        color: #fff;
        border-color: #d00;
    }

    /* Responsive */
    @media (max-width: 900px) {
        .main-wrapper {
            flex-direction: column;
        }
        
        .side-panel {
            width: 100%;
        }

        .magic-ball {
            padding: 30px;
        }
    }

    @media (max-width: 768px) {
        .atari-header h1 {
            font-size: 32px;
        }
        
        .game-link {
            position: static;
            margin-top: 10px;
        }
        
        textarea#textEditor {
            height: 300px;
        }
    }
</style>
   	<style>
	/* 1. The Text Highlight (Your snippet) */
::selection {
  background: var(--red);
  color: var(--black);
  text-shadow: none;
}

/* 2. Firefox Support (Just in case) */
::-moz-selection {
  background: var(--red);
  color: var(--black);
}

/* 3. The Blinking Cursor (Input fields) */
input, textarea, [contenteditable] {
  caret-color: var(--red);
}

/* 4. The Mobile "Tap" Flash (Crucial for phones) */
* {
  -webkit-tap-highlight-color: transparent;
}

/* 5. Focus Rings (Tab selection) */
*:focus {
  outline: 1px dotted var(--red);
  outline-offset: 2px;
}
	</style> 
</head>
<body>
    <!-- Header -->
    <div class="atari-header">
        <h1>ATARI TERMINAL</h1>
        <p>INKREALM.INFO/ATARI</p>
        <button class="game-link" onclick="openGame()">‚ñ∂ PLAY ASTEROIDS</button>
    </div>

    <!-- Atari Marquee under header -->
    <div class="atari-marquee">
        <marquee><img width="66" src="https://github.com/ghostm68/pantheon/raw/main/atari-inky.gif" alt="Atari Logo"></marquee>
    </div>

    <!-- Main Content Area -->
    <div class="main-wrapper">
        <!-- Main Terminal -->
        <div class="terminal-container">
            <!-- Menu Bar -->
            <div class="menu-bar">
                <button onclick="newFile()">NEW</button>
                <button onclick="recallPage()">OPEN</button>
                <button onclick="savePage()">SAVE</button>
                <button onclick="insertDateTime()">DATE/TIME</button>
                <button onclick="modifyText()">MODIFY</button>
            </div>

            <!-- Text Editor -->
            <div class="editor-wrapper">
                <textarea id="textEditor" placeholder="READY. TYPE YOUR TEXT HERE..." spellcheck="true"></textarea>
            </div>

            <!-- Footer Actions -->
            <div class="footer-actions">
                <button onclick="downloadText()">‚Üì DOWNLOAD</button>
                <button onclick="clearText()">‚úï CLEAR</button>
                <button onclick="toggleFullScreen()">‚õ∂ FULLSCREEN</button>
            </div>
        </div>

        <!-- Side Panel: Magic 8-Ball -->
        <div class="side-panel">
            <div class="magic-ball">
                <div class="ball-title">Magic 8-Ball</div>
                <div class="ball-instruction">ASK A YES/NO<br>QUESTION & CLICK</div>
                <div class="ball-container" id="magicBall" onclick="shakeBall()">
                    <div class="ball-number">8</div>
                    <div class="ball-window">
                        <div class="ball-answer" id="ballAnswer">‚Ä¢ ‚Ä¢ ‚Ä¢</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Site Footer -->
<div class="site-footer"> <p>ATARI  ¬© 2026 INKREALM-NEXUS | TYPE LIKE IT'S 1980</p> <div class="footer-donate"> <form action="https://www.paypal.com/donate" method="post" target="_top"> <input type="hidden" name="hosted_button_id" value="25TNRCZBZ6N36" /> <button type="submit" class="paypal-btn">DONATE WITH PAYPAL</button> <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" /> </form> <span style="color: #FFD700; font-size: 20px;">  <button class="game-link" onclick="openGame()">‚ñ∂ PLAY </button></span> <img width="360" height="88" src="https://github.com/ghostm68/pantheon/raw/main/atari.inkrealm.ad.gif" alt="Atari"> </div> <p>Built with VT323 font & retro vibes | <a href="https://inkrealm.info">INKREALM.INFO</a></p> </div>

    <!-- Game Overlay (hidden by default) -->
    <div class="game-overlay" id="gameOverlay">
        <button class="close-game" onclick="closeGame()">‚úï CLOSE GAME</button>
        <main tabindex="0">
            <canvas id="gameCanvas" width="700" height="500"></canvas>
        </main>
        <div id="instructions">
            <div class="commands"><kbd>‚Üë</kbd> THRUST</div>
            <div class="commands"><kbd>‚Üê</kbd> <kbd>‚Üí</kbd> ROTATE</div>
            <div class="commands"><kbd>SPACE</kbd> SHOOT</div>
        </div>
        <div class="volume">
            <i id="music" class="fas fa-music mute" aria-hidden="true" aria-label="sound off"></i>
            <div id="sound"><i class="fas fa-volume-mute" aria-hidden="true" aria-label="sound off"></i></div>
        </div>
    </div>

    <script>
        // ============================================
        // MAGIC 8-BALL FUNCTIONS
        // ============================================
        const eightBallAnswers = [
            "YES", "NO", "MAYBE", "ASK AGAIN", "DEFINITELY", "DOUBTFUL",
            "ABSOLUTELY", "NOT LIKELY", "CERTAINLY", "NEVER", "PROBABLY",
            "IMPOSSIBLE", "FOR SURE", "NOPE", "OUTLOOK GOOD", "TRY AGAIN",
            "SIGNS POINT TO YES", "DON'T COUNT ON IT", "IT IS CERTAIN", "VERY DOUBTFUL"
        ];

        function shakeBall() {
            const ball = document.getElementById('magicBall');
            const answer = document.getElementById('ballAnswer');
            ball.classList.add('shake');
            answer.textContent = '‚Ä¢ ‚Ä¢ ‚Ä¢';
            setTimeout(() => {
                ball.classList.remove('shake');
                answer.textContent = eightBallAnswers[Math.floor(Math.random() * eightBallAnswers.length)];
            }, 500);
        }

        // ============================================
        // WORD PROCESSOR FUNCTIONS
        // ============================================

        function newFile() {
            document.getElementById('textEditor').value = '';
            alert('NEW PAGE CREATED!');
        }

        function modifyText() {
            const editor = document.getElementById("textEditor");
            editor.style.color = editor.style.color === "red" ? "#A8E0FF" : "red";
        }

        function recallPage() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.txt';
            fileInput.addEventListener('change', function() {
                const file = fileInput.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('textEditor').value = e.target.result;
                    };
                    reader.readAsText(file);
                }
            });
            fileInput.click();
        }

        function savePage() {
            downloadText();
        }

        function insertDateTime() {
            const now = new Date();
            const editor = document.getElementById('textEditor');
            editor.value += '\n' + now.toLocaleString();
        }

        function downloadText() {
            const text = document.getElementById('textEditor').value;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'atari-document.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearText() {
            if (confirm('CLEAR ALL TEXT?')) {
                document.getElementById('textEditor').value = '';
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // ============================================
        // GAME OVERLAY FUNCTIONS
        // ============================================

        function openGame() {
            document.getElementById('gameOverlay').classList.add('active');
            document.querySelector("main").focus();
        }

        function closeGame() {
            document.getElementById('gameOverlay').classList.remove('active');
        }

        // ============================================
        // ASTEROIDS GAME - ORIGINAL CODE
        // ============================================

        const FPS = 30;
        const friction = 0.5;
        const shipBlinkDuration = 0.1;
        const shipExplodeDuration = 0.3;
        const shipInvisibilityDuration = 3;
        const shipSize = 30;
        const shipThrust = 5;
        const shipTurnSpeed = 360;
        const laserDist = 0.4;
        const laserExplodeDuration = 0.1;
        const laserMax = 10;
        const laserSpeed = 500;
        const roidsJag = 0.3;
        const roidsNum = 1;
        const roidsSize = 100;
        const roidsSpeed = 50;
        const roidsVert = 10;
        const gameLives = 3;
        const textFadeTime = 3;
        const textSize = 40;
        const roidsLargePts = 20;
        const roidsMediumPts = 50;
        const roidsSmallPts = 100;
        const saveScore = "highScore";
        let soundOn = false;
        let musicOn = false;

        let canvas = document.getElementById("gameCanvas");
        let context = canvas.getContext("2d");

        // SOUND EFFECTS
        function Sound(src, maxStreams = 1, vol = 1.0) {
            this.streamNum = 0;
            this.streams = [];
            for (let i = 0; i < maxStreams; i++) {
                this.streams.push(new Audio(src));
                this.streams[i].volume = vol;
            }
            this.play = function () {
                if (soundOn) {
                    this.streamNum = (this.streamNum + 1) % maxStreams;
                    this.streams[this.streamNum].play();
                }
            }
            this.stop = function () {
                this.streams[this.streamNum].pause();
                this.streams[this.streamNum].currentTime = 0;
            }
        }
        let laserSound = new Sound("https://raw.githubusercontent.com/ghostm68/pantheon/main/fire.m4a", 5, 0.4);
        let thrustSound = new Sound("https://raw.githubusercontent.com/ghostm68/pantheon/main/thrust.m4a");
        let hitSound = new Sound("https://raw.githubusercontent.com/ghostm68/pantheon/main/bangMedium.m4a", 5, 0.8);
        let explosionSound = new Sound("https://raw.githubusercontent.com/ghostm68/pantheon/main/bangLarge.m4a", 1, 0.7);

        // MUSIC
        let music = new Music("https://raw.githubusercontent.com/ghostm68/pantheon/main/beat1.m4a","https://raw.githubusercontent.com/ghostm68/pantheon/main/beat2.m4a");
        let roidsLeft, roidsTotal;
        function Music (srcA, srcB) {
            this.soundA = new Audio(srcA);
            this.soundB = new Audio(srcB);
            this.a = true;
            this.tempo = 1.0;
            this.beatTime = 0;
            this.play = function () {
                if (musicOn) {
                    if (this.a) {
                        this.soundA.play();
                    } else {
                        this.soundB.play();
                    }
                    this.a = !this.a;
                }
            }
            this.setAsteroidRatio = function (ratio) {
                this.tempo = 1 - 0.75 * (1 - ratio);
            }
            this.tick = function () {
                if (this.beatTime === 0) {
                    this.play();
                    this.beatTime = Math.ceil(this.tempo * FPS);
                } else {
                    this.beatTime--;
                }
            }
        }

        // SET UP THE GAME LOOP
        setInterval(update, 1000 / FPS);

        // SET UP GAME PARAMETERS
        let level, roids, ship, lives, score, highScore, text, textAlpha;

        // START THE GAME
        context.fillStyle = "rgba(44,44,44,1.00)";
        context.fillRect(0, 0, canvas.width, canvas.height);
        context.fillStyle = "rgba(193,193,193,1.00)";
        context.font = "normal small-caps 100 " + (textSize + 30) + "px VT323";
        context.textAlign = "center";
        context.textBaseline = "middle";
        context.fillText("ASTEROIDS", canvas.width / 2, canvas.height * 0.48);
        context.font = "small-caps " + (textSize - 15) + "px VT323";
        context.fillText("PRESS ANY KEY TO START", canvas.width / 2, canvas.height * 0.58);
        document.addEventListener("keydown", newGame);

        // BUILD AN ASTEROID
        function newAsteroid (x, y, r) {
            let lvlMultiply = 1 + 0.1 * level;
            let roid = {
                x: x,
                y:y,
                xv: Math.random() * roidsSpeed * lvlMultiply / FPS * (Math.random() < 0.5 ? 1 : -1),
                yv: Math.random() * roidsSpeed * lvlMultiply / FPS * (Math.random() < 0.5 ? 1 : -1),
                r: r,
                a: Math.random() * Math.PI * 2,
                vert: Math.floor(Math.random() * (roidsVert + 1) + roidsVert / 2),
                offs : []
            };
            for (let i = 0; i < roid.vert; i++) {
                roid.offs.push(Math.random() * roidsJag * 2 + 1 - roidsJag);
            }
            return roid;
        }

        // CREATE THE ASTEROID BELT
        function createAsteroidBelt () {
            roids = [];
            roidsTotal = (roidsNum + level) * 7;
            roidsLeft = roidsTotal;
            let x, y;
            for (let i = 0; i < roidsNum + level; i++) {
                do { 
                    x = Math.floor(Math.random() * canvas.width);
                    y = Math.floor(Math.random() * canvas.height);
                } while (distBetweenPoints(ship.x, ship.y, x, y) < roidsSize * 2 + ship.r);
                roids.push(newAsteroid(x, y, Math.ceil(roidsSize / 2)));
            }
        }

        // DESTROY AN ASTEROID
        function destroyAsteroid (index) {
            let x = roids[index].x;
            let y = roids[index].y;
            let r = roids[index].r;
            
            if (r === Math.ceil(roidsSize / 2)) {
                roids.push(newAsteroid(x, y, Math.ceil(roidsSize / 4)));
                roids.push(newAsteroid(x, y, Math.ceil(roidsSize / 4)));
                score += roidsLargePts;
            } else if (r == Math.ceil(roidsSize / 4)) {
                roids.push(newAsteroid(x, y, Math.ceil(roidsSize / 8)));
                roids.push(newAsteroid(x, y, Math.ceil(roidsSize / 8)));
                score += roidsMediumPts;
            } else {
                score += roidsSmallPts;
            }
            
            if (score > highScore) {
                highScore = score;
                localStorage.setItem(saveScore, highScore);
            }
            
            roids.splice(index, 1);
            hitSound.play();
            
            roidsLeft--;
            music.setAsteroidRatio(roidsLeft === 0 ? 1 : roidsLeft / roidsTotal);
            
            if (roids.length === 0){
                level++;
                newLevel();
            }
        }

        // GET THE DISTANCE BETWEEN TWO POINTS
        function distBetweenPoints(x1, y1, x2, y2) {
            return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
        }

        // BUILD A NEW SHIP
        function newShip () {
            return {
                x: canvas.width / 2,
                y: canvas.height / 2,
                r: shipSize / 2,
                a: 90 / 180 * Math.PI,
                blinkNumber: Math.ceil(shipInvisibilityDuration / shipBlinkDuration),
                blinkTime: Math.ceil(shipBlinkDuration * FPS),
                canShoot: true,
                dead: false,
                explodeTime: 0,
                lasers:[],
                rotation: 0,
                thrusting: false,
                thrust : {
                    x: 0,
                    y: 0
                }
            }
        }

        // SHOOT LASERS
        function shootLaser () {
            if (ship.canShoot && ship.lasers.length < laserMax) {
                ship.lasers.push({
                    x: ship.x + 4 / 3 * ship.r * Math.cos(ship.a),
                    y : ship.y - 4 / 3 * ship.r * Math.sin(ship.a),
                    xv : laserSpeed * Math.cos(ship.a) / FPS,
                    yv : -laserSpeed * Math.sin(ship.a) / FPS, 
                    dist: 0,
                    explodeTime: 0
                });
                laserSound.play();
            }
            ship.canShoot = false;
        }

        // MAKE THE SHIP EXPLODE
        function explodeShip () {
            ship.explodeTime = Math.ceil(shipExplodeDuration * FPS);
            explosionSound.play();
        }

        // DRAW THE EXPLOSION
        function drawExplosion (ex, ey, spikes, r) {
            let rot = Math.PI / 2 * 3;
            let x = ex;
            let y = ey;
            let step = Math.PI / spikes;
            context.beginPath();
            context.moveTo(ex, ey - r);
            for (let i = 0; i < spikes; i++) {
                x = ex + Math.cos(rot) * r;
                y = ey + Math.sin(rot) * r;
                context.lineTo(x, y);
                rot += step;
                x = ex + Math.cos(rot);
                y = ey + Math.sin(rot);
                context.lineTo(x, y);
                rot += step
            }
            context.lineTo(ex, ey - r);
            context.closePath();
            context.lineWidth = 3.5;
            context.strokeStyle = "rgba(179,62,0,1.00)";
            context.stroke();
            context.fillStyle = "rgba(255,235,0,1.00)";
            context.fill();
            
            context.fillStyle = "rgba(198,77,0,1.00)";
            context.beginPath();
            context.arc(ex, ey, r * 0.7, Math.PI * 2, false);
            context.fill();
            context.fillStyle =  "rgba(252,99,0,1.00)";
            context.beginPath();
            context.arc(ex, ey, r * 0.6, Math.PI * 2, false);
            context.fill();
            context.fillStyle =  "rgba(255,140,65,1.00)";
            context.beginPath();
            context.arc(ex, ey, r * 0.5, Math.PI * 2, false);
            context.fill();
            context.fillStyle = "rgba(255,169,65,1.00)";
            context.beginPath();
            context.arc(ex, ey, r * 0.4, Math.PI * 2, false);
            context.fill();
            context.fillStyle = "rgba(255,206,65,1.00)";
            context.beginPath();
            context.arc(ex, ey, r * 0.3, Math.PI * 2, false);
            context.fill();
            context.fillStyle = "rgba(255,233,66,1.00)";
            context.beginPath();
            context.arc(ex, ey, r * 0.2, 0, Math.PI * 2, false);
            context.fill();
        }

        // MAKE THE GAME WORKS
        function update () {
            // Don't run update if game hasn't started yet
            if (!ship) return;
            
            let blinkOn = ship.blinkNumber % 2 === 0;
            let exploding = ship.explodeTime > 0;
            
            music.tick();
            
            context.fillStyle = "rgba(44,44,44,1.00)";
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // DRAW THE ASTEROIDS
            let x, y, r, a, vert, offs;
            for (let i = 0; i < roids.length; i++) {
                context.strokeStyle = "rgba(217,241,189,1.00)";
                context.lineWidth = shipSize / 20;
                
                x = roids[i].x;
                y = roids[i].y;
                r = roids[i].r;
                a = roids[i].a;
                vert = roids[i].vert;
                offs = roids[i].offs;
                
                context.beginPath();
                context.moveTo(
                    x + r * offs[0] * Math.cos(a),
                    y + r * offs[0] * Math.sin(a)
                );
                
                for (let j = 1; j < vert; j++) {
                    context.lineTo(
                        x + r * offs[j] * Math.cos(a + j * Math.PI * 2 / vert),
                        y + r * offs[j] * Math.sin(a + j * Math.PI * 2 / vert)
                    );
                }
                context.closePath();
                context.stroke();
            }
            
            // THRUST THE SHIP
            if (ship.thrusting && !ship.dead) {
                ship.thrust.x += shipThrust * Math.cos(ship.a) / FPS;
                ship.thrust.y -= shipThrust * Math.sin(ship.a) / FPS;
                thrustSound.play();
                
                if (!exploding && blinkOn) {
                    context.fillStyle= "rgba(255,86,0,1.00)";
                    context.strokeStyle = "rgba(255,169,78,1.00)"; 
                    context.lineWidth = shipSize / 10;
                    context.beginPath();
                    context.moveTo(
                        ship.x - ship.r * (2 / 3 * Math.cos(ship.a) + 0.5 * Math.sin(ship.a)),
                        ship.y + ship.r * (2 / 3 * Math.sin(ship.a) - 0.5 * Math.cos(ship.a))
                    );
                    context.lineTo(
                        ship.x - ship.r * (5 / 3 * Math.cos(ship.a)),
                        ship.y + ship.r * (5 / 3 * Math.sin(ship.a))
                    );
                    context.lineTo(
                        ship.x - ship.r * (2 / 3 * Math.cos(ship.a) - 0.5 * Math.sin(ship.a)),
                        ship.y + ship.r * (2 / 3 * Math.sin(ship.a) + 0.5* Math.cos(ship.a))
                    );
                    context.closePath();
                    context.fill();
                    context.stroke();
                }
            } else {
                ship.thrust.x -= friction * ship.thrust.x / FPS;
                ship.thrust.y -= friction * ship.thrust.y / FPS;
                thrustSound.stop()
            }
            
            // DRAW THE SHIP
            if (!exploding) {
                if (blinkOn && !ship.dead) {
                    context.strokeStyle = "#fff";
                    context.lineWidth = shipSize / 20;
                    context.beginPath();
                    context.moveTo(
                        ship.x + 5 / 3 * ship.r * Math.cos(ship.a),
                        ship.y - 5 / 3 * ship.r * Math.sin(ship.a)
                    );
                    context.lineTo(
                        ship.x - ship.r * (2 / 3 * Math.cos(ship.a) + Math.sin(ship.a)),
                        ship.y + ship.r * (2 / 3 * Math.sin(ship.a) - Math.cos(ship.a))
                    );
                    context.lineTo(
                        ship.x - ship.r * (2 / 3 * Math.cos(ship.a) - Math.sin(ship.a)),
                        ship.y + ship.r * (2 / 3 * Math.sin(ship.a) + Math.cos(ship.a))
                    );
                    context.closePath();
                    context.stroke();
                }
                if (ship.blinkNumber > 0) {
                    ship.blinkTime--;
                    if (ship.blinkTime === 0) {
                        ship.blinkTime = Math.ceil(shipBlinkDuration * FPS);
                        ship.blinkNumber--;
                    }
                }
            } else {
                drawExplosion(ship.x, ship.y, 20, ship.r);
            }
            
            // DRAW THE LASERS
            for (let i = 0; i < ship.lasers.length; i++) {
                if (ship.lasers[i].explodeTime == 0) {
                    context.fillStyle = "rgba(251,143,129,1.00)";
                    context.beginPath();
                    context.arc(ship.lasers[i].x, ship.lasers[i].y, shipSize / 15, 0, Math.PI * 2, false);
                    context.fill();
                } else {
                    drawExplosion(ship.lasers[i].x, ship.lasers[i].y, 20, shipSize * 0.75);
                }
            }
            
            // DRAW THE GAME TEXT
            if (textAlpha >= 0) {
                context.fillStyle = "rgba(255, 255, 255, " + textAlpha + ")";
                context.font = "small-caps " + (textSize + 20) + "px VT323";
                context.textAlign   = "center";
                context.fillText(text, canvas.width / 2, canvas.height * 0.7);
                textAlpha -= (1.0 / textFadeTime / FPS);
            } else if (ship.dead) {
                context.fillStyle = "rgba(215,215,215,1.00)";
                context.font = "small-caps " + (textSize - 5) + "px VT323";
                context.textAlign   = "center";
                context.textBaseline = "middle";
                context.fillText("PRESS ANY KEY TO PLAY AGAIN", canvas.width / 2, canvas.height * 0.5);
                document.addEventListener("keydown", newGame);
            }
            
            // DRAW THE LIVES 
            let lifeColors;
            for (let i = 0; i < lives; i++) {
                lifeColors = exploding && i === lives - 1 ? "red" : "#fff";
                context.strokeStyle = lifeColors;
                context.lineWidth = shipSize / 20;
                context.beginPath();
                context.moveTo(
                    (shipSize + i * shipSize * 1.2) + 5 / 3 * (shipSize/2) * Math.cos(0.5 * Math.PI),
                    shipSize - 5 / 3 * (shipSize/2) * Math.sin(0.5 * Math.PI)
                );
                context.lineTo(
                    (shipSize + i * shipSize * 1.2) - (shipSize/2) * (2 / 3 * Math.cos(0.5 * Math.PI) + Math.sin(0.5 * Math.PI)),
                    shipSize + (shipSize/2) * (2 / 3 * Math.sin(0.5 * Math.PI) - Math.cos(0.5 * Math.PI))
                );
                context.lineTo(
                    (shipSize + i * shipSize * 1.2) - (shipSize/2) * (2 / 3 * Math.cos(0.5 * Math.PI) - Math.sin(0.5 * Math.PI)),
                    shipSize + (shipSize/2) * (2 / 3 * Math.sin(0.5 * Math.PI) + Math.cos(0.5 * Math.PI))
                );
                context.closePath();
                context.stroke();
            }
            
            // DRAW THE SCORE
            context.fillStyle = "#C9C9C9";
            context.font = (textSize + 5) + "px VT323";
            context.textAlign = "right";
            context.textBaseline = "middle";
            context.fillText(score, canvas.width - shipSize / 2, shipSize);
            
            // DRAW THE HIGH SCORE
            context.fillStyle = "#C9C9C9";
            context.font = (textSize * 0.9) + "px VT323";
            context.textAlign = "center";
            context.textBaseline = "middle";
            context.fillText("BEST SCORE: " + highScore, canvas.width / 2, shipSize);
            
            //DETECT LASER HITS ON ASTEROID
            let ax, ay, ar, lx, ly;
            for (let i = roids.length - 1; i >= 0; i--) {
                ax = roids[i].x;
                ay = roids[i].y;
                ar = roids[i].r;
                for (let j = ship.lasers.length - 1; j >= 0; j--) {
                    lx = ship.lasers[j].x;
                    ly = ship.lasers[j].y;
                    
                    if (ship.lasers[j].explodeTime === 0 && distBetweenPoints(ax, ay, lx, ly) < ar) {
                        destroyAsteroid(i);
                        ship.lasers[j].explodeTime = Math.ceil(laserExplodeDuration * FPS);
                        break;
                    }
                }
            }
            
            //CHECK FOR ASTEROID COLLISIONS
            if (!exploding) {
                if (ship.blinkNumber === 0 && !ship.dead) {
                    for (let i = 0; i < roids.length; i++) {
                        if (distBetweenPoints(ship.x, ship.y, roids[i].x, roids[i].y) < ship.r + roids[i].r) {
                            explodeShip();
                            destroyAsteroid(i);
                            break;
                        }
                    }
                }

                ship.a += ship.rotation; 
                ship.x += ship.thrust.x;
                ship.y += ship.thrust.y;
            
            } else {
                ship.explodeTime --;
                if (ship.explodeTime == 0) {
                    lives--;
                    if (lives === 0) {
                        gameOver();
                    } else {
                        ship = newShip();
                    }
                }
            }
            
            // HANDLE EDGE OF SCREEN
            if (ship.x < 0 - ship.r) {
                ship.x = canvas.width + ship.r;
            } else if (ship.x > canvas.width + ship.r) {
                ship.x = 0 - ship.r;
            }
            if (ship.y < 0 - ship.r) {
                ship.y = canvas.height + ship.r;
            } else if (ship.y > canvas.height + ship.r) {
                ship.y = 0 - ship.r;
            } 
            
            // MOVE THE LASERS
            for (let i = ship.lasers.length - 1; i >= 0; i--) {
                if (ship.lasers[i].dist > laserDist * canvas.width) {
                    ship.lasers.splice(i, 1);
                    continue;
                } 
                
                if (ship.lasers[i].explodeTime > 0) {
                    ship.lasers[i].explodeTime --;
                    if (ship.lasers[i].explodeTime == 0) {
                        ship.lasers.splice(i, 1);
                        continue;
                    }
                } else {
                    ship.lasers[i].x += ship.lasers[i].xv;
                    ship.lasers[i].y += ship.lasers[i].yv;
                    ship.lasers[i].dist += Math.sqrt(Math.pow(ship.lasers[i].xv, 2) + Math.pow(ship.lasers[i].yv, 2));
                }
                
                if (ship.lasers[i].x < 0) {
                    ship.lasers[i].x = canvas.width;
                } else if (ship.lasers[i].x > canvas.width) {
                    ship.lasers[i].x = 0;
                }
                if (ship.lasers[i].y < 0) {
                    ship.lasers[i].y = canvas.height;
                } else if (ship.lasers[i].y > canvas.height) {
                    ship.lasers[i].y = 0;
                }
            }
            
            //MOVE THE ASTEROIDS
            for  (let i = 0; i < roids.length; i++) {
                roids[i].x += roids[i].xv;
                roids[i].y += roids[i].yv;
                
                if (roids[i].x < 0 - roids[i].r) {
                    roids[i].x = canvas.width + roids[i].r;
                } else if (roids[i].x > canvas.width + roids[i].r){
                    roids[i].x = 0 - roids[i].r
                }
                if (roids[i].y < 0 - roids[i].r) {
                    roids[i].y = canvas.height + roids[i].r;
                } else if (roids[i].y > canvas.height + roids[i].r){
                    roids[i].y = 0 - roids[i].r
                }
            }
        }

        // START A NEW GAME
        function newGame () {
            level = 0;
            score = 0;
            lives = gameLives;
            ship = newShip();
            
            document.removeEventListener("keydown", newGame);
            
            let scoreStr = localStorage.getItem(saveScore);
            if (scoreStr === null) {
                highScore = 0;
            } else {
                highScore = parseInt(scoreStr);
            }
            
            newLevel();
        }

        // NEW LEVEL
        function newLevel () {
            text = "Level " + (level + 1);
            textAlpha = 1.0;
            createAsteroidBelt();
        }

        // GAME OVER
        function gameOver () {
            ship.dead = true;
            text = "Game Over";
            textAlpha = 1.0;
            musicOn = false;
        }

        // MOVE THE SHIP AND SHOOT THE LASERS ON KEYDOWN
        function keyDown (e) {
            if (ship.dead) {
                return;
            }
            switch (e.keyCode) {
                case 32:
                    shootLaser();
                    break;
                case 37:
                    ship.rotation = shipTurnSpeed / 180 * Math.PI / FPS;
                    break;
                case 38:
                    ship.thrusting = true;
                    break;
                case 39:
                    ship.rotation = -shipTurnSpeed / 180 * Math.PI / FPS;
                    break;
            }
        }

        // STOP THE ACTIONS ON KEYUP
        function keyUp (e) {
            switch (e.keyCode) {
                case 32:
                    ship.canShoot = true;
                    break;
                case 37:
                    ship.rotation = 0;
                    break;
                case 38:
                    ship.thrusting = false;
                    break;
                case 39:
                    ship.rotation = 0;
                    break;
            }
        }

        // SWITCH ON/OFF THE SOUND EFFECTS
        function soundToggle () {
            if(soundOn === false) {
                soundOn = true;
                document.querySelector("#sound").innerHTML = '<i class="fas fa-volume-up" aria-hidden="true" aria-label="sound on"></i>'
            } else {
                soundOn = false;
                document.querySelector("#sound").innerHTML = '<i class="fas fa-volume-mute" aria-hidden="true" aria-label="sound off"></i>'
            }
        }

        // SWITCH ON/OFF THE MUSIC
        function musicToggle () {
            if(musicOn === false) {
                musicOn = true;
                document.querySelector("#music").classList.remove("mute");
            } else {
                musicOn = false;
                document.querySelector("#music").classList.add("mute");
            }
        }

        document.addEventListener("keydown", keyDown);
        document.addEventListener("keyup", keyUp);
        document.querySelector("#sound").addEventListener("click", soundToggle);
        document.querySelector("#music").addEventListener("click", musicToggle);
    </script>
</body>
</html>
